{"ast":null,"code":"import { __assign } from 'tslib';\nimport hash from 'hash-sum';\n(function () {\n  if (typeof window === 'undefined' || typeof window.CustomEvent === 'function') return false;\n  function CustomEvent(event, params) {\n    params = params || {\n      bubbles: false,\n      cancelable: false,\n      detail: null\n    };\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    return evt;\n  }\n  window.CustomEvent = CustomEvent;\n})();\nvar isSafari = typeof window !== 'undefined' && /^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);\nvar isClient = typeof window !== 'undefined';\n// TODO: queue all of these in a debounceNextTick\nfunction nextTick(fn) {\n  // if (typeof process !== 'undefined' && process.nextTick) {\n  //   console.log('process.nextTick?');\n  //   process.nextTick(fn);\n  //   return;\n  // }\n  // FIXME: fix the real safari issue of this randomly not working\n  if (!isClient || isSafari || typeof MutationObserver === 'undefined') {\n    setTimeout(fn);\n    return;\n  }\n  var called = 0;\n  var observer = new MutationObserver(function () {\n    return fn();\n  });\n  var element = document.createTextNode('');\n  observer.observe(element, {\n    characterData: true\n  });\n  // tslint:disable-next-line\n  element.data = String(called = ++called);\n}\nvar PROPERTY_NAME_DENY_LIST = Object.freeze(['__proto__', 'prototype', 'constructor']);\n// TODO: unit tests\nvar QueryString = /** @class */function () {\n  function QueryString() {}\n  QueryString.parseDeep = function (queryString) {\n    var obj = this.parse(queryString);\n    return this.deepen(obj);\n  };\n  QueryString.stringifyDeep = function (obj) {\n    var map = this.flatten(obj);\n    return this.stringify(map);\n  };\n  QueryString.parse = function (queryString) {\n    var query = {};\n    var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');\n    for (var i = 0; i < pairs.length; i++) {\n      var pair = pairs[i].split('=');\n      // TODO: node support?\n      try {\n        query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');\n      } catch (error) {\n        // Ignore malformed URI components\n      }\n    }\n    return query;\n  };\n  QueryString.stringify = function (map) {\n    var str = '';\n    for (var key in map) {\n      if (map.hasOwnProperty(key)) {\n        var value = map[key];\n        if (str) {\n          str += '&';\n        }\n        str += encodeURIComponent(key) + '=' + encodeURIComponent(value);\n      }\n    }\n    return str;\n  };\n  QueryString.deepen = function (map) {\n    // FIXME; Should be type Tree = Record<string, string | Tree>\n    // requires a typescript upgrade.\n    var output = {};\n    for (var k in map) {\n      var t = output;\n      var parts = k.split('.');\n      var key = parts.pop();\n      for (var _i = 0, parts_1 = parts; _i < parts_1.length; _i++) {\n        var part = parts_1[_i];\n        assertAllowedPropertyName(part);\n        t = t[part] = t[part] || {};\n      }\n      t[key] = map[k];\n    }\n    return output;\n  };\n  QueryString.flatten = function (obj, _current, _res) {\n    if (_res === void 0) {\n      _res = {};\n    }\n    for (var key in obj) {\n      var value = obj[key];\n      var newKey = _current ? _current + '.' + key : key;\n      if (value && typeof value === 'object') {\n        this.flatten(value, newKey, _res);\n      } else {\n        _res[newKey] = value;\n      }\n    }\n    return _res;\n  };\n  return QueryString;\n}();\nfunction assertAllowedPropertyName(name) {\n  if (PROPERTY_NAME_DENY_LIST.indexOf(name) >= 0) throw new Error(\"Property name \\\"\".concat(name, \"\\\" is not allowed\"));\n}\nvar Subscription = /** @class */function () {\n  function Subscription(listeners, listener) {\n    this.listeners = listeners;\n    this.listener = listener;\n    this.unsubscribed = false;\n    this.otherSubscriptions = [];\n  }\n  Object.defineProperty(Subscription.prototype, \"closed\", {\n    get: function () {\n      return this.unsubscribed;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Subscription.prototype.add = function (subscription) {\n    this.otherSubscriptions.push(subscription);\n  };\n  Subscription.prototype.unsubscribe = function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (this.listener && this.listeners) {\n      var index = this.listeners.indexOf(this.listener);\n      if (index > -1) {\n        this.listeners.splice(index, 1);\n      }\n    }\n    this.otherSubscriptions.forEach(function (sub) {\n      return sub.unsubscribe();\n    });\n    this.unsubscribed = true;\n  };\n  return Subscription;\n}();\n// TODO: follow minimal basic spec: https://github.com/tc39/proposal-observable\nvar BehaviorSubject = /** @class */function () {\n  function BehaviorSubject(value) {\n    var _this = this;\n    this.value = value;\n    this.listeners = [];\n    this.errorListeners = [];\n    this.then = function () {\n      var _a;\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      return (_a = _this.toPromise()).then.apply(_a, args);\n    };\n  }\n  BehaviorSubject.prototype.next = function (value) {\n    this.value = value;\n    for (var _i = 0, _a = this.listeners; _i < _a.length; _i++) {\n      var listener = _a[_i];\n      listener(value);\n    }\n  };\n  // TODO: implement this as PIPE instead\n  BehaviorSubject.prototype.map = function (fn) {\n    var newSubject = new BehaviorSubject(fn(this.value));\n    // TODO: on destroy delete these\n    this.subscribe(function (val) {\n      newSubject.next(fn(val));\n    });\n    this.catch(function (err) {\n      newSubject.error(err);\n    });\n    return newSubject;\n  };\n  BehaviorSubject.prototype.catch = function (errorListener) {\n    this.errorListeners.push(errorListener);\n    return new Subscription(this.errorListeners, errorListener);\n  };\n  BehaviorSubject.prototype.error = function (error) {\n    for (var _i = 0, _a = this.errorListeners; _i < _a.length; _i++) {\n      var listener = _a[_i];\n      listener(error);\n    }\n  };\n  BehaviorSubject.prototype.subscribe = function (listener, errorListener) {\n    this.listeners.push(listener);\n    if (errorListener) {\n      this.errorListeners.push(errorListener);\n    }\n    return new Subscription(this.listeners, listener);\n  };\n  BehaviorSubject.prototype.toPromise = function () {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      var subscription = _this.subscribe(function (value) {\n        resolve(value);\n        subscription.unsubscribe();\n      }, function (err) {\n        reject(err);\n        subscription.unsubscribe();\n      });\n    });\n  };\n  BehaviorSubject.prototype.promise = function () {\n    return this.toPromise();\n  };\n  return BehaviorSubject;\n}();\nvar State = {\n  Pending: 'Pending',\n  Fulfilled: 'Fulfilled',\n  Rejected: 'Rejected'\n};\nfunction isFunction(val) {\n  return val && typeof val === 'function';\n}\nfunction isObject(val) {\n  return val && typeof val === 'object';\n}\nvar TinyPromise = /** @class */function () {\n  function TinyPromise(executor) {\n    this._state = State.Pending;\n    this._handlers = [];\n    this._value = null;\n    executor(this._resolve.bind(this), this._reject.bind(this));\n  }\n  TinyPromise.prototype._resolve = function (x) {\n    var _this = this;\n    if (x instanceof TinyPromise) {\n      x.then(this._resolve.bind(this), this._reject.bind(this));\n    } else if (isObject(x) || isFunction(x)) {\n      var called_1 = false;\n      try {\n        var thenable = x.then;\n        if (isFunction(thenable)) {\n          thenable.call(x, function (result) {\n            if (!called_1) _this._resolve(result);\n            called_1 = true;\n            return undefined;\n          }, function (error) {\n            if (!called_1) _this._reject(error);\n            called_1 = true;\n            return undefined;\n          });\n        } else {\n          this._fulfill(x);\n        }\n      } catch (ex) {\n        if (!called_1) {\n          this._reject(ex);\n        }\n      }\n    } else {\n      this._fulfill(x);\n    }\n  };\n  TinyPromise.prototype._fulfill = function (result) {\n    var _this = this;\n    this._state = State.Fulfilled;\n    this._value = result;\n    this._handlers.forEach(function (handler) {\n      return _this._callHandler(handler);\n    });\n  };\n  TinyPromise.prototype._reject = function (error) {\n    var _this = this;\n    this._state = State.Rejected;\n    this._value = error;\n    this._handlers.forEach(function (handler) {\n      return _this._callHandler(handler);\n    });\n  };\n  TinyPromise.prototype._isPending = function () {\n    return this._state === State.Pending;\n  };\n  TinyPromise.prototype._isFulfilled = function () {\n    return this._state === State.Fulfilled;\n  };\n  TinyPromise.prototype._isRejected = function () {\n    return this._state === State.Rejected;\n  };\n  TinyPromise.prototype._addHandler = function (onFulfilled, onRejected) {\n    this._handlers.push({\n      onFulfilled: onFulfilled,\n      onRejected: onRejected\n    });\n  };\n  TinyPromise.prototype._callHandler = function (handler) {\n    if (this._isFulfilled() && isFunction(handler.onFulfilled)) {\n      handler.onFulfilled(this._value);\n    } else if (this._isRejected() && isFunction(handler.onRejected)) {\n      handler.onRejected(this._value);\n    }\n  };\n  TinyPromise.prototype.then = function (onFulfilled, onRejected) {\n    var _this = this;\n    switch (this._state) {\n      case State.Pending:\n        {\n          return new TinyPromise(function (resolve, reject) {\n            _this._addHandler(function (value) {\n              nextTick(function () {\n                try {\n                  if (isFunction(onFulfilled)) {\n                    resolve(onFulfilled(value));\n                  } else {\n                    resolve(value);\n                  }\n                } catch (ex) {\n                  reject(ex);\n                }\n              });\n            }, function (error) {\n              nextTick(function () {\n                try {\n                  if (isFunction(onRejected)) {\n                    resolve(onRejected(error));\n                  } else {\n                    reject(error);\n                  }\n                } catch (ex) {\n                  reject(ex);\n                }\n              });\n            });\n          });\n        }\n      case State.Fulfilled:\n        {\n          return new TinyPromise(function (resolve, reject) {\n            nextTick(function () {\n              try {\n                if (isFunction(onFulfilled)) {\n                  resolve(onFulfilled(_this._value));\n                } else {\n                  resolve(_this._value);\n                }\n              } catch (ex) {\n                reject(ex);\n              }\n            });\n          });\n        }\n      case State.Rejected:\n        {\n          return new TinyPromise(function (resolve, reject) {\n            nextTick(function () {\n              try {\n                if (isFunction(onRejected)) {\n                  resolve(onRejected(_this._value));\n                } else {\n                  reject(_this._value);\n                }\n              } catch (ex) {\n                reject(ex);\n              }\n            });\n          });\n        }\n    }\n  };\n  return TinyPromise;\n}();\nvar Promise$1 = typeof Promise !== 'undefined' ? Promise : TinyPromise;\n\n// Webpack workaround to conditionally require certain external modules\n// only on the server and not bundle them on the client\nvar serverOnlyRequire;\ntry {\n  // tslint:disable-next-line:no-eval\n  serverOnlyRequire = eval('require');\n} catch (err) {\n  // all good\n  serverOnlyRequire = function () {\n    return null;\n  };\n}\nvar serverOnlyRequire$1 = serverOnlyRequire;\nfunction promiseResolve(value) {\n  return new Promise$1(function (resolve) {\n    return resolve(value);\n  });\n}\n// Adapted from https://raw.githubusercontent.com/developit/unfetch/master/src/index.mjs\nfunction tinyFetch(url, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return new Promise$1(function (resolve, reject) {\n    var request = new XMLHttpRequest();\n    request.open(options.method || 'get', url, true);\n    if (options.headers) {\n      for (var i in options.headers) {\n        request.setRequestHeader(i, options.headers[i]);\n      }\n    }\n    request.withCredentials = options.credentials === 'include';\n    request.onload = function () {\n      resolve(response());\n    };\n    request.onerror = reject;\n    request.send(options.body);\n    function response() {\n      var keys = [];\n      var all = [];\n      var headers = {};\n      var header = undefined;\n      request.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm, function (_match, _key, value) {\n        var key = _key;\n        keys.push(key = key.toLowerCase());\n        all.push([key, value]);\n        header = headers[key];\n        headers[key] = header ? \"\".concat(header, \",\").concat(value) : value;\n        return '';\n      });\n      return {\n        ok: (request.status / 100 | 0) === 2,\n        status: request.status,\n        statusText: request.statusText,\n        url: request.responseURL,\n        clone: response,\n        text: function () {\n          return promiseResolve(request.responseText);\n        },\n        json: function () {\n          return promiseResolve(request.responseText).then(JSON.parse);\n        },\n        blob: function () {\n          return promiseResolve(new Blob([request.response]));\n        },\n        headers: {\n          keys: function () {\n            return keys;\n          },\n          entries: function () {\n            return all;\n          },\n          get: function (n) {\n            return headers[n.toLowerCase()];\n          },\n          has: function (n) {\n            return n.toLowerCase() in headers;\n          }\n        }\n      };\n    }\n  });\n}\nfunction getFetch() {\n  // If fetch is defined, in the browser, via polyfill, or in a Cloudflare worker, use it.\n  var _fetch = undefined;\n  if (globalThis.fetch) {\n    _fetch !== null && _fetch !== void 0 ? _fetch : _fetch = globalThis.fetch;\n  } else if (typeof window === 'undefined') {\n    // If fetch is not defined, in a Node.js environment, use node-fetch.\n    try {\n      // node-fetch@^3 is ESM only, and will throw error on require.\n      _fetch !== null && _fetch !== void 0 ? _fetch : _fetch = serverOnlyRequire$1('node-fetch');\n    } catch (e) {\n      // If node-fetch is not installed, use tiny-fetch.\n      console.warn('node-fetch is not installed. consider polyfilling fetch or installing node-fetch.');\n      console.warn(e);\n    }\n  }\n  // Otherwise, use tiny-fetch.\n  return _fetch !== null && _fetch !== void 0 ? _fetch : tinyFetch;\n}\nfunction assign(target) {\n  var to = Object(target);\n  for (var index = 1; index < arguments.length; index++) {\n    var nextSource = arguments[index];\n    if (nextSource != null) {\n      // Skip over if undefined or null\n      for (var nextKey in nextSource) {\n        // Avoid bugs when hasOwnProperty is shadowed\n        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n          to[nextKey] = nextSource[nextKey];\n        }\n      }\n    }\n  }\n  return to;\n}\nfunction throttle(func, wait, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  var context;\n  var args;\n  var result;\n  var timeout = null;\n  var previous = 0;\n  var later = function () {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n  return function () {\n    var now = Date.now();\n    if (!previous && options.leading === false) previous = now;\n    var remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\nvar camelCaseToKebabCase = function (str) {\n  return str ? str.replace(/([A-Z])/g, function (g) {\n    return \"-\".concat(g[0].toLowerCase());\n  }) : '';\n};\nvar Animator = /** @class */function () {\n  function Animator() {}\n  Animator.prototype.bindAnimations = function (animations) {\n    for (var _i = 0, animations_1 = animations; _i < animations_1.length; _i++) {\n      var animation = animations_1[_i];\n      switch (animation.trigger) {\n        case 'pageLoad':\n          this.triggerAnimation(animation);\n          break;\n        case 'hover':\n          this.bindHoverAnimation(animation);\n          break;\n        case 'scrollInView':\n          this.bindScrollInViewAnimation(animation);\n          break;\n      }\n    }\n  };\n  Animator.prototype.warnElementNotPresent = function (id) {\n    console.warn(\"Cannot animate element: element with ID \".concat(id, \" not found!\"));\n  };\n  Animator.prototype.augmentAnimation = function (animation, element) {\n    var stylesUsed = this.getAllStylesUsed(animation);\n    var computedStyle = getComputedStyle(element);\n    // const computedStyle = getComputedStyle(element);\n    // // FIXME: this will break if original load is in one reponsive size then resize to another hmmm\n    // Need to use transform instead of left since left can change on screen sizes\n    var firstStyles = animation.steps[0].styles;\n    var lastStyles = animation.steps[animation.steps.length - 1].styles;\n    var bothStyles = [firstStyles, lastStyles];\n    // FIXME: this won't work as expected for augmented animations - may need the editor itself to manage this\n    for (var _i = 0, bothStyles_1 = bothStyles; _i < bothStyles_1.length; _i++) {\n      var styles = bothStyles_1[_i];\n      for (var _a = 0, stylesUsed_1 = stylesUsed; _a < stylesUsed_1.length; _a++) {\n        var style = stylesUsed_1[_a];\n        if (!(style in styles)) {\n          styles[style] = computedStyle[style];\n        }\n      }\n    }\n  };\n  Animator.prototype.getAllStylesUsed = function (animation) {\n    var properties = [];\n    for (var _i = 0, _a = animation.steps; _i < _a.length; _i++) {\n      var step = _a[_i];\n      for (var key in step.styles) {\n        if (properties.indexOf(key) === -1) {\n          properties.push(key);\n        }\n      }\n    }\n    return properties;\n  };\n  Animator.prototype.triggerAnimation = function (animation) {\n    var _this = this;\n    // TODO: do for ALL elements\n    var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n    Array.from(elements).forEach(function (element) {\n      _this.augmentAnimation(animation, element);\n      // TODO: do this properly, may have other animations of different properties\n      // TODO: only override the properties\n      // TODO: if there is an entrance and hover animation, the transition duration will get effed\n      // element.setAttribute('style', '');\n      // const styledUsed = this.getAllStylesUsed(animation);\n      element.style.transition = 'none';\n      element.style.transitionDelay = '0';\n      assign(element.style, animation.steps[0].styles);\n      // TODO: queue/batch these timeouts\n      // TODO: only include properties explicitly set in the animation\n      // using Object.keys(styles)\n      setTimeout(function () {\n        element.style.transition = \"all \".concat(animation.duration, \"s \").concat(camelCaseToKebabCase(animation.easing));\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n        assign(element.style, animation.steps[1].styles);\n        // TODO: maybe remove/reset transitoin property after animation duration\n        // TODO: queue timers\n        setTimeout(function () {\n          // TODO: what if has other transition (reset back to what it was)\n          element.style.transition = '';\n          element.style.transitionDelay = '';\n        }, (animation.delay || 0) * 1000 + animation.duration * 1000 + 100);\n      });\n    });\n  };\n  Animator.prototype.bindHoverAnimation = function (animation) {\n    var _this = this;\n    // TODO: is it multiple binding when editing...?\n    // TODO: unbind on element remove\n    // TODO: apply to ALL elements\n    var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n    Array.from(elements).forEach(function (element) {\n      _this.augmentAnimation(animation, element);\n      var defaultState = animation.steps[0].styles;\n      var hoverState = animation.steps[1].styles;\n      function attachDefaultState() {\n        assign(element.style, defaultState);\n      }\n      function attachHoverState() {\n        assign(element.style, hoverState);\n      }\n      attachDefaultState();\n      element.addEventListener('mouseenter', attachHoverState);\n      element.addEventListener('mouseleave', attachDefaultState);\n      // TODO: queue/batch these timeouts\n      setTimeout(function () {\n        element.style.transition = \"all \".concat(animation.duration, \"s \").concat(camelCaseToKebabCase(animation.easing));\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n      });\n    });\n  };\n  // TODO: unbind on element remove\n  Animator.prototype.bindScrollInViewAnimation = function (animation) {\n    var _this = this;\n    // TODO: apply to ALL matching elements\n    var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n    // TODO: if server side rendered and scrolled into view don't animate...\n    Array.from(elements).forEach(function (element) {\n      _this.augmentAnimation(animation, element);\n      var triggered = false;\n      var pendingAnimation = false;\n      function immediateOnScroll() {\n        if (!triggered && isScrolledIntoView(element)) {\n          triggered = true;\n          pendingAnimation = true;\n          setTimeout(function () {\n            assign(element.style, animation.steps[1].styles);\n            if (!animation.repeat) {\n              document.removeEventListener('scroll', onScroll);\n            }\n            setTimeout(function () {\n              pendingAnimation = false;\n              if (!animation.repeat) {\n                element.style.transition = '';\n                element.style.transitionDelay = '';\n              }\n            }, (animation.duration + (animation.delay || 0)) * 1000 + 100);\n          });\n        } else if (animation.repeat && triggered && !pendingAnimation && !isScrolledIntoView(element)) {\n          // we want to repeat the animation every time the the element is out of view and back again\n          triggered = false;\n          assign(element.style, animation.steps[0].styles);\n        }\n      }\n      // TODO: roll all of these in one for more efficiency of checking all the rects\n      var onScroll = throttle(immediateOnScroll, 200, {\n        leading: false\n      });\n      // TODO: fully in view or partially\n      function isScrolledIntoView(elem) {\n        var rect = elem.getBoundingClientRect();\n        var windowHeight = window.innerHeight;\n        var thresholdPercent = (animation.thresholdPercent || 0) / 100;\n        var threshold = thresholdPercent * windowHeight;\n        // TODO: partial in view? or what if element is larger than screen itself\n        return rect.bottom > threshold && rect.top < windowHeight - threshold // Element is peeking top or bottom\n        // (rect.top > 0 && rect.bottom < window.innerHeight) || // element fits within the screen and is fully on screen (not hanging off at all)\n        // (rect.top < 0 && rect.bottom > window.innerHeight) // element is larger than the screen and hangs over the top and bottom\n        ;\n      }\n      var defaultState = animation.steps[0].styles;\n      function attachDefaultState() {\n        assign(element.style, defaultState);\n      }\n      attachDefaultState();\n      // TODO: queue/batch these timeouts!\n      setTimeout(function () {\n        element.style.transition = \"all \".concat(animation.duration, \"s \").concat(camelCaseToKebabCase(animation.easing));\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n      });\n      // TODO: one listener for everything\n      document.addEventListener('scroll', onScroll, {\n        capture: true,\n        passive: true\n      });\n      // Do an initial check\n      immediateOnScroll();\n    });\n  };\n  return Animator;\n}();\n\n/**\r\n * RegExp to match field-content in RFC 7230 sec 3.2\r\n *\r\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\r\n * field-vchar   = VCHAR / obs-text\r\n * obs-text      = %x80-FF\r\n */\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\nvar Cookies = /** @class */function () {\n  function Cookies(request, response) {\n    this.request = request;\n    this.response = response;\n  }\n  Cookies.prototype.get = function (name) {\n    var header = this.request.headers['cookie'];\n    if (!header) {\n      return;\n    }\n    var match = header.match(getPattern(name));\n    if (!match) {\n      return;\n    }\n    var value = match[1];\n    return value;\n  };\n  Cookies.prototype.set = function (name, value, opts) {\n    var res = this.response;\n    var req = this.request;\n    var headers = res.getHeader('Set-Cookie') || [];\n    // TODO: just make this always true\n    var secure = this.secure !== undefined ? !!this.secure : req.protocol === 'https' || req.connection.encrypted;\n    var cookie = new Cookie(name, value, opts);\n    if (typeof headers === 'string') {\n      headers = [headers];\n    }\n    if (!secure && opts && opts.secure) {\n      throw new Error('Cannot send secure cookie over unencrypted connection');\n    }\n    cookie.secure = secure;\n    if (opts && 'secure' in opts) {\n      cookie.secure = !!opts.secure;\n    }\n    pushCookie(headers, cookie);\n    var setHeader = res.setHeader;\n    setHeader.call(res, 'Set-Cookie', headers);\n    return this;\n  };\n  return Cookies;\n}();\nvar Cookie = /** @class */function () {\n  function Cookie(name, value, attrs) {\n    this.path = '/';\n    this.domain = undefined;\n    this.httpOnly = true;\n    this.sameSite = false;\n    this.secure = false;\n    this.overwrite = false;\n    this.name = '';\n    this.value = '';\n    if (!fieldContentRegExp.test(name)) {\n      throw new TypeError('argument name is invalid');\n    }\n    if (value && !fieldContentRegExp.test(value)) {\n      throw new TypeError('argument value is invalid');\n    }\n    if (!value) {\n      this.expires = new Date(0);\n    }\n    this.name = name;\n    this.value = value || '';\n    if (attrs.expires) {\n      this.expires = attrs.expires;\n    }\n    if (attrs.secure) {\n      this.secure = attrs.secure;\n    }\n  }\n  Cookie.prototype.toString = function () {\n    return \"\".concat(this.name, \"=\").concat(this.value);\n  };\n  Cookie.prototype.toHeader = function () {\n    var header = this.toString();\n    if (this.maxAge) {\n      this.expires = new Date(Date.now() + this.maxAge);\n    }\n    if (this.path) {\n      header += \"; path=\".concat(this.path);\n    }\n    if (this.expires) {\n      header += \"; expires=\".concat(this.expires.toUTCString());\n    }\n    if (this.domain) {\n      header += \"; domain=\".concat(this.domain);\n    }\n    // TODO: samesite=none by default (?)\n    header += \"; SameSite=\".concat(this.sameSite === true ? 'strict' : 'None');\n    // TODO: On by default\n    if (this.secure) {\n      header += '; secure';\n    }\n    if (this.httpOnly) {\n      header += '; httponly';\n    }\n    return header;\n  };\n  return Cookie;\n}();\nfunction getPattern(name) {\n  return new RegExp(\"(?:^|;) *\".concat(name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&'), \"=([^;]*)\"));\n}\nfunction pushCookie(headers, cookie) {\n  if (cookie.overwrite) {\n    for (var i = headers.length - 1; i >= 0; i--) {\n      if (headers[i].indexOf(\"\".concat(cookie.name, \"=\")) === 0) {\n        headers.splice(i, 1);\n      }\n    }\n  }\n  headers.push(cookie.toHeader());\n}\nfunction omit(obj) {\n  var values = [];\n  for (var _i = 1; _i < arguments.length; _i++) {\n    values[_i - 1] = arguments[_i];\n  }\n  var newObject = Object.assign({}, obj);\n  for (var _a = 0, values_1 = values; _a < values_1.length; _a++) {\n    var key = values_1[_a];\n    delete newObject[key];\n  }\n  return newObject;\n}\n\n/**\r\n * @credit https://stackoverflow.com/a/2117523\r\n */\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0,\n      v = c == 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n/**\r\n * Slightly cleaner and smaller UUIDs\r\n */\nfunction uuid() {\n  return uuidv4().replace(/-/g, '');\n}\nfunction emptyUrl() {\n  return {\n    query: null,\n    port: null,\n    auth: null,\n    hash: null,\n    host: null,\n    hostname: null,\n    href: null,\n    path: null,\n    pathname: null,\n    protocol: null,\n    search: null,\n    slashes: null\n  };\n}\n// Replacement for `url.parse` using `URL` global object that works with relative paths.\n// Assumptions: this function operates in a NodeJS environment.\nfunction parse$1(url) {\n  var _a;\n  var out = emptyUrl();\n  var u;\n  var pathOnly = url === '' || url[0] === '/';\n  if (pathOnly) {\n    u = new URL(url, 'http://0.0.0.0/');\n    out.href = u.href;\n    out.href = (_a = out.href) === null || _a === void 0 ? void 0 : _a.slice(14); // remove 'http://0.0.0.0/'\n  } else {\n    u = new URL(url);\n    out.href = u.href;\n    out.port = u.port === '' ? null : u.port;\n    out.hash = u.hash === '' ? null : u.hash;\n    out.host = u.host;\n    out.hostname = u.hostname;\n    out.href = u.href;\n    out.pathname = u.pathname;\n    out.protocol = u.protocol;\n    out.slashes = url[u.protocol.length] === '/'; // check if the mimetype is proceeded by a slash\n  }\n  out.search = u.search;\n  out.query = u.search.slice(1); // remove '?'\n  out.path = \"\".concat(u.pathname).concat(u.search);\n  out.pathname = u.pathname;\n  return out;\n}\n\n/**\r\n * Safe conversion to error type. Intended to be used in catch blocks where the\r\n *  value is not guaranteed to be an error.\r\n *\r\n *  @example\r\n *  try {\r\n *    throw new Error('Something went wrong')\r\n *  }\r\n *  catch (err: unknown) {\r\n *    const error: Error = toError(err)\r\n *  }\r\n */\nfunction toError(err) {\n  if (err instanceof Error) return err;\n  return new Error(String(err));\n}\nvar DEFAULT_API_VERSION = 'v3';\nvar SDK_VERSION = '6.1.2';\nfunction datePlusMinutes(minutes) {\n  if (minutes === void 0) {\n    minutes = 30;\n  }\n  return new Date(Date.now() + minutes * 60000);\n}\nvar isPositiveNumber = function (thing) {\n  return typeof thing === 'number' && !isNaN(thing) && thing >= 0;\n};\nvar isReactNative = typeof navigator === 'object' && navigator.product === 'ReactNative';\nvar validEnvList = ['production', 'qa', 'test', 'development', 'dev', 'cdn-qa', 'cloud', 'fast', 'cdn2', 'cdn-prod'];\nfunction getQueryParam(url, variable) {\n  var query = url.split('?')[1] || '';\n  var vars = query.split('&');\n  for (var i = 0; i < vars.length; i++) {\n    var pair = vars[i].split('=');\n    if (decodeURIComponent(pair[0]) === variable) {\n      return decodeURIComponent(pair[1]);\n    }\n  }\n  return null;\n}\nvar urlParser = {\n  parse: function (url) {\n    var el = document.createElement('a');\n    el.href = url;\n    var out = {};\n    var props = ['username', 'password', 'host', 'hostname', 'port', 'protocol', 'origin', 'pathname', 'search', 'hash'];\n    for (var _i = 0, props_1 = props; _i < props_1.length; _i++) {\n      var prop = props_1[_i];\n      out[prop] = el[prop];\n    }\n    // IE 11 pathname handling workaround\n    // (IE omits preceeding '/', unlike other browsers)\n    if ((out.pathname || out.pathname === '') && typeof out.pathname === 'string' && out.pathname.indexOf('/') !== 0) {\n      out.pathname = '/' + out.pathname;\n    }\n    return out;\n  }\n};\nvar parse = isReactNative ? function () {\n  return emptyUrl();\n} : typeof window === 'object' ? urlParser.parse : parse$1;\nfunction setCookie(name, value, expires) {\n  try {\n    var expiresString = '';\n    // TODO: need to know if secure server side\n    if (expires) {\n      expiresString = '; expires=' + expires.toUTCString();\n    }\n    var secure = isBrowser ? location.protocol === 'https:' : true;\n    document.cookie = name + '=' + (value || '') + expiresString + '; path=/' + (secure ? '; secure; SameSite=None' : '');\n  } catch (err) {\n    console.warn('Could not set cookie', err);\n  }\n}\nfunction getCookie(name) {\n  try {\n    return decodeURIComponent(document.cookie.replace(new RegExp('(?:(?:^|.*;)\\\\s*' + encodeURIComponent(name).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'), '$1')) || null;\n  } catch (err) {\n    console.warn('Could not get cookie', err);\n  }\n}\nfunction size(object) {\n  return Object.keys(object).length;\n}\nfunction find(target, callback) {\n  var list = target;\n  // Makes sures is always has an positive integer as length.\n  var length = list.length >>> 0;\n  var thisArg = arguments[1];\n  for (var i = 0; i < length; i++) {\n    var element = list[i];\n    if (callback.call(thisArg, element, i, list)) {\n      return element;\n    }\n  }\n}\nvar sessionStorageKey = 'builderSessionId';\nvar localStorageKey = 'builderVisitorId';\nvar isBrowser = typeof window !== 'undefined' && !isReactNative;\nvar isIframe = isBrowser && window.top !== window.self;\nfunction BuilderComponent(info) {\n  if (info === void 0) {\n    info = {};\n  }\n  return Builder.Component(info);\n}\nvar Builder = /** @class */function () {\n  function Builder(apiKey, request, response, forceNewInstance, authToken, apiVersion) {\n    if (apiKey === void 0) {\n      apiKey = null;\n    }\n    if (forceNewInstance === void 0) {\n      forceNewInstance = false;\n    }\n    if (authToken === void 0) {\n      authToken = null;\n    }\n    var _this = this;\n    this.request = request;\n    this.response = response;\n    this.eventsQueue = [];\n    this.throttledClearEventsQueue = throttle(function () {\n      _this.processEventsQueue();\n      // Extend the session cookie\n      _this.setCookie(sessionStorageKey, _this.sessionId, datePlusMinutes(30));\n    }, 5);\n    this.env = 'production';\n    this.sessionId = this.getSessionId();\n    this.targetContent = true;\n    this.contentPerRequest = 1;\n    // TODO: make array or function\n    this.allowCustomFonts = true;\n    this.cookies = null;\n    // TODO: api options object\n    this.cachebust = false;\n    this.overrideParams = '';\n    this.noCache = false;\n    this.preview = false;\n    /**\r\n     * Dictates which API endpoint is used when fetching content. Allows `'content'` and `'query'`.\r\n     * Defaults to `'query'`.\r\n     */\n    this.apiEndpoint$ = new BehaviorSubject('query');\n    this.apiVersion$ = new BehaviorSubject(undefined);\n    this.canTrack$ = new BehaviorSubject(!this.browserTrackingDisabled);\n    this.hasOverriddenCanTrack = false;\n    this.apiKey$ = new BehaviorSubject(null);\n    this.authToken$ = new BehaviorSubject(null);\n    this.userAttributesChanged = new BehaviorSubject(null);\n    this.editingMode$ = new BehaviorSubject(isIframe);\n    // TODO: decorator to do this stuff with the get/set (how do with typing too? compiler?)\n    this.editingModel$ = new BehaviorSubject(null);\n    this.userAgent = typeof navigator === 'object' && navigator.userAgent || '';\n    this.trackingHooks = [];\n    // Set this to control the userId\n    // TODO: allow changing it mid session and updating existing data to be associated\n    // e.g. for when a user navigates and then logs in\n    this.visitorId = this.getVisitorId();\n    this.autoTrack = !Builder.isBrowser ? false : !this.isDevelopmentEnv && !(Builder.isBrowser && location.search.indexOf('builder.preview=') !== -1);\n    this.trackingUserAttributes = {};\n    this.blockContentLoading = '';\n    this.observersByKey = {};\n    this.noEditorUpdates = {};\n    this.overrides = {};\n    this.queryOptions = {};\n    this.getContentQueue = null;\n    this.priorContentQueue = null;\n    this.testCookiePrefix = 'builder.tests';\n    this.cookieQueue = [];\n    // TODO: use a window variable for this perhaps, e.g. bc webcomponents may be loading builder twice\n    // with it's and react (use rollup build to fix)\n    if (Builder.isBrowser && !forceNewInstance && Builder.singletonInstance) {\n      return Builder.singletonInstance;\n    }\n    if (this.request && this.response) {\n      this.setUserAgent(this.request.headers['user-agent'] || '');\n      this.cookies = new Cookies(this.request, this.response);\n    }\n    if (apiKey) {\n      this.apiKey = apiKey;\n    }\n    if (apiVersion) {\n      this.apiVersion = apiVersion;\n    }\n    if (authToken) {\n      this.authToken = authToken;\n    }\n    if (isBrowser) {\n      if (Builder.isEditing) {\n        this.bindMessageListeners();\n        parent.postMessage({\n          type: 'builder.animatorOptions',\n          data: {\n            options: {\n              version: 2\n            }\n          }\n        }, '*');\n      }\n      // TODO: postmessage to parent the builder info for every package\n      // type: 'builder.sdk', data: { name: '@builder.io/react', version: '0.1.23' }\n      // (window as any).BUILDER_VERSION = Builder.VERSION;\n      // Ensure always one Builder global singleton\n      // TODO: some people won't want this, e.g. rakuten\n      // Maybe hide this behind symbol or on document, etc\n      // if ((window as any).Builder) {\n      //   Builder.components = (window as any).Builder.components;\n      // } else {\n      //   (window as any).Builder = Builder;\n      // }\n    }\n    if (isIframe) {\n      this.messageFrameLoaded();\n    }\n    // TODO: on destroy clear subscription\n    this.canTrack$.subscribe(function (value) {\n      if (value) {\n        if (typeof sessionStorage !== 'undefined') {\n          try {\n            if (!sessionStorage.getItem(sessionStorageKey)) {\n              sessionStorage.setItem(sessionStorageKey, _this.sessionId);\n            }\n          } catch (err) {\n            console.debug('Session storage error', err);\n          }\n        }\n        if (_this.eventsQueue.length) {\n          _this.throttledClearEventsQueue();\n        }\n        if (_this.cookieQueue.length) {\n          _this.cookieQueue.forEach(function (item) {\n            _this.setCookie(item[0], item[1]);\n          });\n          _this.cookieQueue.length = 0;\n        }\n      }\n    });\n    if (isBrowser) {\n      // TODO: defer so subclass constructor runs and injects location service\n      this.setTestsFromUrl();\n      // TODO: do this on every request send?\n      this.getOverridesFromQueryString();\n      // cookies used in personalization container script, so need to set before hydration to match script result\n      var userAttrCookie = this.getCookie(Builder.attributesCookieName);\n      if (userAttrCookie) {\n        try {\n          var attributes = JSON.parse(userAttrCookie);\n          this.setUserAttributes(attributes);\n        } catch (err) {\n          console.debug('Error parsing user attributes cookie', err);\n        }\n      }\n    }\n  }\n  Builder.register = function (type, info) {\n    if (type === 'plugin') {\n      info = this.serializeIncludingFunctions(info, true);\n    }\n    // TODO: all must have name and can't conflict?\n    var typeList = this.registry[type];\n    if (!typeList) {\n      typeList = this.registry[type] = [];\n    }\n    typeList.push(info);\n    if (Builder.isBrowser) {\n      var message = {\n        type: 'builder.register',\n        data: {\n          type: type,\n          info: info\n        }\n      };\n      try {\n        parent.postMessage(message, '*');\n        if (parent !== window) {\n          window.postMessage(message, '*');\n        }\n      } catch (err) {\n        console.debug('Could not postmessage', err);\n      }\n    }\n    this.registryChange.next(this.registry);\n  };\n  Builder.registerEditor = function (info) {\n    if (Builder.isBrowser) {\n      window.postMessage({\n        type: 'builder.registerEditor',\n        data: omit(info, 'component')\n      }, '*');\n      var hostname = location.hostname;\n      if (!Builder.isTrustedHost(hostname)) {\n        console.error('Builder.registerEditor() called in the wrong environment! You cannot load custom editors from your app, they must be loaded through the Builder.io app itself. Follow the readme here for more details: https://github.com/builderio/builder/tree/master/plugins/cloudinary or contact chat us in our Spectrum community for help: https://spectrum.chat/builder');\n      }\n    }\n    this.editors.push(info);\n  };\n  Builder.registerPlugin = function (info) {\n    this.plugins.push(info);\n  };\n  Builder.registerAction = function (action) {\n    var _a;\n    this.actions.push(action);\n    if (Builder.isBrowser) {\n      var actionClone = JSON.parse(JSON.stringify(action));\n      if (action.action) {\n        actionClone.action = action.action.toString();\n      }\n      (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n        type: 'builder.registerAction',\n        data: actionClone\n      }, '*');\n    }\n  };\n  Builder.registerTrustedHost = function (host) {\n    this.trustedHosts.push(host);\n  };\n  /**\r\n   * @param context @type {import('isolated-vm').Context}\r\n   * Use this function to control the execution context of custom code on the server.\r\n   * const ivm = require('isolated-vm');\r\n   * const isolate = new ivm.Isolate({ memoryLimit: 128 });\r\n   * const context = isolate.createContextSync();\r\n   * Builder.setServerContext(context);\r\n   */\n  Builder.setServerContext = function (context) {\n    this.serverContext = context;\n  };\n  Builder.isTrustedHost = function (hostname) {\n    var isTrusted = this.trustedHosts.findIndex(function (trustedHost) {\n      return trustedHost.startsWith('*.') ? hostname.endsWith(trustedHost.slice(1)) : trustedHost === hostname;\n    }) > -1;\n    return isTrusted;\n  };\n  Builder.isTrustedHostForEvent = function (event) {\n    if (event.origin === 'null') {\n      return false;\n    }\n    var url = parse(event.origin);\n    return url.hostname && Builder.isTrustedHost(url.hostname);\n  };\n  Builder.runAction = function (action) {\n    // TODO\n    var actionObject = typeof action === 'string' ? find(this.actions, function (item) {\n      return item.name === action;\n    }) : action;\n    if (!actionObject) {\n      throw new Error(\"Action not found: \".concat(action));\n    }\n  };\n  Builder.fields = function (name, fields) {\n    var _a;\n    (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: 'builder.fields',\n      data: {\n        name: name,\n        fields: fields\n      }\n    }, '*');\n  };\n  /**\r\n   * @deprecated\r\n   * @hidden\r\n   *\r\n   * Use Builder.register('editor.settings', {}) instead.\r\n   */\n  Builder.set = function (settings) {\n    Builder.register('editor.settings', settings);\n  };\n  Builder.import = function (packageName) {\n    if (!Builder.isBrowser) {\n      // TODO: server side support *maybe*\n      console.warn('Builder.import used on the server - this should only be used in the browser');\n      return;\n    }\n    var System = window.System;\n    if (!System) {\n      console.warn('System.js not available. Please include System.js when using Builder.import');\n      return;\n    }\n    return System.import(\"https://cdn.builder.io/systemjs/\".concat(packageName));\n  };\n  Object.defineProperty(Builder, \"editingPage\", {\n    // useCdnApi = false;\n    get: function () {\n      return this._editingPage;\n    },\n    set: function (editingPage) {\n      this._editingPage = editingPage;\n      if (isBrowser && isIframe) {\n        if (editingPage) {\n          document.body.classList.add('builder-editing-page');\n        } else {\n          document.body.classList.remove('builder-editing-page');\n        }\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.serializeIncludingFunctions = function (info, isForPlugin) {\n    var serializeFn = function (fnValue) {\n      var fnStr = fnValue.toString().trim();\n      // we need to account for a few different fn syntaxes:\n      // 1. `function name(args) => {code}`\n      // 2. `name(args) => {code}`\n      // 3. `(args) => {}`\n      // 4. `args => {}`\n      // 5. `async function(args) {code}`\n      // 6. `async (args) => {}`\n      // 7. `async args => {}`\n      var isArrowWithoutParens = /^[a-zA-Z0-9_]+\\s*=>/i.test(fnStr);\n      var appendFunction = !fnStr.startsWith('function') && !fnStr.startsWith('async') && !fnStr.startsWith('(') && !isArrowWithoutParens;\n      return \"return (\".concat(appendFunction ? 'function ' : '').concat(fnStr, \").apply(this, arguments)\");\n    };\n    var objToReturn = JSON.parse(JSON.stringify(info, function (key, value) {\n      var shouldNotSerializeFn = isForPlugin && key === 'onSave';\n      if (typeof value === 'function' && !shouldNotSerializeFn) {\n        return serializeFn(value);\n      }\n      return value;\n    }));\n    if (isForPlugin) {\n      objToReturn.onSave = info.onSave;\n    }\n    return objToReturn;\n  };\n  Builder.prepareComponentSpecToSend = function (spec) {\n    return __assign(__assign({}, this.serializeIncludingFunctions(spec)), {\n      class: undefined\n    });\n  };\n  Builder.registerBlock = function (component, options) {\n    this.registerComponent(component, options);\n  };\n  Builder.registerComponent = function (component, options) {\n    var _a;\n    var spec = __assign(__assign({\n      class: component\n    }, component.builderOptions), options);\n    this.addComponent(spec);\n    var editable = options.models && this.singletonInstance.editingModel ? isBrowser && options.models.includes(this.singletonInstance.editingModel) : isBrowser;\n    if (editable) {\n      var sendSpec = this.prepareComponentSpecToSend(spec);\n      (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n        type: 'builder.registerComponent',\n        data: sendSpec\n      }, '*');\n    }\n  };\n  Builder.addComponent = function (component) {\n    var current = find(this.components, function (item) {\n      return item.name === component.name;\n    });\n    if (current) {\n      // FIXME: why does sometimes we get an extra post without class - probably\n      // from postMessage handler wrong in some place\n      if (current.class && !component.class) {\n        return;\n      }\n      this.components.splice(this.components.indexOf(current), 1, component);\n    } else {\n      this.components.push(component);\n    }\n  };\n  // TODO: style guide, etc off this system as well?\n  Builder.component = function (info) {\n    var _this = this;\n    if (info === void 0) {\n      info = {};\n    }\n    return function (component) {\n      var _a;\n      var spec = __assign(__assign({}, info), {\n        class: component\n      });\n      if (!spec.name) {\n        spec.name = component.name;\n      }\n      _this.addComponent(spec);\n      var sendSpec = _this.prepareComponentSpecToSend(spec);\n      // TODO: serialize component name and inputs\n      if (isBrowser) {\n        (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n          type: 'builder.registerComponent',\n          data: sendSpec\n        }, '*');\n      }\n      return component;\n    };\n  };\n  Object.defineProperty(Builder, \"Component\", {\n    get: function () {\n      return this.component;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.processEventsQueue = function () {\n    if (!this.eventsQueue.length) {\n      return;\n    }\n    var events = this.eventsQueue;\n    this.eventsQueue = [];\n    var fullUserAttributes = __assign(__assign({}, Builder.overrideUserAttributes), this.trackingUserAttributes);\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n      if (!event_1.data.metadata) {\n        event_1.data.metadata = {};\n      }\n      if (!event_1.data.metadata.user) {\n        event_1.data.metadata.user = {};\n      }\n      Object.assign(event_1.data.metadata.user, fullUserAttributes, event_1.data.metadata.user);\n    }\n    var host = this.host;\n    getFetch()(\"\".concat(host, \"/api/v1/track\"), {\n      method: 'POST',\n      body: JSON.stringify({\n        events: events\n      }),\n      headers: __assign({\n        'content-type': 'application/json'\n      }, this.getSdkHeaders()),\n      mode: 'cors'\n    }).catch(function () {\n      // Not the end of the world\n    });\n  };\n  Object.defineProperty(Builder.prototype, \"browserTrackingDisabled\", {\n    get: function () {\n      return Builder.isBrowser && Boolean(window.builderNoTrack || !navigator.cookieEnabled);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"canTrack\", {\n    get: function () {\n      return this.canTrack$.value;\n    },\n    set: function (canTrack) {\n      this.hasOverriddenCanTrack = true;\n      if (this.canTrack !== canTrack) {\n        this.canTrack$.next(canTrack);\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"apiVersion\", {\n    get: function () {\n      return this.apiVersion$.value;\n    },\n    set: function (apiVersion) {\n      if (this.apiVersion !== apiVersion) {\n        this.apiVersion$.next(apiVersion);\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"apiEndpoint\", {\n    get: function () {\n      return this.apiEndpoint$.value;\n    },\n    set: function (apiEndpoint) {\n      if (this.apiEndpoint !== apiEndpoint) {\n        this.apiEndpoint$.next(apiEndpoint);\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"editingMode\", {\n    get: function () {\n      return this.editingMode$.value;\n    },\n    set: function (value) {\n      if (value !== this.editingMode) {\n        this.editingMode$.next(value);\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"editingModel\", {\n    get: function () {\n      return this.editingModel$.value;\n    },\n    set: function (value) {\n      if (value !== this.editingModel) {\n        this.editingModel$.next(value);\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.findParentElement = function (target, callback, checkElement) {\n    if (checkElement === void 0) {\n      checkElement = true;\n    }\n    if (!(target instanceof HTMLElement)) {\n      return null;\n    }\n    var parent = checkElement ? target : target.parentElement;\n    do {\n      if (!parent) {\n        return null;\n      }\n      var matches = callback(parent);\n      if (matches) {\n        return parent;\n      }\n    } while (parent = parent.parentElement);\n    return null;\n  };\n  Builder.prototype.findBuilderParent = function (target) {\n    return this.findParentElement(target, function (el) {\n      var id = el.getAttribute('builder-id') || el.id;\n      return Boolean(id && id.indexOf('builder-') === 0);\n    });\n  };\n  Builder.prototype.setUserAgent = function (userAgent) {\n    this.userAgent = userAgent || '';\n  };\n  /**\r\n   * Set a hook to modify events being tracked from builder, such as impressions and clicks\r\n   *\r\n   * For example, to track the model ID of each event associated with content for querying\r\n   * by mode, you can do\r\n   *\r\n   *    builder.setTrackingHook((event, context) => {\r\n   *      if (context.content) {\r\n   *        event.data.metadata.modelId = context.content.modelId\r\n   *      }\r\n   *    })\r\n   */\n  Builder.prototype.setTrackingHook = function (hook) {\n    this.trackingHooks.push(hook);\n  };\n  Builder.prototype.track = function (eventName, properties, context) {\n    if (properties === void 0) {\n      properties = {};\n    }\n    // TODO: queue up track requests and fire them off when canTrack set to true - otherwise may get lots of clicks with no impressions\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    var apiKey = this.apiKey;\n    if (!apiKey) {\n      console.error('Builder integration error: Looks like the Builder SDK has not been initialized properly (your API key has not been set). Make sure you are calling `builder.init(\"YOUR-API-KEY\");` as early as possible in your application\\'s code.');\n      return;\n    }\n    var eventData = JSON.parse(JSON.stringify({\n      type: eventName,\n      data: __assign(__assign({}, omit(properties, 'meta')), {\n        metadata: __assign(__assign({\n          sdkVersion: Builder.VERSION,\n          url: location.href\n        }, properties.meta), properties.metadata),\n        ownerId: apiKey,\n        userAttributes: this.getUserAttributes(),\n        sessionId: this.sessionId,\n        visitorId: this.visitorId\n      })\n    }));\n    for (var _i = 0, _a = this.trackingHooks; _i < _a.length; _i++) {\n      var hook = _a[_i];\n      var returnValue = hook(eventData, context || {});\n      if (returnValue) {\n        eventData = returnValue;\n      }\n    }\n    // batch events\n    this.eventsQueue.push(eventData);\n    if (this.canTrack) {\n      this.throttledClearEventsQueue();\n    }\n  };\n  Builder.prototype.getSessionId = function () {\n    var _this = this;\n    var sessionId = null;\n    try {\n      if (Builder.isBrowser && typeof sessionStorage !== 'undefined') {\n        sessionId = this.getCookie(sessionStorageKey);\n      }\n    } catch (err) {\n      console.debug('Session storage error', err);\n      // It's ok\n    }\n    if (!sessionId) {\n      sessionId = uuid();\n    }\n    // Give the app a second to start up and set canTrack to false if needed\n    if (Builder.isBrowser) {\n      setTimeout(function () {\n        try {\n          if (_this.canTrack) {\n            _this.setCookie(sessionStorageKey, sessionId, datePlusMinutes(30));\n          }\n        } catch (err) {\n          console.debug('Cookie setting error', err);\n        }\n      });\n    }\n    return sessionId;\n  };\n  Builder.prototype.getVisitorId = function () {\n    var _this = this;\n    if (this.visitorId) {\n      return this.visitorId;\n    }\n    var visitorId = null;\n    try {\n      if (Builder.isBrowser && typeof localStorage !== 'undefined') {\n        // TODO: cookie instead?\n        visitorId = localStorage.getItem(localStorageKey);\n      }\n    } catch (err) {\n      console.debug('Local storage error', err);\n      // It's ok\n    }\n    if (!visitorId) {\n      visitorId = uuid();\n    }\n    this.visitorId = visitorId;\n    // Give the app a second to start up and set canTrack to false if needed\n    if (Builder.isBrowser) {\n      setTimeout(function () {\n        try {\n          if (_this.canTrack && typeof localStorage !== 'undefined' && visitorId) {\n            localStorage.setItem(localStorageKey, visitorId);\n          }\n        } catch (err) {\n          console.debug('Session storage error', err);\n        }\n      });\n    }\n    return visitorId;\n  };\n  Builder.prototype.trackImpression = function (contentId, variationId, properties, context) {\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    // TODO: use this.track method\n    this.track('impression', {\n      contentId: contentId,\n      variationId: variationId !== contentId ? variationId : undefined,\n      metadata: properties\n    }, context);\n  };\n  Builder.prototype.trackConversion = function (amount, contentId, variationId, customProperties, context) {\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    var meta = typeof contentId === 'object' ? contentId : customProperties;\n    var useContentId = typeof contentId === 'string' ? contentId : undefined;\n    this.track('conversion', {\n      amount: amount,\n      variationId: variationId,\n      meta: meta,\n      contentId: useContentId\n    }, context);\n  };\n  Object.defineProperty(Builder.prototype, \"isDevelopmentEnv\", {\n    // TODO: set this for QA\n    get: function () {\n      // Automatic determining of development environment\n      return Builder.isIframe || Builder.isBrowser && (location.hostname === 'localhost' || location.port !== '') || this.env !== 'production';\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.trackInteraction = function (contentId, variationId, alreadyTrackedOne, event, context) {\n    if (alreadyTrackedOne === void 0) {\n      alreadyTrackedOne = false;\n    }\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    var target = event && event.target;\n    var targetBuilderElement = target && this.findBuilderParent(target);\n    function round(num) {\n      return Math.round(num * 1000) / 1000;\n    }\n    var metadata = {};\n    if (event) {\n      var clientX = event.clientX,\n        clientY = event.clientY;\n      if (target) {\n        var targetRect = target.getBoundingClientRect();\n        var xOffset = clientX - targetRect.left;\n        var yOffset = clientY - targetRect.top;\n        var xRatio = round(xOffset / targetRect.width);\n        var yRatio = round(yOffset / targetRect.height);\n        metadata.targetOffset = {\n          x: xRatio,\n          y: yRatio\n        };\n      }\n      if (targetBuilderElement) {\n        var targetRect = targetBuilderElement.getBoundingClientRect();\n        var xOffset = clientX - targetRect.left;\n        var yOffset = clientY - targetRect.top;\n        var xRatio = round(xOffset / targetRect.width);\n        var yRatio = round(yOffset / targetRect.height);\n        metadata.builderTargetOffset = {\n          x: xRatio,\n          y: yRatio\n        };\n      }\n    }\n    var builderId = targetBuilderElement && (targetBuilderElement.getAttribute('builder-id') || targetBuilderElement.id);\n    if (builderId && targetBuilderElement) {\n      metadata.builderElementIndex = [].slice.call(document.getElementsByClassName(builderId)).indexOf(targetBuilderElement);\n    }\n    this.track('click', {\n      contentId: contentId,\n      metadata: metadata,\n      variationId: variationId !== contentId ? variationId : undefined,\n      unique: !alreadyTrackedOne,\n      targetBuilderElement: builderId || undefined\n    }, context);\n  };\n  Builder.prototype.component = function (info) {\n    if (info === void 0) {\n      info = {};\n    }\n    return Builder.component(info);\n  };\n  Object.defineProperty(Builder.prototype, \"apiKey\", {\n    get: function () {\n      return this.apiKey$.value;\n    },\n    set: function (key) {\n      this.apiKey$.next(key);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Builder.prototype, \"authToken\", {\n    get: function () {\n      return this.authToken$.value;\n    },\n    set: function (token) {\n      this.authToken$.next(token);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.modifySearch = function (search) {\n    return search.replace(/(^|&|\\?)(builder_.*?)=/gi, function (_match, group1, group2) {\n      return group1 + group2.replace(/_/g, '.') + '=';\n    });\n  };\n  Builder.prototype.setTestsFromUrl = function () {\n    var search = this.getLocation().search;\n    try {\n      var params = QueryString.parseDeep(this.modifySearch(search || '').substr(1));\n      var tests = params.builder && params.builder.tests;\n      if (tests && typeof tests === 'object') {\n        for (var key in tests) {\n          if (tests.hasOwnProperty(key)) {\n            this.setTestCookie(key, tests[key]);\n          }\n        }\n      }\n    } catch (e) {\n      console.debug('Error parsing tests from URL', e);\n    }\n  };\n  Builder.prototype.resetOverrides = function () {\n    // Ugly - pass down instances per request instead using react context\n    // or use builder.get('foo', { req, res }) in react...........\n    Builder.overrideUserAttributes = {};\n    this.cachebust = false;\n    this.noCache = false;\n    this.preview = false;\n    this.editingModel = null;\n    this.overrides = {};\n    this.env = 'production';\n    this.userAgent = '';\n    this.request = undefined;\n    this.response = undefined;\n  };\n  Builder.prototype.getOverridesFromQueryString = function () {\n    var location = this.getLocation();\n    try {\n      var params = QueryString.parseDeep(this.modifySearch(location.search || '').substr(1));\n      var builder = params.builder;\n      if (builder) {\n        var userAttributes = builder.userAttributes,\n          overrides = builder.overrides,\n          env = builder.env,\n          host = builder.host,\n          api = builder.api,\n          cachebust = builder.cachebust,\n          noCache = builder.noCache,\n          preview = builder.preview,\n          editing = builder.editing,\n          frameEditing = builder.frameEditing,\n          options = builder.options,\n          overrideParams = builder.params;\n        if (userAttributes) {\n          this.setUserAttributes(userAttributes);\n        }\n        if (options) {\n          // picking only locale, includeRefs, and enrich for now\n          this.queryOptions = __assign(__assign(__assign({}, options.locale && {\n            locale: options.locale\n          }), options.includeRefs && {\n            includeRefs: options.includeRefs\n          }), options.enrich && {\n            enrich: options.enrich\n          });\n        }\n        if (overrides) {\n          this.overrides = overrides;\n        }\n        if (validEnvList.indexOf(env || api) > -1) {\n          this.env = env || api;\n        }\n        if (Builder.isEditing) {\n          var editingModel = frameEditing || editing || preview;\n          if (editingModel && editingModel !== 'true') {\n            this.editingModel = editingModel;\n          }\n        }\n        if (cachebust) {\n          this.cachebust = true;\n        }\n        if (noCache) {\n          this.noCache = true;\n        }\n        if (preview) {\n          this.preview = true;\n        }\n        if (params) {\n          this.overrideParams = overrideParams;\n        }\n      }\n    } catch (e) {\n      console.debug('Error parsing overrides from URL', e);\n    }\n  };\n  Builder.prototype.messageFrameLoaded = function () {\n    var _a;\n    (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: 'builder.loaded',\n      data: {\n        value: true\n      }\n    }, '*');\n  };\n  Builder.prototype.bindMessageListeners = function () {\n    var _this = this;\n    addEventListener('message', function (event) {\n      var _a, _b, _c, _d;\n      var isTrusted = Builder.isTrustedHostForEvent(event);\n      if (!isTrusted) return;\n      var data = event.data;\n      if (data) {\n        switch (data.type) {\n          case 'builder.ping':\n            {\n              (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n                type: 'builder.pong',\n                data: {}\n              }, '*');\n              break;\n            }\n          case 'builder.register':\n            {\n              // TODO: possibly do this for all...\n              if (event.source === window) {\n                break;\n              }\n              var options = data.data;\n              if (!options) {\n                break;\n              }\n              var type = options.type,\n                info = options.info;\n              // TODO: all must have name and can't conflict?\n              var typeList = Builder.registry[type];\n              if (!typeList) {\n                typeList = Builder.registry[type] = [];\n              }\n              typeList.push(info);\n              Builder.registryChange.next(Builder.registry);\n              break;\n            }\n          case 'builder.settingsChange':\n            {\n              // TODO: possibly do this for all...\n              if (event.source === window) {\n                break;\n              }\n              var settings = data.data;\n              if (!settings) {\n                break;\n              }\n              Object.assign(Builder.settings, settings);\n              Builder.settingsChange.next(Builder.settings);\n              break;\n            }\n          case 'builder.registerEditor':\n            {\n              // TODO: possibly do this for all...\n              if (event.source === window) {\n                break;\n              }\n              var info_1 = data.data;\n              if (!info_1) {\n                break;\n              }\n              var hasComponent_1 = !!info_1.component;\n              Builder.editors.every(function (thisInfo, index) {\n                if (info_1.name === thisInfo.name) {\n                  if (thisInfo.component && !hasComponent_1) {\n                    return false;\n                  } else {\n                    Builder.editors[index] = thisInfo;\n                  }\n                  return false;\n                }\n                return true;\n              });\n              break;\n            }\n          case 'builder.triggerAnimation':\n            {\n              Builder.animator.triggerAnimation(data.data);\n              break;\n            }\n          case 'builder.contentUpdate':\n            var key = data.data.key || data.data.alias || data.data.entry || data.data.modelName;\n            var contentData = data.data.data; // hmmm...\n            var observer = _this.observersByKey[key];\n            if (observer && !_this.noEditorUpdates[key]) {\n              observer.next([contentData]);\n            }\n            break;\n          case 'builder.getComponents':\n            (_b = window.parent) === null || _b === void 0 ? void 0 : _b.postMessage({\n              type: 'builder.components',\n              data: Builder.components.map(function (item) {\n                return Builder.prepareComponentSpecToSend(item);\n              })\n            }, '*');\n            break;\n          case 'builder.editingModel':\n            _this.editingModel = data.data.model;\n            break;\n          case 'builder.registerComponent':\n            var componentData = data.data;\n            Builder.addComponent(componentData);\n            break;\n          case 'builder.blockContentLoading':\n            if (typeof data.data.model === 'string') {\n              _this.blockContentLoading = data.data.model;\n            }\n            break;\n          case 'builder.editingMode':\n            var editingMode = data.data;\n            if (editingMode) {\n              _this.editingMode = true;\n              document.body.classList.add('builder-editing');\n            } else {\n              _this.editingMode = false;\n              document.body.classList.remove('builder-editing');\n            }\n            break;\n          case 'builder.editingPageMode':\n            var editingPageMode = data.data;\n            Builder.editingPage = editingPageMode;\n            break;\n          case 'builder.overrideUserAttributes':\n            var userAttributes = data.data;\n            assign(Builder.overrideUserAttributes, userAttributes);\n            _this.flushGetContentQueue(true);\n            // TODO: refetch too\n            break;\n          case 'builder.overrideTestGroup':\n            var _e = data.data,\n              variationId = _e.variationId,\n              contentId = _e.contentId;\n            if (variationId && contentId) {\n              _this.setTestCookie(contentId, variationId);\n              _this.flushGetContentQueue(true);\n            }\n            break;\n          case 'builder.evaluate':\n            {\n              var text = data.data.text;\n              var args = data.data.arguments || [];\n              var id_1 = data.data.id;\n              // tslint:disable-next-line:no-function-constructor-with-string-args\n              var fn = new Function(text);\n              var result = void 0;\n              var error = null;\n              try {\n                result = fn.apply(_this, args);\n              } catch (err) {\n                error = toError(err);\n              }\n              if (error) {\n                (_c = window.parent) === null || _c === void 0 ? void 0 : _c.postMessage({\n                  type: 'builder.evaluateError',\n                  data: {\n                    id: id_1,\n                    error: error.message\n                  }\n                }, '*');\n              } else {\n                if (result && typeof result.then === 'function') {\n                  result.then(function (finalResult) {\n                    var _a;\n                    (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n                      type: 'builder.evaluateResult',\n                      data: {\n                        id: id_1,\n                        result: finalResult\n                      }\n                    }, '*');\n                  }).catch(console.error);\n                } else {\n                  (_d = window.parent) === null || _d === void 0 ? void 0 : _d.postMessage({\n                    type: 'builder.evaluateResult',\n                    data: {\n                      result: result,\n                      id: id_1\n                    }\n                  }, '*');\n                }\n              }\n              break;\n            }\n        }\n      }\n    });\n  };\n  Object.defineProperty(Builder.prototype, \"defaultCanTrack\", {\n    get: function () {\n      return Boolean(Builder.isBrowser && navigator.userAgent.trim() && !navigator.userAgent.match(/bot|crawler|spider|robot|crawling|prerender|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex|phantom|headless|selenium|puppeteer/i) && !this.browserTrackingDisabled);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.init = function (apiKey, canTrack, req, res, authToken, apiVersion) {\n    if (canTrack === void 0) {\n      canTrack = this.defaultCanTrack;\n    }\n    if (req) {\n      this.request = req;\n    }\n    if (res) {\n      this.response = res;\n    }\n    if (!this.hasOverriddenCanTrack) {\n      this.canTrack = canTrack;\n    }\n    this.apiKey = apiKey;\n    if (authToken) {\n      this.authToken = authToken;\n    }\n    if (apiVersion) {\n      this.apiVersion = apiVersion;\n    }\n    return this;\n  };\n  Object.defineProperty(Builder.prototype, \"previewingModel\", {\n    get: function () {\n      var search = this.getLocation().search;\n      var params = QueryString.parse((search || '').substr(1));\n      return params['builder.preview'];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  // TODO: allow adding location object as property and/or in constructor\n  Builder.prototype.getLocation = function () {\n    var _a;\n    var parsedLocation = {};\n    // in ssr mode\n    if (this.request) {\n      parsedLocation = parse((_a = this.request.url) !== null && _a !== void 0 ? _a : '');\n    } else if (typeof location === 'object') {\n      // in the browser\n      parsedLocation = parse(location.href);\n    }\n    // IE11 bug with parsed path being empty string\n    // causes issues with our user targeting\n    if (parsedLocation.pathname === '') {\n      parsedLocation.pathname = '/';\n    }\n    return parsedLocation;\n  };\n  Builder.prototype.getUserAttributes = function (userAgent) {\n    if (userAgent === void 0) {\n      userAgent = this.userAgent || '';\n    }\n    var isMobile = {\n      Android: function () {\n        return userAgent.match(/Android/i);\n      },\n      BlackBerry: function () {\n        return userAgent.match(/BlackBerry/i);\n      },\n      iOS: function () {\n        return userAgent.match(/iPhone|iPod/i);\n      },\n      Opera: function () {\n        return userAgent.match(/Opera Mini/i);\n      },\n      Windows: function () {\n        return userAgent.match(/IEMobile/i) || userAgent.match(/WPDesktop/i);\n      },\n      any: function () {\n        return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows();\n      }\n    };\n    var isTablet = userAgent.match(/Tablet|iPad/i);\n    var url = this.getLocation();\n    return __assign({\n      urlPath: url.pathname,\n      host: url.host || url.hostname,\n      // TODO: maybe an option to choose to target off of mobile/tablet/desktop or just mobile/desktop\n      device: isTablet ? 'tablet' : isMobile.any() ? 'mobile' : 'desktop'\n    }, Builder.overrideUserAttributes);\n  };\n  Builder.prototype.setUserAttributes = function (options) {\n    assign(Builder.overrideUserAttributes, options);\n    if (this.canTrack) {\n      this.setCookie(Builder.attributesCookieName, JSON.stringify(this.getUserAttributes()));\n    }\n    this.userAttributesChanged.next(options);\n  };\n  /**\r\n   * Set user attributes just for tracking purposes.\r\n   *\r\n   * Do this so properties exist on event objects for querying insights, but\r\n   * won't affect targeting\r\n   *\r\n   * Use this when you want to track properties but don't need to target off\r\n   * of them to optimize cache efficiency\r\n   */\n  Builder.prototype.setTrackingUserAttributes = function (attributes) {\n    assign(this.trackingUserAttributes, attributes);\n  };\n  Builder.prototype.get = function (modelName, options) {\n    var _a;\n    if (options === void 0) {\n      options = {};\n    }\n    var instance = this;\n    var finalLocale = options.locale || ((_a = options.userAttributes) === null || _a === void 0 ? void 0 : _a.locale) || this.getUserAttributes().locale;\n    if (!('noTraverse' in options)) {\n      options.noTraverse = false;\n    }\n    var finalOptions = __assign(__assign({}, options), finalLocale && {\n      locale: String(finalLocale),\n      userAttributes: __assign({\n        locale: String(finalLocale)\n      }, options.userAttributes)\n    });\n    if (!Builder.isBrowser) {\n      instance = new Builder(options.apiKey || this.apiKey, options.req, options.res, undefined, options.authToken || this.authToken, options.apiVersion || this.apiVersion);\n      instance.apiEndpoint = this.apiEndpoint;\n      instance.setUserAttributes(this.getUserAttributes());\n    } else {\n      // NOTE: All these are when .init is not called and the customer\n      // directly calls .get on the singleton instance of Builder\n      if (options.apiKey && !this.apiKey) {\n        this.apiKey = options.apiKey;\n      }\n      if (options.authToken && !this.authToken) {\n        this.authToken = options.authToken;\n      }\n      if (options.apiVersion && !this.apiVersion) {\n        this.apiVersion = options.apiVersion;\n      }\n    }\n    return instance.queueGetContent(modelName, finalOptions).map(/* map( */function (matches) {\n      var match = matches && matches[0];\n      if (Builder.isStatic) {\n        return match;\n      }\n      var matchData = match && match.data;\n      if (!matchData) {\n        return null;\n      }\n      if (typeof matchData.blocksString !== 'undefined') {\n        matchData.blocks = JSON.parse(matchData.blocksString);\n        delete matchData.blocksString;\n      }\n      return {\n        // TODO: add ab test info here and other high level stuff\n        data: matchData,\n        id: match.id,\n        variationId: match.testVariationId || match.variationId || null,\n        testVariationId: match.testVariationId || match.variationId || null,\n        testVariationName: match.testVariationName || null,\n        lastUpdated: match.lastUpdated || null\n      };\n    });\n    // );\n  };\n  // TODO: entry id in options\n  Builder.prototype.queueGetContent = function (modelName, options) {\n    var _this = this;\n    if (options === void 0) {\n      options = {};\n    }\n    // TODO: if query do modelName + query\n    var key = options.key || options.alias ||\n    // TODO: SDKs only pass entry key when given to them, and never when editing...\n    // options.entry ||\n    // TODO: this is ugly - instead of multiple of same model with different options are sent\n    // say requires key/alias. Or if not perhaps make a reliable hash of the options and use that.\n    // TODO: store last user state on last request and if user attributes different now\n    // give a warning that need to use keys to request new contente\n    // (options &&\n    //   Object.keys(options).filter(key => key !== 'model').length &&\n    //   JSON.stringify({ model: modelName, ...options, initialContent: undefined })) ||\n    modelName;\n    var isEditingThisModel = this.editingModel === modelName;\n    // TODO: include params in this key........\n    var currentObservable = this.observersByKey[key];\n    // if (options.query && options.query._id) {\n    //   this.flushGetContentQueue([options])\n    // }\n    if (this.apiKey === 'DEMO' && !this.overrides[key] && !options.initialContent) {\n      options.initialContent = [];\n    }\n    var initialContent = options.initialContent;\n    // TODO: refresh option in options\n    if (currentObservable && (!currentObservable.value || options.cache)) {\n      // TODO: test if this ran, otherwise on 404 some observers may never be called...\n      if (currentObservable.value) {\n        nextTick(function () {\n          // TODO: return a new observable and only that one fires subscribers, don't refire for existing ones\n          currentObservable.next(currentObservable.value);\n        });\n      }\n      return currentObservable;\n    }\n    if (isEditingThisModel) {\n      if (Builder.isBrowser) {\n        parent.postMessage({\n          type: 'builder.updateContent',\n          data: {\n            options: options\n          }\n        }, '*');\n      }\n    }\n    if (!initialContent /* || isEditingThisModel */) {\n      if (!this.getContentQueue) {\n        this.getContentQueue = [];\n      }\n      this.getContentQueue.push(__assign(__assign({}, options), {\n        model: modelName,\n        key: key\n      }));\n      if (this.getContentQueue && this.getContentQueue.length >= this.contentPerRequest) {\n        var queue_1 = this.getContentQueue.slice();\n        this.getContentQueue = [];\n        nextTick(function () {\n          _this.flushGetContentQueue(false, queue_1);\n        });\n      } else {\n        nextTick(function () {\n          _this.flushGetContentQueue();\n        });\n      }\n    }\n    var observable = new BehaviorSubject(null);\n    this.observersByKey[key] = observable;\n    if (options.noEditorUpdates) {\n      this.noEditorUpdates[key] = true;\n    }\n    if (initialContent) {\n      nextTick(function () {\n        // TODO: need to testModify this I think...?\n        observable.next(initialContent);\n      });\n    }\n    return observable;\n  };\n  // this is needed to satisfy the Angular SDK, which used to rely on the more complex version of `requestUrl`.\n  // even though we only use `fetch()` now, we prefer to keep the old behavior and use the `fetch` that comes from\n  // the core SDK for consistency\n  Builder.prototype.requestUrl = function (url, options) {\n    return getFetch()(url, this.addSdkHeaders(options)).then(function (res) {\n      return res.json();\n    });\n  };\n  Object.defineProperty(Builder.prototype, \"host\", {\n    get: function () {\n      switch (this.env) {\n        case 'qa':\n          return 'https://qa.builder.io';\n        case 'test':\n          return 'https://builder-io-test.web.app';\n        case 'fast':\n          return 'https://fast.builder.io';\n        case 'cloud':\n          return 'https://cloud.builder.io';\n        case 'cdn2':\n          return 'https://cdn2.builder.io';\n        case 'cdn-qa':\n          return 'https://cdn-qa.builder.io';\n        case 'development':\n        case 'dev':\n          return 'http://localhost:5000';\n        case 'cdn-prod':\n          return 'https://cdn.builder.io';\n        default:\n          return Builder.overrideHost || 'https://cdn.builder.io';\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Builder.prototype.getSdkHeaders = function () {\n    if (!Builder.sdkInfo) {\n      return {};\n    }\n    return {\n      'X-Builder-SDK': Builder.sdkInfo.name,\n      'X-Builder-SDK-GEN': '1',\n      'X-Builder-SDK-Version': Builder.sdkInfo.version\n    };\n  };\n  Builder.prototype.addSdkHeaders = function (fetchOptions) {\n    return __assign(__assign({}, fetchOptions), {\n      headers: __assign(__assign({}, fetchOptions.headers), this.getSdkHeaders())\n    });\n  };\n  Builder.prototype.makeFetchApiCall = function (url, requestOptions) {\n    return getFetch()(url, this.addSdkHeaders(requestOptions));\n  };\n  /**\r\n   * Flatten a nested MongoDB query object into a flat object with dot-separated keys.\r\n   * $ keys are not flattened and are left as is.\r\n   *\r\n   * { foo: { bar: { $gt: 5 }}} -> { 'foo.bar': { '$gt': 5 }}\r\n   * { foo: {'bar.id': { $elemMatch: { 'baz.id': { $in: ['abc', 'bcd'] }}}}} -> { 'foo.bar.id': { '$elemMatch': { 'baz.id': { '$in': ['abc', 'bcd'] }}}}\r\n   */\n  Builder.prototype.flattenMongoQuery = function (obj, _current, _res) {\n    if (_res === void 0) {\n      _res = {};\n    }\n    for (var key in obj) {\n      var value = obj[key];\n      var newKey = _current ? _current + '.' + key : key;\n      if (value && typeof value === 'object' && !Array.isArray(value) && !Object.keys(value).find(function (item) {\n        return item.startsWith('$');\n      })) {\n        this.flattenMongoQuery(value, newKey, _res);\n      } else {\n        _res[newKey] = value;\n      }\n    }\n    return _res;\n  };\n  Builder.prototype.flushGetContentQueue = function (usePastQueue, useQueue) {\n    var _this = this;\n    var _a, _b;\n    if (usePastQueue === void 0) {\n      usePastQueue = false;\n    }\n    if (!this.apiKey) {\n      throw new Error(\"Fetching content failed, expected apiKey to be defined instead got: \".concat(this.apiKey));\n    }\n    if (this.apiVersion) {\n      if (!['v1', 'v3'].includes(this.apiVersion)) {\n        throw new Error(\"Invalid apiVersion: expected 'v1' or 'v3', received '\".concat(this.apiVersion, \"'\"));\n      }\n    } else {\n      this.apiVersion = DEFAULT_API_VERSION;\n    }\n    if (!usePastQueue && !this.getContentQueue) {\n      return;\n    }\n    var queue = useQueue || (usePastQueue ? this.priorContentQueue : this.getContentQueue) || [];\n    // TODO: do this on every request send?\n    this.getOverridesFromQueryString();\n    var queryParams = __assign(__assign({\n      // TODO: way to force a request to be in a separate queue. or just lower queue limit to be 1 by default\n      omit: (_a = queue[0].omit) !== null && _a !== void 0 ? _a : 'meta.componentsUsed',\n      apiKey: this.apiKey\n    }, queue[0].options), this.queryOptions);\n    if (queue[0].locale) {\n      queryParams.locale = queue[0].locale;\n    }\n    if (queue[0].fields) {\n      queryParams.fields = queue[0].fields;\n    }\n    if (queue[0].format) {\n      queryParams.format = queue[0].format;\n    }\n    if ('noTraverse' in queue[0]) {\n      queryParams.noTraverse = queue[0].noTraverse;\n    }\n    if ('includeUnpublished' in queue[0]) {\n      queryParams.includeUnpublished = queue[0].includeUnpublished;\n    }\n    if (queue[0].sort) {\n      queryParams.sort = queue[0].sort;\n    }\n    var pageQueryParams = (typeof location !== 'undefined' ? QueryString.parseDeep(location.search.substr(1)) : undefined) || {}; // TODO: WHAT about SSR (this.request) ?\n    var userAttributes =\n    // FIXME: HACK: only checks first in queue for user attributes overrides, should check all\n    // TODO: merge user attributes provided here with defaults and current user attiributes (?)\n    queue && queue[0].userAttributes ? queue[0].userAttributes : this.targetContent ? this.getUserAttributes() : {\n      urlPath: this.getLocation().pathname\n    };\n    var fullUrlQueueItem = queue.find(function (item) {\n      return !!item.includeUrl;\n    });\n    if (fullUrlQueueItem) {\n      var location_1 = this.getLocation();\n      if (location_1.origin) {\n        queryParams.url = \"\".concat(location_1.origin).concat(location_1.pathname).concat(location_1.search);\n      }\n    }\n    var urlQueueItem = useQueue === null || useQueue === void 0 ? void 0 : useQueue.find(function (item) {\n      return item.url;\n    });\n    if (urlQueueItem === null || urlQueueItem === void 0 ? void 0 : urlQueueItem.url) {\n      userAttributes.urlPath = urlQueueItem.url.split('?')[0];\n    }\n    // TODO: merge in the attribute from query string ones\n    // TODO: make this an option per component/request\n    queryParams.userAttributes = JSON.stringify(userAttributes);\n    if (!usePastQueue && !useQueue) {\n      this.priorContentQueue = queue;\n      this.getContentQueue = null;\n    }\n    var cachebust = this.cachebust || isIframe || pageQueryParams.cachebust || pageQueryParams['builder.cachebust'];\n    if (cachebust || this.env !== 'production') {\n      queryParams.cachebust = true;\n    }\n    if (Builder.isEditing) {\n      queryParams.isEditing = true;\n    }\n    if (this.noCache || this.env !== 'production') {\n      queryParams.noCache = true;\n    }\n    if (size(this.overrides)) {\n      for (var key in this.overrides) {\n        if (this.overrides.hasOwnProperty(key)) {\n          queryParams[\"overrides.\".concat(key)] = this.overrides[key];\n        }\n      }\n    }\n    for (var _i = 0, queue_2 = queue; _i < queue_2.length; _i++) {\n      var options = queue_2[_i];\n      var format_1 = options.format;\n      if (format_1) {\n        queryParams.format = format_1;\n      }\n      // TODO: remove me and make permodel\n      if (options.static) {\n        queryParams.static = options.static;\n      }\n      if (options.cachebust) {\n        queryParams.cachebust = options.cachebust;\n      }\n      if (isPositiveNumber(options.cacheSeconds)) {\n        queryParams.cacheSeconds = options.cacheSeconds;\n      }\n      if (isPositiveNumber(options.staleCacheSeconds)) {\n        queryParams.staleCacheSeconds = options.staleCacheSeconds;\n      }\n      if (this.apiEndpoint === 'content') {\n        queryParams.includeRefs = true;\n      }\n      var properties = ['prerender', 'extractCss', 'limit', 'offset', 'query', 'preview', 'model', 'entry', 'rev', 'static', 'includeRefs'];\n      for (var _c = 0, properties_1 = properties; _c < properties_1.length; _c++) {\n        var key = properties_1[_c];\n        var value = options[key];\n        if (value !== undefined) {\n          if (this.apiEndpoint === 'query') {\n            queryParams.options = queryParams.options || {};\n            queryParams.options[options.key] = queryParams.options[options.key] || {};\n            queryParams.options[options.key][key] = JSON.stringify(value);\n          } else {\n            queryParams[key] = JSON.stringify(value);\n          }\n        }\n      }\n    }\n    if (this.preview && this.previewingModel === ((_b = queue === null || queue === void 0 ? void 0 : queue[0]) === null || _b === void 0 ? void 0 : _b.model)) {\n      queryParams.preview = 'true';\n    }\n    var hasParams = Object.keys(queryParams).length > 0;\n    // TODO: option to force dev or qa api here\n    var host = this.host;\n    var keyNames = queue.map(function (item) {\n      return encodeURIComponent(item.key);\n    }).join(',');\n    if (this.overrideParams) {\n      var params = omit(QueryString.parse(this.overrideParams), 'apiKey');\n      assign(queryParams, params);\n    }\n    var format = queryParams.format;\n    var isApiCallForCodegen = format === 'solid' || format === 'react';\n    var isApiCallForCodegenOrQuery = isApiCallForCodegen || this.apiEndpoint === 'query';\n    if (this.apiEndpoint === 'content') {\n      if (queue[0].query) {\n        delete queryParams.query;\n        var objectToFlatten = {\n          query: queue[0].query\n        };\n        var flattened = this.flattenMongoQuery(objectToFlatten);\n        for (var key in flattened) {\n          queryParams[key] = JSON.stringify(flattened[key]);\n        }\n      }\n    }\n    var queryStr = QueryString.stringifyDeep(queryParams);\n    var fetchOptions = __assign({\n      headers: {}\n    }, queue[0].fetchOptions);\n    if (this.authToken) {\n      fetchOptions.headers = __assign(__assign({}, fetchOptions.headers), {\n        Authorization: \"Bearer \".concat(this.authToken)\n      });\n    }\n    var url;\n    if (isApiCallForCodegen) {\n      url = \"\".concat(host, \"/api/v1/codegen/\").concat(this.apiKey, \"/\").concat(keyNames);\n    } else if (this.apiEndpoint === 'query') {\n      url = \"\".concat(host, \"/api/v3/query/\").concat(this.apiKey, \"/\").concat(keyNames);\n    } else {\n      url = \"\".concat(host, \"/api/v3/content/\").concat(queue[0].model);\n    }\n    url = url + (queryParams && hasParams ? \"?\".concat(queryStr) : '');\n    var promise = this.makeFetchApiCall(url, fetchOptions).then(function (res) {\n      return res.json();\n    }).then(function (result) {\n      for (var _i = 0, queue_3 = queue; _i < queue_3.length; _i++) {\n        var options = queue_3[_i];\n        var keyName = options.key;\n        if (options.model === _this.blockContentLoading && !options.noEditorUpdates) {\n          continue;\n        }\n        var isEditingThisModel = _this.editingModel === options.model;\n        if (isEditingThisModel && Builder.isEditing) {\n          parent.postMessage({\n            type: 'builder.updateContent',\n            data: {\n              options: options\n            }\n          }, '*');\n          // return;\n        }\n        var observer = _this.observersByKey[keyName];\n        if (!observer) {\n          return;\n        }\n        var data = isApiCallForCodegenOrQuery ? result[keyName] : result.results;\n        var sorted = data; // sortBy(data, item => item.priority);\n        if (data) {\n          var testModifiedResults = Builder.isServer ? sorted : _this.processResultsForTests(sorted);\n          observer.next(testModifiedResults);\n        } else {\n          var search = _this.getLocation().search;\n          if ((search || '').includes('builder.preview=' + options.model)) {\n            var previewData = {\n              id: 'preview',\n              name: 'Preview',\n              data: {}\n            };\n            observer.next([previewData]);\n          }\n          observer.next([]);\n        }\n      }\n    }, function (err) {\n      for (var _i = 0, queue_4 = queue; _i < queue_4.length; _i++) {\n        var options = queue_4[_i];\n        var observer = _this.observersByKey[options.key];\n        if (!observer) {\n          return;\n        }\n        observer.error(err);\n      }\n    });\n    return promise;\n  };\n  Builder.prototype.processResultsForTests = function (results) {\n    var _this = this;\n    var _a;\n    var mappedResults = results.map(function (item) {\n      if (!item.variations) {\n        return item;\n      }\n      var cookieValue = _this.getTestCookie(item.id);\n      var cookieVariation = cookieValue === item.id ? item : item.variations[cookieValue];\n      if (cookieVariation) {\n        return __assign(__assign({}, item), {\n          data: cookieVariation.data,\n          variationId: cookieValue,\n          testVariationId: cookieValue,\n          testVariationName: cookieVariation.name\n        });\n      }\n      if (_this.canTrack && item.variations && size(item.variations)) {\n        var n = 0;\n        var random = Math.random();\n        for (var id in item.variations) {\n          var variation = item.variations[id];\n          var testRatio = variation.testRatio;\n          n += testRatio;\n          if (random < n) {\n            _this.setTestCookie(item.id, variation.id);\n            var variationName = variation.name || (variation.id === item.id ? 'Default variation' : '');\n            return __assign(__assign({}, item), {\n              data: variation.data,\n              variationId: variation.id,\n              testVariationId: variation.id,\n              variationName: variationName,\n              testVariationName: variationName\n            });\n          }\n        }\n        _this.setTestCookie(item.id, item.id);\n      }\n      return __assign(__assign(__assign({}, item), {\n        variationId: item.id\n      }), item.variations && size(item.variations) && {\n        testVariationId: item.id,\n        testVariationName: 'Default variation'\n      });\n    });\n    if (isIframe) {\n      (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\n        type: 'builder.contentResults',\n        data: {\n          results: mappedResults\n        }\n      }, '*');\n    }\n    return mappedResults;\n  };\n  Builder.prototype.getTestCookie = function (contentId) {\n    return this.getCookie(\"\".concat(this.testCookiePrefix, \".\").concat(contentId));\n  };\n  Builder.prototype.setTestCookie = function (contentId, variationId) {\n    if (!this.canTrack) {\n      this.cookieQueue.push([contentId, variationId]);\n      return;\n    }\n    // 30 days from now\n    var future = new Date();\n    future.setDate(future.getDate() + 30);\n    return this.setCookie(\"\".concat(this.testCookiePrefix, \".\").concat(contentId), variationId, future);\n  };\n  Builder.prototype.getCookie = function (name) {\n    if (this.cookies) {\n      return this.cookies.get(name);\n    }\n    return Builder.isBrowser && getCookie(name);\n  };\n  Builder.prototype.setCookie = function (name, value, expires) {\n    if (this.cookies && !(Builder.isServer && Builder.isStatic)) {\n      return this.cookies.set(name, value, {\n        expires: expires,\n        secure: this.getLocation().protocol === 'https:'\n      });\n    }\n    return Builder.isBrowser && setCookie(name, value, expires);\n  };\n  Builder.prototype.getContent = function (modelName, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    if (!this.apiKey) {\n      throw new Error(\"Fetching content from model \".concat(modelName, \" failed, expected apiKey to be defined instead got: \").concat(this.apiKey));\n    }\n    return this.queueGetContent(modelName, options);\n  };\n  Builder.prototype.getAll = function (modelName, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var instance = this;\n    if (!Builder.isBrowser) {\n      instance = new Builder(options.apiKey || this.apiKey, options.req, options.res, false, options.authToken || this.authToken, options.apiVersion || this.apiVersion);\n      instance.setUserAttributes(this.getUserAttributes());\n    } else {\n      // NOTE: All these are when .init is not called and the customer\n      // directly calls .get on the singleton instance of Builder\n      if (options.apiKey && !this.apiKey) {\n        this.apiKey = options.apiKey;\n      }\n      if (options.authToken && !this.authToken) {\n        this.authToken = options.authToken;\n      }\n      if (options.apiVersion && !this.apiVersion) {\n        this.apiVersion = options.apiVersion;\n      }\n    }\n    // Set noTraverse=true if NOT already passed by user, for query performance\n    if (!('noTraverse' in options)) {\n      options.noTraverse = true;\n    }\n    return instance.getContent(modelName, __assign(__assign({\n      limit: 30\n    }, options), {\n      key: options.key ||\n      // Make the key include all options, so we don't reuse cache for the same content fetched\n      // with different options\n      Builder.isBrowser ? \"\".concat(modelName, \":\").concat(hash(omit(options, 'initialContent', 'req', 'res'))) : undefined\n    })).promise();\n  };\n  Builder.VERSION = SDK_VERSION;\n  Builder.components = [];\n  /**\r\n   * Makes it so that a/b tests generate code like {@link\r\n   * https://www.builder.io/blog/high-performance-no-code#__next:~:text=Static%20generated%20A%2FB%20testing}\r\n   * instead of the old way where we render only one test group at a time on the\r\n   * server. This is the preferred/better way not and we should ultimately make it\r\n   * the default\r\n   */\n  Builder.isStatic = true;\n  Builder.animator = new Animator();\n  Builder.nextTick = nextTick;\n  Builder.throttle = throttle;\n  Builder.editors = [];\n  Builder.trustedHosts = ['*.beta.builder.io', 'beta.builder.io', 'builder.io', 'localhost', 'qa.builder.io'];\n  Builder.plugins = [];\n  Builder.actions = [];\n  Builder.registry = {};\n  Builder.attributesCookieName = 'builder.userAttributes';\n  Builder.registryChange = new BehaviorSubject({});\n  Builder._editingPage = false;\n  Builder.isIframe = isIframe;\n  Builder.isBrowser = isBrowser;\n  Builder.isReactNative = isReactNative;\n  Builder.isServer = !isBrowser && !isReactNative;\n  Builder.previewingModel = Builder.isBrowser && getQueryParam(location.href, 'builder.preview');\n  Builder.settings = {};\n  Builder.settingsChange = new BehaviorSubject({});\n  // TODO: this is quick and dirty, do better implementation later. Also can be unreliable\n  // if page 301s etc. Use a query param instead? also could have issues with redirects. Injecting var could\n  // work but is async...\n  Builder.isEditing = Boolean(isIframe && (document.referrer && document.referrer.match(/builder\\.io|localhost:1234/) || location.search.indexOf('builder.frameEditing=') !== -1));\n  Builder.isPreviewing = Boolean(isBrowser && (location.search.indexOf('builder.preview=') !== -1 || location.search.indexOf('builder.frameEditing=') !== -1));\n  Builder.isReact = false;\n  Builder.sdkInfo = undefined;\n  Builder.overrideUserAttributes = {};\n  return Builder;\n}();\nvar builder = new Builder(null, undefined, undefined, true);\nBuilder.singletonInstance = builder;\nexport { BehaviorSubject, Builder, BuilderComponent, Subscription, builder, isBrowser };","map":{"version":3,"names":["window","CustomEvent","event","params","bubbles","cancelable","detail","evt","document","createEvent","initCustomEvent","isSafari","test","navigator","userAgent","isClient","nextTick","fn","MutationObserver","setTimeout","called","observer","element","createTextNode","observe","characterData","data","String","PROPERTY_NAME_DENY_LIST","Object","freeze","QueryString","parseDeep","queryString","obj","parse","deepen","stringifyDeep","map","flatten","stringify","query","pairs","substr","split","i","length","pair","decodeURIComponent","error","str","key","hasOwnProperty","value","encodeURIComponent","output","k","t","parts","pop","_i","parts_1","part","assertAllowedPropertyName","_current","_res","newKey","name","indexOf","Error","concat","Subscription","listeners","listener","unsubscribed","otherSubscriptions","defineProperty","prototype","get","add","subscription","push","unsubscribe","index","splice","forEach","sub","BehaviorSubject","_this","errorListeners","then","args","arguments","_a","toPromise","apply","next","newSubject","subscribe","val","catch","err","errorListener","Promise","resolve","reject","promise","State","Pending","Fulfilled","Rejected","isFunction","isObject","TinyPromise","executor","_state","_handlers","_value","_resolve","bind","_reject","x","called_1","thenable","call","result","undefined","_fulfill","ex","handler","_callHandler","_isPending","_isFulfilled","_isRejected","_addHandler","onFulfilled","onRejected","Promise$1","serverOnlyRequire","eval","serverOnlyRequire$1","promiseResolve","tinyFetch","url","options","request","XMLHttpRequest","open","method","headers","setRequestHeader","withCredentials","credentials","onload","response","onerror","send","body","keys","all","header","getAllResponseHeaders","replace","_match","_key","toLowerCase","ok","status","statusText","responseURL","clone","text","responseText","json","JSON","blob","Blob","entries","n","has","getFetch","_fetch","globalThis","fetch","e","console","warn","assign","target","to","nextSource","nextKey","throttle","func","wait","context","timeout","previous","later","leading","Date","now","remaining","clearTimeout","trailing","camelCaseToKebabCase","g","Animator","bindAnimations","animations","animations_1","animation","trigger","triggerAnimation","bindHoverAnimation","bindScrollInViewAnimation","warnElementNotPresent","id","augmentAnimation","stylesUsed","getAllStylesUsed","computedStyle","getComputedStyle","firstStyles","steps","styles","lastStyles","bothStyles","bothStyles_1","stylesUsed_1","style","properties","step","elements","Array","slice","getElementsByClassName","elementId","from","transition","transitionDelay","duration","easing","delay","defaultState","hoverState","attachDefaultState","attachHoverState","addEventListener","triggered","pendingAnimation","immediateOnScroll","isScrolledIntoView","repeat","removeEventListener","onScroll","elem","rect","getBoundingClientRect","windowHeight","innerHeight","thresholdPercent","threshold","bottom","top","capture","passive","fieldContentRegExp","Cookies","match","getPattern","set","opts","res","req","getHeader","secure","protocol","connection","encrypted","cookie","Cookie","pushCookie","setHeader","attrs","path","domain","httpOnly","sameSite","overwrite","TypeError","expires","toString","toHeader","maxAge","toUTCString","RegExp","omit","values","newObject","values_1","uuidv4","c","r","Math","random","v","uuid","emptyUrl","port","auth","hash","host","hostname","href","pathname","search","slashes","parse$1","out","u","pathOnly","URL","toError","DEFAULT_API_VERSION","SDK_VERSION","datePlusMinutes","minutes","isPositiveNumber","thing","isNaN","isReactNative","product","validEnvList","getQueryParam","variable","vars","urlParser","el","createElement","props","props_1","prop","setCookie","expiresString","isBrowser","location","getCookie","size","object","find","callback","list","thisArg","sessionStorageKey","localStorageKey","isIframe","self","BuilderComponent","info","Builder","Component","apiKey","forceNewInstance","authToken","apiVersion","eventsQueue","throttledClearEventsQueue","processEventsQueue","sessionId","env","getSessionId","targetContent","contentPerRequest","allowCustomFonts","cookies","cachebust","overrideParams","noCache","preview","apiEndpoint$","apiVersion$","canTrack$","browserTrackingDisabled","hasOverriddenCanTrack","apiKey$","authToken$","userAttributesChanged","editingMode$","editingModel$","trackingHooks","visitorId","getVisitorId","autoTrack","isDevelopmentEnv","trackingUserAttributes","blockContentLoading","observersByKey","noEditorUpdates","overrides","queryOptions","getContentQueue","priorContentQueue","testCookiePrefix","cookieQueue","singletonInstance","setUserAgent","isEditing","bindMessageListeners","parent","postMessage","type","version","messageFrameLoaded","sessionStorage","getItem","setItem","debug","item","setTestsFromUrl","getOverridesFromQueryString","userAttrCookie","attributesCookieName","attributes","setUserAttributes","register","serializeIncludingFunctions","typeList","registry","message","registryChange","registerEditor","isTrustedHost","editors","registerPlugin","plugins","registerAction","action","actions","actionClone","registerTrustedHost","trustedHosts","setServerContext","serverContext","isTrusted","findIndex","trustedHost","startsWith","endsWith","isTrustedHostForEvent","origin","runAction","actionObject","fields","settings","import","packageName","System","_editingPage","editingPage","classList","remove","isForPlugin","serializeFn","fnValue","fnStr","trim","isArrowWithoutParens","appendFunction","objToReturn","shouldNotSerializeFn","onSave","prepareComponentSpecToSend","spec","__assign","class","registerBlock","component","registerComponent","builderOptions","addComponent","editable","models","editingModel","includes","sendSpec","current","components","events","fullUserAttributes","overrideUserAttributes","events_1","event_1","metadata","user","getSdkHeaders","mode","Boolean","builderNoTrack","cookieEnabled","canTrack","apiEndpoint","editingMode","findParentElement","checkElement","HTMLElement","parentElement","matches","findBuilderParent","getAttribute","setTrackingHook","hook","track","eventName","isPreviewing","eventData","sdkVersion","VERSION","meta","ownerId","userAttributes","getUserAttributes","returnValue","localStorage","trackImpression","contentId","variationId","trackConversion","amount","customProperties","useContentId","trackInteraction","alreadyTrackedOne","targetBuilderElement","round","num","clientX","clientY","targetRect","xOffset","left","yOffset","xRatio","width","yRatio","height","targetOffset","y","builderTargetOffset","builderId","builderElementIndex","unique","token","modifySearch","group1","group2","getLocation","tests","builder","setTestCookie","resetOverrides","api","editing","frameEditing","locale","includeRefs","enrich","source","settingsChange","info_1","hasComponent_1","every","thisInfo","animator","alias","entry","modelName","contentData","_b","model","componentData","editingPageMode","flushGetContentQueue","_e","id_1","Function","_c","finalResult","_d","init","defaultCanTrack","parsedLocation","isMobile","Android","BlackBerry","iOS","Opera","Windows","any","isTablet","urlPath","device","setTrackingUserAttributes","instance","finalLocale","noTraverse","finalOptions","queueGetContent","isStatic","matchData","blocksString","blocks","testVariationId","testVariationName","lastUpdated","isEditingThisModel","currentObservable","initialContent","cache","queue_1","observable","requestUrl","addSdkHeaders","overrideHost","sdkInfo","fetchOptions","makeFetchApiCall","requestOptions","flattenMongoQuery","isArray","usePastQueue","useQueue","queue","queryParams","format","includeUnpublished","sort","pageQueryParams","fullUrlQueueItem","includeUrl","location_1","urlQueueItem","queue_2","format_1","static","cacheSeconds","staleCacheSeconds","properties_1","previewingModel","hasParams","keyNames","join","isApiCallForCodegen","isApiCallForCodegenOrQuery","objectToFlatten","flattened","queryStr","Authorization","queue_3","keyName","results","sorted","testModifiedResults","isServer","processResultsForTests","previewData","queue_4","mappedResults","variations","cookieValue","getTestCookie","cookieVariation","variation","testRatio","variationName","future","setDate","getDate","getContent","getAll","limit","referrer","isReact"],"sources":["D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\polyfills\\custom-event-polyfill.js","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\next-tick.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\classes\\query-string.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\classes\\observable.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\classes\\promise.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\server-only-require.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\fetch.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\assign.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\throttle.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\classes\\animator.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\classes\\cookies.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\omit.function.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\uuid.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\url.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\functions\\to-error.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\types\\api-version.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\sdk-version.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\builder.class.ts","D:\\JHFshop\\node_modules\\@builder.io\\sdk\\src\\constants\\builder.ts"],"sourcesContent":["(function () {\n  if (typeof window === 'undefined' || typeof window.CustomEvent === 'function') return false;\n\n  function CustomEvent(event, params) {\n    params = params || { bubbles: false, cancelable: false, detail: null };\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    return evt;\n  }\n\n  window.CustomEvent = CustomEvent;\n})();\n","const isSafari =\n  typeof window !== 'undefined' &&\n  /^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);\n\nconst isClient = typeof window !== 'undefined';\n\n// TODO: queue all of these in a debounceNextTick\nexport function nextTick(fn: () => void) {\n  // if (typeof process !== 'undefined' && process.nextTick) {\n  //   console.log('process.nextTick?');\n  //   process.nextTick(fn);\n  //   return;\n  // }\n  // FIXME: fix the real safari issue of this randomly not working\n  if (!isClient || isSafari || typeof MutationObserver === 'undefined') {\n    setTimeout(fn);\n    return;\n  }\n  let called = 0;\n  const observer = new MutationObserver(() => fn());\n  const element = document.createTextNode('');\n  observer.observe(element, {\n    characterData: true,\n  });\n  // tslint:disable-next-line\n  element.data = String((called = ++called));\n}\n","export type StringMap = Record<string, string>;\n\nconst PROPERTY_NAME_DENY_LIST = Object.freeze(['__proto__', 'prototype', 'constructor']);\n\n// TODO: unit tests\nexport class QueryString {\n  static parseDeep(queryString: string) {\n    const obj = this.parse(queryString);\n    return this.deepen(obj);\n  }\n\n  static stringifyDeep(obj: any) {\n    const map = this.flatten(obj);\n    return this.stringify(map);\n  }\n\n  static parse(queryString: string): StringMap {\n    const query: StringMap = {};\n    const pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');\n    for (let i = 0; i < pairs.length; i++) {\n      const pair = pairs[i].split('=');\n      // TODO: node support?\n      try {\n        query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');\n      } catch (error) {\n        // Ignore malformed URI components\n      }\n    }\n    return query;\n  }\n\n  static stringify(map: StringMap) {\n    let str = '';\n    for (const key in map) {\n      if (map.hasOwnProperty(key)) {\n        const value = map[key];\n        if (str) {\n          str += '&';\n        }\n        str += encodeURIComponent(key) + '=' + encodeURIComponent(value);\n      }\n    }\n    return str;\n  }\n\n  static deepen(map: StringMap) {\n    // FIXME; Should be type Tree = Record<string, string | Tree>\n    // requires a typescript upgrade.\n    const output: any = {};\n    for (const k in map) {\n      let t = output;\n      const parts = k.split('.');\n      const key = parts.pop()!;\n      for (const part of parts) {\n        assertAllowedPropertyName(part);\n        t = t[part] = t[part] || {};\n      }\n      t[key] = map[k];\n    }\n    return output;\n  }\n\n  static flatten(obj: any, _current?: any, _res: any = {}): StringMap {\n    for (const key in obj) {\n      const value = obj[key];\n      const newKey = _current ? _current + '.' + key : key;\n      if (value && typeof value === 'object') {\n        this.flatten(value, newKey, _res);\n      } else {\n        _res[newKey] = value;\n      }\n    }\n\n    return _res;\n  }\n}\n\nfunction assertAllowedPropertyName(name: string): asserts name {\n  if (PROPERTY_NAME_DENY_LIST.indexOf(name) >= 0)\n    throw new Error(`Property name \"${name}\" is not allowed`);\n}\n","export type Listener<T> = (value: T) => void;\n\nexport class Subscription<FunctionType = Function> {\n  constructor(\n    private listeners?: FunctionType[],\n    private listener?: FunctionType\n  ) {}\n\n  unsubscribed = false;\n\n  get closed() {\n    return this.unsubscribed;\n  }\n\n  private readonly otherSubscriptions: Subscription[] = [];\n\n  add(subscription: Subscription) {\n    this.otherSubscriptions.push(subscription);\n  }\n\n  unsubscribe() {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (this.listener && this.listeners) {\n      const index = this.listeners.indexOf(this.listener);\n      if (index > -1) {\n        this.listeners.splice(index, 1);\n      }\n    }\n    this.otherSubscriptions.forEach(sub => sub.unsubscribe());\n    this.unsubscribed = true;\n  }\n}\n\n// TODO: follow minimal basic spec: https://github.com/tc39/proposal-observable\nexport class BehaviorSubject<T = any, ErrorType = any> {\n  constructor(public value: T) {}\n\n  private listeners: Listener<T>[] = [];\n  private errorListeners: Listener<ErrorType>[] = [];\n\n  next(value: T) {\n    this.value = value;\n    for (const listener of this.listeners) {\n      listener(value);\n    }\n  }\n\n  // TODO: implement this as PIPE instead\n  map<NewType = any>(fn: (item: T) => NewType) {\n    const newSubject = new BehaviorSubject<NewType>(fn(this.value));\n    // TODO: on destroy delete these\n    this.subscribe(val => {\n      newSubject.next(fn(val));\n    });\n    this.catch(err => {\n      newSubject.error(err);\n    });\n    return newSubject;\n  }\n\n  catch(errorListener: Listener<ErrorType>) {\n    this.errorListeners.push(errorListener);\n    return new Subscription(this.errorListeners, errorListener);\n  }\n\n  error(error: ErrorType) {\n    for (const listener of this.errorListeners) {\n      listener(error);\n    }\n  }\n\n  subscribe(listener: Listener<T>, errorListener?: Listener<ErrorType>) {\n    this.listeners.push(listener);\n    if (errorListener) {\n      this.errorListeners.push(errorListener);\n    }\n    return new Subscription(this.listeners, listener);\n  }\n\n  toPromise() {\n    return new Promise<T>((resolve, reject) => {\n      const subscription = this.subscribe(\n        value => {\n          resolve(value);\n          subscription.unsubscribe();\n        },\n        err => {\n          reject(err);\n          subscription.unsubscribe();\n        }\n      );\n    });\n  }\n\n  promise() {\n    return this.toPromise();\n  }\n\n  then: Promise<T>['then'] = (...args) => {\n    return this.toPromise().then(...args);\n  };\n}\n\n// TODO: make different classes\nexport const Observer = BehaviorSubject;\nexport const Observable = BehaviorSubject;\n","import { nextTick } from '../functions/next-tick.function';\n\nconst State = {\n  Pending: 'Pending',\n  Fulfilled: 'Fulfilled',\n  Rejected: 'Rejected',\n};\n\nfunction isFunction(val: any) {\n  return val && typeof val === 'function';\n}\n\nfunction isObject(val: any) {\n  return val && typeof val === 'object';\n}\n\ninterface Handler<T> {\n  onFulfilled: (val: T) => any;\n  onRejected: (err: any) => any;\n}\n\nexport class TinyPromise<T = any> {\n  private _state = State.Pending;\n  private _handlers: Handler<T>[] = [];\n  private _value: T | null = null;\n\n  constructor(executor: (resolve: (val: T) => any, reject: (err: T) => any) => void) {\n    executor(this._resolve.bind(this), this._reject.bind(this));\n  }\n\n  private _resolve(x: any) {\n    if (x instanceof TinyPromise) {\n      x.then(this._resolve.bind(this), this._reject.bind(this));\n    } else if (isObject(x) || isFunction(x)) {\n      let called = false;\n      try {\n        const thenable = (x as Promise<any>).then;\n        if (isFunction(thenable)) {\n          thenable.call(\n            x,\n            (result: any) => {\n              if (!called) this._resolve(result);\n              called = true;\n              return undefined as any;\n            },\n            (error: any) => {\n              if (!called) this._reject(error);\n              called = true;\n              return undefined as any;\n            }\n          );\n        } else {\n          this._fulfill(x);\n        }\n      } catch (ex) {\n        if (!called) {\n          this._reject(ex);\n        }\n      }\n    } else {\n      this._fulfill(x);\n    }\n  }\n\n  private _fulfill(result: T) {\n    this._state = State.Fulfilled;\n    this._value = result;\n    this._handlers.forEach(handler => this._callHandler(handler));\n  }\n\n  private _reject(error: any) {\n    this._state = State.Rejected;\n    this._value = error;\n    this._handlers.forEach(handler => this._callHandler(handler));\n  }\n\n  private _isPending() {\n    return this._state === State.Pending;\n  }\n\n  private _isFulfilled() {\n    return this._state === State.Fulfilled;\n  }\n\n  private _isRejected() {\n    return this._state === State.Rejected;\n  }\n\n  private _addHandler(onFulfilled: (val: T) => any, onRejected: (err: any) => any) {\n    this._handlers.push({\n      onFulfilled,\n      onRejected,\n    });\n  }\n\n  private _callHandler(handler: Handler<T>) {\n    if (this._isFulfilled() && isFunction(handler.onFulfilled)) {\n      handler.onFulfilled(this._value as T);\n    } else if (this._isRejected() && isFunction(handler.onRejected)) {\n      handler.onRejected(this._value);\n    }\n  }\n\n  then(onFulfilled: (val: T) => any, onRejected: (err: any) => any) {\n    switch (this._state) {\n      case State.Pending: {\n        return new TinyPromise((resolve, reject) => {\n          this._addHandler(\n            value => {\n              nextTick(() => {\n                try {\n                  if (isFunction(onFulfilled)) {\n                    resolve(onFulfilled(value));\n                  } else {\n                    resolve(value);\n                  }\n                } catch (ex) {\n                  reject(ex);\n                }\n              });\n            },\n            error => {\n              nextTick(() => {\n                try {\n                  if (isFunction(onRejected)) {\n                    resolve(onRejected(error));\n                  } else {\n                    reject(error);\n                  }\n                } catch (ex) {\n                  reject(ex);\n                }\n              });\n            }\n          );\n        });\n      }\n\n      case State.Fulfilled: {\n        return new TinyPromise((resolve, reject) => {\n          nextTick(() => {\n            try {\n              if (isFunction(onFulfilled)) {\n                resolve(onFulfilled(this._value as T));\n              } else {\n                resolve(this._value as T);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          });\n        });\n      }\n\n      case State.Rejected: {\n        return new TinyPromise((resolve, reject) => {\n          nextTick(() => {\n            try {\n              if (isFunction(onRejected)) {\n                resolve(onRejected(this._value));\n              } else {\n                reject(this._value);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          });\n        });\n      }\n    }\n  }\n}\n\nexport default (typeof Promise !== 'undefined' ? Promise : TinyPromise) as PromiseConstructor;\n","// Webpack workaround to conditionally require certain external modules\n// only on the server and not bundle them on the client\nlet serverOnlyRequire: NodeRequire;\ntry {\n  // tslint:disable-next-line:no-eval\n  serverOnlyRequire = eval('require');\n} catch (err) {\n  // all good\n  serverOnlyRequire = (() => null) as any;\n}\n\nexport default serverOnlyRequire;\n","import Promise from '../classes/promise.class';\nimport serverOnlyRequire from './server-only-require.function';\n\nexport interface SimplifiedFetchOptions {\n  body?: string;\n  headers?: { [key: string]: string };\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  credentials?: 'include';\n  mode?: RequestMode;\n}\n\nexport interface SimpleFetchResponse {\n  ok: boolean;\n  status: number;\n  statusText: string;\n  url: string;\n  clone: () => any;\n  text: () => Promise<string>;\n  json: () => Promise<any>;\n  blob: () => Promise<Blob>;\n  headers: {\n    keys: () => string[];\n    entries: () => [string, string][];\n    get: (n: string) => string;\n    has: (n: string) => boolean;\n  };\n}\n\nfunction promiseResolve<T>(value: T) {\n  return new Promise<T>(resolve => resolve(value));\n}\n\n// Adapted from https://raw.githubusercontent.com/developit/unfetch/master/src/index.mjs\nfunction tinyFetch(url: string, options: SimplifiedFetchOptions = {}) {\n  return new Promise<SimpleFetchResponse>((resolve, reject) => {\n    const request = new XMLHttpRequest();\n\n    request.open(options.method || 'get', url, true);\n\n    if (options.headers) {\n      for (const i in options.headers) {\n        request.setRequestHeader(i, options.headers[i]);\n      }\n    }\n\n    request.withCredentials = options.credentials === 'include';\n\n    request.onload = () => {\n      resolve(response());\n    };\n\n    request.onerror = reject;\n\n    request.send(options.body);\n\n    function response() {\n      const keys: string[] = [];\n      const all: [string, string][] = [];\n      const headers: { [key: string]: string } = {};\n      let header: string | undefined = undefined;\n\n      request\n        .getAllResponseHeaders()\n        .replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm, (_match, _key, value) => {\n          let key = _key;\n          keys.push((key = key.toLowerCase()));\n          all.push([key, value]);\n          header = headers[key];\n          headers[key] = header ? `${header},${value}` : value;\n          return '';\n        });\n\n      return {\n        ok: ((request.status / 100) | 0) === 2, // 200-299\n        status: request.status,\n        statusText: request.statusText,\n        url: request.responseURL,\n        clone: response,\n        text: () => promiseResolve(request.responseText),\n        json: () => promiseResolve(request.responseText).then(JSON.parse),\n        blob: () => promiseResolve(new Blob([request.response])),\n        headers: {\n          keys: () => keys,\n          entries: () => all,\n          get: (n: string) => headers[n.toLowerCase()],\n          has: (n: string) => n.toLowerCase() in headers,\n        },\n      };\n    }\n  });\n}\n\nexport function getFetch() {\n  // If fetch is defined, in the browser, via polyfill, or in a Cloudflare worker, use it.\n  let _fetch: typeof fetch | undefined = undefined;\n  if (globalThis.fetch) {\n    _fetch ??= globalThis.fetch as any;\n  } else if (typeof window === 'undefined') {\n    // If fetch is not defined, in a Node.js environment, use node-fetch.\n    try {\n      // node-fetch@^3 is ESM only, and will throw error on require.\n      _fetch ??= serverOnlyRequire('node-fetch');\n    } catch (e) {\n      // If node-fetch is not installed, use tiny-fetch.\n      console.warn(\n        'node-fetch is not installed. consider polyfilling fetch or installing node-fetch.'\n      );\n      console.warn(e);\n    }\n  }\n\n  // Otherwise, use tiny-fetch.\n  return _fetch ?? tinyFetch;\n}\n","export function assign(target: object, ...args: any[]) {\n  const to = Object(target);\n\n  for (let index = 1; index < arguments.length; index++) {\n    const nextSource = arguments[index];\n\n    if (nextSource != null) {\n      // Skip over if undefined or null\n      for (const nextKey in nextSource) {\n        // Avoid bugs when hasOwnProperty is shadowed\n        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n          to[nextKey] = nextSource[nextKey];\n        }\n      }\n    }\n  }\n  return to;\n}\n","export function throttle(func: Function, wait: number, options: any = {}) {\n  let context: any;\n  let args: any;\n  let result: any;\n  let timeout = null as any;\n  let previous = 0;\n  const later = function () {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n  return function (this: any) {\n    const now = Date.now();\n    if (!previous && options.leading === false) previous = now;\n    const remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\n","import { throttle } from '../functions/throttle.function';\nimport { assign } from '../functions/assign.function';\n\nconst camelCaseToKebabCase = (str?: string) =>\n  str ? str.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`) : '';\n\nexport interface AnimationStep {\n  // First one is always start state\n  // isStartState?: boolean;\n  styles: { [key: string]: string };\n  delay?: number;\n}\n\nexport interface Animation {\n  elementId: string;\n  trigger: string;\n  steps: AnimationStep[];\n  duration: number;\n  delay?: number;\n  easing?: string;\n  // TODO: deprecate - only here because of an API bug\n  id?: string;\n  // only apply in scrollInView\n  repeat?: boolean;\n  // only apply in scrollInView, number from -1 to 1\n  thresholdPercent?: number;\n}\n\nexport class Animator {\n  bindAnimations(animations: Animation[]) {\n    for (const animation of animations) {\n      switch (animation.trigger) {\n        case 'pageLoad':\n          this.triggerAnimation(animation);\n          break;\n        case 'hover':\n          this.bindHoverAnimation(animation);\n          break;\n        case 'scrollInView':\n          this.bindScrollInViewAnimation(animation);\n          break;\n      }\n    }\n  }\n\n  private warnElementNotPresent(id: string) {\n    console.warn(`Cannot animate element: element with ID ${id} not found!`);\n  }\n\n  private augmentAnimation(animation: Animation, element: HTMLElement) {\n    const stylesUsed = this.getAllStylesUsed(animation);\n    const computedStyle: any = getComputedStyle(element);\n    // const computedStyle = getComputedStyle(element);\n    // // FIXME: this will break if original load is in one reponsive size then resize to another hmmm\n    // Need to use transform instead of left since left can change on screen sizes\n    const firstStyles = animation.steps[0].styles;\n    const lastStyles = animation.steps[animation.steps.length - 1]!.styles;\n    const bothStyles = [firstStyles, lastStyles];\n\n    // FIXME: this won't work as expected for augmented animations - may need the editor itself to manage this\n    for (const styles of bothStyles) {\n      for (const style of stylesUsed) {\n        if (!(style in styles)) {\n          styles[style] = computedStyle[style];\n        }\n      }\n    }\n  }\n\n  private getAllStylesUsed(animation: Animation) {\n    const properties: (keyof CSSStyleDeclaration)[] = [];\n    for (const step of animation.steps) {\n      for (const key in step.styles) {\n        if (properties.indexOf(key as any) === -1) {\n          properties.push(key as any);\n        }\n      }\n    }\n    return properties;\n  }\n\n  triggerAnimation(animation: Animation) {\n    // TODO: do for ALL elements\n    const elements = Array.prototype.slice.call(\n      document.getElementsByClassName(animation.elementId || animation.id || '')\n    ) as HTMLElement[];\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n\n    Array.from(elements).forEach(element => {\n      this.augmentAnimation(animation, element);\n      // TODO: do this properly, may have other animations of different properties\n\n      // TODO: only override the properties\n      // TODO: if there is an entrance and hover animation, the transition duration will get effed\n      // element.setAttribute('style', '');\n\n      // const styledUsed = this.getAllStylesUsed(animation);\n      element.style.transition = 'none';\n      element.style.transitionDelay = '0';\n      assign(element.style, animation.steps[0].styles);\n      // TODO: queue/batch these timeouts\n      // TODO: only include properties explicitly set in the animation\n      // using Object.keys(styles)\n      setTimeout(() => {\n        element.style.transition = `all ${animation.duration}s ${camelCaseToKebabCase(\n          animation.easing\n        )}`;\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n        assign(element.style, animation.steps[1].styles);\n        // TODO: maybe remove/reset transitoin property after animation duration\n\n        // TODO: queue timers\n        setTimeout(\n          () => {\n            // TODO: what if has other transition (reset back to what it was)\n            element.style.transition = '';\n            element.style.transitionDelay = '';\n          },\n          (animation.delay || 0) * 1000 + animation.duration * 1000 + 100\n        );\n      });\n    });\n  }\n\n  bindHoverAnimation(animation: Animation) {\n    // TODO: is it multiple binding when editing...?\n    // TODO: unbind on element remove\n    // TODO: apply to ALL elements\n    const elements = Array.prototype.slice.call(\n      document.getElementsByClassName(animation.elementId || animation.id || '')\n    ) as HTMLElement[];\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n\n    Array.from(elements).forEach(element => {\n      this.augmentAnimation(animation, element);\n\n      const defaultState = animation.steps[0].styles;\n      const hoverState = animation.steps[1].styles;\n      function attachDefaultState() {\n        assign(element!.style, defaultState);\n      }\n      function attachHoverState() {\n        assign(element!.style, hoverState);\n      }\n      attachDefaultState();\n      element.addEventListener('mouseenter', attachHoverState);\n      element.addEventListener('mouseleave', attachDefaultState);\n      // TODO: queue/batch these timeouts\n      setTimeout(() => {\n        element.style.transition = `all ${animation.duration}s ${camelCaseToKebabCase(\n          animation.easing\n        )}`;\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n      });\n    });\n  }\n\n  // TODO: unbind on element remove\n  bindScrollInViewAnimation(animation: Animation) {\n    // TODO: apply to ALL matching elements\n    const elements = Array.prototype.slice.call(\n      document.getElementsByClassName(animation.elementId || animation.id || '')\n    ) as HTMLElement[];\n    if (!elements.length) {\n      this.warnElementNotPresent(animation.elementId || animation.id || '');\n      return;\n    }\n\n    // TODO: if server side rendered and scrolled into view don't animate...\n    Array.from(elements).forEach(element => {\n      this.augmentAnimation(animation, element);\n\n      let triggered = false;\n      let pendingAnimation = false;\n      function immediateOnScroll() {\n        if (!triggered && isScrolledIntoView(element)) {\n          triggered = true;\n          pendingAnimation = true;\n          setTimeout(() => {\n            assign(element!.style, animation.steps[1].styles);\n            if (!animation.repeat) {\n              document.removeEventListener('scroll', onScroll);\n            }\n            setTimeout(\n              () => {\n                pendingAnimation = false;\n                if (!animation.repeat) {\n                  element.style.transition = '';\n                  element.style.transitionDelay = '';\n                }\n              },\n              (animation.duration + (animation.delay || 0)) * 1000 + 100\n            );\n          });\n        } else if (\n          animation.repeat &&\n          triggered &&\n          !pendingAnimation &&\n          !isScrolledIntoView(element)\n        ) {\n          // we want to repeat the animation every time the the element is out of view and back again\n          triggered = false;\n          assign(element!.style, animation.steps[0].styles);\n        }\n      }\n\n      // TODO: roll all of these in one for more efficiency of checking all the rects\n      const onScroll = throttle(immediateOnScroll, 200, { leading: false });\n\n      // TODO: fully in view or partially\n      function isScrolledIntoView(elem: HTMLElement) {\n        const rect = elem.getBoundingClientRect();\n\n        const windowHeight = window.innerHeight;\n\n        const thresholdPercent = (animation.thresholdPercent || 0) / 100;\n        const threshold = thresholdPercent * windowHeight;\n\n        // TODO: partial in view? or what if element is larger than screen itself\n        return (\n          rect.bottom > threshold && rect.top < windowHeight - threshold // Element is peeking top or bottom\n          // (rect.top > 0 && rect.bottom < window.innerHeight) || // element fits within the screen and is fully on screen (not hanging off at all)\n          // (rect.top < 0 && rect.bottom > window.innerHeight) // element is larger than the screen and hangs over the top and bottom\n        );\n      }\n\n      const defaultState = animation.steps[0].styles;\n      function attachDefaultState() {\n        assign(element!.style, defaultState);\n      }\n      attachDefaultState();\n\n      // TODO: queue/batch these timeouts!\n      setTimeout(() => {\n        element.style.transition = `all ${animation.duration}s ${camelCaseToKebabCase(\n          animation.easing\n        )}`;\n        if (animation.delay) {\n          element.style.transitionDelay = animation.delay + 's';\n        }\n      });\n\n      // TODO: one listener for everything\n      document.addEventListener('scroll', onScroll, { capture: true, passive: true } as any);\n\n      // Do an initial check\n      immediateOnScroll();\n    });\n  }\n}\n","/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\nimport { IncomingMessage, ServerResponse } from 'http';\ninterface Options {\n  secure?: boolean;\n  expires?: Date;\n}\n\nclass Cookies {\n  secure?: boolean;\n\n  constructor(\n    private request: IncomingMessage,\n    private response: ServerResponse\n  ) {}\n\n  get(name: string) {\n    const header = this.request.headers['cookie'] as string;\n    if (!header) {\n      return;\n    }\n\n    const match = header.match(getPattern(name));\n    if (!match) {\n      return;\n    }\n\n    const value = match[1];\n    return value;\n  }\n\n  set(name: string, value: string, opts: Options) {\n    const res = this.response;\n    const req = this.request;\n    let headers = res.getHeader('Set-Cookie') || [];\n    // TODO: just make this always true\n    const secure =\n      this.secure !== undefined\n        ? !!this.secure\n        : (req as any).protocol === 'https' || (req.connection as any).encrypted;\n    const cookie = new Cookie(name, value, opts);\n\n    if (typeof headers === 'string') {\n      headers = [headers];\n    }\n\n    if (!secure && opts && opts.secure) {\n      throw new Error('Cannot send secure cookie over unencrypted connection');\n    }\n\n    cookie.secure = secure;\n    if (opts && 'secure' in opts) {\n      cookie.secure = !!opts.secure;\n    }\n\n    pushCookie(headers, cookie);\n\n    const setHeader = res.setHeader;\n    setHeader.call(res, 'Set-Cookie', headers);\n    return this;\n  }\n}\n\nclass Cookie {\n  path = '/';\n  expires?: Date;\n  domain: string | undefined = undefined;\n  httpOnly = true;\n  sameSite?: boolean | string = false;\n  secure = false;\n  overwrite = false;\n  name = '';\n  value = '';\n  maxAge?: number;\n\n  constructor(name: string, value: string, attrs: Options) {\n    if (!fieldContentRegExp.test(name)) {\n      throw new TypeError('argument name is invalid');\n    }\n\n    if (value && !fieldContentRegExp.test(value)) {\n      throw new TypeError('argument value is invalid');\n    }\n\n    if (!value) {\n      this.expires = new Date(0);\n    }\n\n    this.name = name;\n    this.value = value || '';\n\n    if (attrs.expires) {\n      this.expires = attrs.expires;\n    }\n    if (attrs.secure) {\n      this.secure = attrs.secure;\n    }\n  }\n\n  toString() {\n    return `${this.name}=${this.value}`;\n  }\n\n  toHeader() {\n    let header = this.toString();\n\n    if (this.maxAge) {\n      this.expires = new Date(Date.now() + this.maxAge);\n    }\n    if (this.path) {\n      header += `; path=${this.path}`;\n    }\n    if (this.expires) {\n      header += `; expires=${this.expires.toUTCString()}`;\n    }\n    if (this.domain) {\n      header += `; domain=${this.domain}`;\n    }\n\n    // TODO: samesite=none by default (?)\n    header += `; SameSite=${this.sameSite === true ? 'strict' : 'None'}`;\n\n    // TODO: On by default\n    if (this.secure) {\n      header += '; secure';\n    }\n    if (this.httpOnly) {\n      header += '; httponly';\n    }\n\n    return header;\n  }\n}\n\nfunction getPattern(name: string) {\n  return new RegExp(`(?:^|;) *${name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&')}=([^;]*)`);\n}\n\nfunction pushCookie(headers: any, cookie: Cookie) {\n  if (cookie.overwrite) {\n    for (let i = headers.length - 1; i >= 0; i--) {\n      if (headers[i].indexOf(`${cookie.name}=`) === 0) {\n        headers.splice(i, 1);\n      }\n    }\n  }\n\n  headers.push(cookie.toHeader());\n}\n\nexport default Cookies;\n","export function omit<T extends object>(obj: T, ...values: (keyof T)[]): Partial<T> {\n  const newObject = Object.assign({}, obj);\n  for (const key of values) {\n    delete (newObject as any)[key];\n  }\n  return newObject;\n}\n","/**\n * @credit https://stackoverflow.com/a/2117523\n */\nexport function uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c == 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\n/**\n * Slightly cleaner and smaller UUIDs\n */\nexport function uuid() {\n  return uuidv4().replace(/-/g, '');\n}\n","import { UrlWithStringQuery } from 'url';\n\ntype Fix<T> = { [P in keyof T]: T[P] | null };\n\n// It seems that the types for UrlWithStringQuery are not correct.\nexport type UrlLike = Fix<UrlWithStringQuery>;\n\nexport function emptyUrl(): UrlLike {\n  return {\n    query: null,\n    port: null,\n    auth: null,\n    hash: null,\n    host: null,\n    hostname: null,\n    href: null,\n    path: null,\n    pathname: null,\n    protocol: null,\n    search: null,\n    slashes: null,\n  };\n}\n\n// Replacement for `url.parse` using `URL` global object that works with relative paths.\n// Assumptions: this function operates in a NodeJS environment.\nexport function parse(url: string): UrlLike {\n  const out: UrlLike = emptyUrl();\n\n  let u;\n  const pathOnly = url === '' || url[0] === '/';\n\n  if (pathOnly) {\n    u = new URL(url, 'http://0.0.0.0/');\n    out.href = u.href;\n    out.href = out.href?.slice(14); // remove 'http://0.0.0.0/'\n  } else {\n    u = new URL(url);\n    out.href = u.href;\n    out.port = u.port === '' ? null : u.port;\n    out.hash = u.hash === '' ? null : u.hash;\n    out.host = u.host;\n    out.hostname = u.hostname;\n    out.href = u.href;\n    out.pathname = u.pathname;\n    out.protocol = u.protocol;\n    out.slashes = url[u.protocol.length] === '/'; // check if the mimetype is proceeded by a slash\n  }\n\n  out.search = u.search;\n  out.query = u.search.slice(1); // remove '?'\n  out.path = `${u.pathname}${u.search}`;\n  out.pathname = u.pathname;\n\n  return out;\n}\n","/**\n * Safe conversion to error type. Intended to be used in catch blocks where the\n *  value is not guaranteed to be an error.\n *\n *  @example\n *  try {\n *    throw new Error('Something went wrong')\n *  }\n *  catch (err: unknown) {\n *    const error: Error = toError(err)\n *  }\n */\nexport function toError(err: unknown): Error {\n  if (err instanceof Error) return err;\n  return new Error(String(err));\n}\n","export type ApiVersion = 'v1' | 'v3';\nexport const DEFAULT_API_VERSION: ApiVersion = 'v3';\n","export const SDK_VERSION = '6.1.2';\n","import './polyfills/custom-event-polyfill';\nimport { IncomingMessage, ServerResponse } from 'http';\nimport { nextTick } from './functions/next-tick.function';\nimport { QueryString } from './classes/query-string.class';\nimport { BehaviorSubject } from './classes/observable.class';\nimport { getFetch, SimplifiedFetchOptions } from './functions/fetch.function';\nimport { assign } from './functions/assign.function';\nimport { throttle } from './functions/throttle.function';\nimport { Animator } from './classes/animator.class';\nimport { BuilderElement } from './types/element';\nimport Cookies from './classes/cookies.class';\nimport { omit } from './functions/omit.function';\nimport { BuilderContent } from './types/content';\nimport { uuid } from './functions/uuid';\nimport { parse as urlParse } from './url';\n\n// Do not change this to a require! It throws runtime errors - rollup\n// will preserve the `require` and throw runtime errors\nimport hash from 'hash-sum';\nimport { toError } from './functions/to-error';\nimport { emptyUrl, UrlLike } from './url';\nimport { DEFAULT_API_VERSION, ApiVersion } from './types/api-version';\nimport { SDK_VERSION } from './sdk-version';\n\nexport type Url = any;\n\nfunction datePlusMinutes(minutes = 30) {\n  return new Date(Date.now() + minutes * 60000);\n}\n\nconst isPositiveNumber = (thing: unknown) =>\n  typeof thing === 'number' && !isNaN(thing) && thing >= 0;\n\nexport const isReactNative = typeof navigator === 'object' && navigator.product === 'ReactNative';\n\nexport const validEnvList = [\n  'production',\n  'qa',\n  'test',\n  'development',\n  'dev',\n  'cdn-qa',\n  'cloud',\n  'fast',\n  'cdn2',\n  'cdn-prod',\n];\n\nfunction getQueryParam(url: string, variable: string): string | null {\n  const query = url.split('?')[1] || '';\n  const vars = query.split('&');\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (decodeURIComponent(pair[0]) === variable) {\n      return decodeURIComponent(pair[1]);\n    }\n  }\n  return null;\n}\n\nconst urlParser = {\n  parse(url: string): UrlLike {\n    const el: HTMLAnchorElement = document.createElement('a') as any;\n    el.href = url;\n    const out: any = {};\n\n    const props = [\n      'username',\n      'password',\n      'host',\n      'hostname',\n      'port',\n      'protocol',\n      'origin',\n      'pathname',\n      'search',\n      'hash',\n    ] as const;\n\n    for (const prop of props) {\n      out[prop] = el[prop];\n    }\n\n    // IE 11 pathname handling workaround\n    // (IE omits preceeding '/', unlike other browsers)\n    if (\n      (out.pathname || out.pathname === '') &&\n      typeof out.pathname === 'string' &&\n      out.pathname.indexOf('/') !== 0\n    ) {\n      out.pathname = '/' + out.pathname;\n    }\n\n    return out;\n  },\n};\n\nconst parse: (url: string) => UrlLike = isReactNative\n  ? () => emptyUrl()\n  : typeof window === 'object'\n    ? urlParser.parse\n    : urlParse;\n\nfunction setCookie(name: string, value: string, expires?: Date) {\n  try {\n    let expiresString = '';\n\n    // TODO: need to know if secure server side\n    if (expires) {\n      expiresString = '; expires=' + expires.toUTCString();\n    }\n\n    const secure = isBrowser ? location.protocol === 'https:' : true;\n    document.cookie =\n      name +\n      '=' +\n      (value || '') +\n      expiresString +\n      '; path=/' +\n      (secure ? '; secure; SameSite=None' : '');\n  } catch (err) {\n    console.warn('Could not set cookie', err);\n  }\n}\n\nfunction getCookie(name: string) {\n  try {\n    return (\n      decodeURIComponent(\n        document.cookie.replace(\n          new RegExp(\n            '(?:(?:^|.*;)\\\\s*' +\n              encodeURIComponent(name).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') +\n              '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'\n          ),\n          '$1'\n        )\n      ) || null\n    );\n  } catch (err) {\n    console.warn('Could not get cookie', err);\n  }\n}\n\nfunction size(object: object) {\n  return Object.keys(object).length;\n}\n\nfunction find<T = any>(target: T[], callback: (item: T, index: number, list: T[]) => boolean) {\n  const list = target;\n  // Makes sures is always has an positive integer as length.\n  const length = list.length >>> 0;\n  const thisArg = arguments[1];\n  for (let i = 0; i < length; i++) {\n    const element = list[i];\n    if (callback.call(thisArg, element, i, list)) {\n      return element;\n    }\n  }\n}\n\nconst sessionStorageKey = 'builderSessionId';\nconst localStorageKey = 'builderVisitorId';\n\nexport const isBrowser = typeof window !== 'undefined' && !isReactNative;\nexport const isIframe = isBrowser && window.top !== window.self;\n\nexport interface ParamsMap {\n  [key: string]: any;\n}\n\ntype TrackingHook = (\n  eventData: Event,\n  context: { content?: BuilderContent; [key: string]: any }\n) => Event | undefined;\n\ninterface EventData {\n  contentId?: string;\n  ownerId: string;\n  variationId?: string;\n  userAttributes?: any;\n  targetSelector?: string;\n  targetBuilderElement?: string;\n  unique?: boolean;\n  metadata?: any | string;\n  meta?: any | string;\n  sessionId?: string;\n  visitorId?: string;\n  amount?: number;\n}\n// TODO: share interfaces with API\ninterface Event {\n  type: string;\n  data: EventData;\n}\n\n/**\n * Attributes that can be used for custom targeting. {@link\n * https://www.builder.io/c/docs/guides/targeting-and-scheduling}\n */\nexport interface UserAttributes {\n  [key: string]:\n    | undefined\n    | string\n    | string[]\n    | boolean\n    | boolean[]\n    | number\n    | number[]\n    | Record<string, any>;\n  /**\n   * URL path of the current user.\n   */\n  urlPath?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  queryString?: string | ParamsMap;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  device?: 'mobile' | 'tablet' | 'desktop';\n  /**\n   * @deprecated\n   * @hidden\n   */\n  location?: any;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  userAgent?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  referrer?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  entryMedium?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  language?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  browser?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  cookie?: string;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  newVisitor?: boolean;\n  /**\n   * @deprecated\n   * @hidden\n   */\n  operatingSystem?: string;\n}\n\ntype AllowEnrich =\n  | { apiVersion?: Extract<ApiVersion, 'v1'> }\n  | { apiVersion?: Extract<ApiVersion, 'v3'>; enrich?: boolean }\n  | { apiVersion?: never; enrich?: boolean };\n\nexport type GetContentOptions = AllowEnrich & {\n  /**\n   * Optional fetch options to be passed as the second argument to the `fetch` function.\n   */\n  fetchOptions?: object;\n\n  /**\n   * User attribute key value pairs to be used for targeting\n   * https://www.builder.io/c/docs/custom-targeting-attributes\n   *\n   * e.g.\n   * ```js\n   * userAttributes: {\n   *   urlPath: '/',\n   *   returnVisitor: true,\n   * }\n   * ```\n   */\n  userAttributes?: UserAttributes;\n  /**\n   * Alias for userAttributes.urlPath except it can handle a full URL (optionally with host,\n   * protocol, query, etc) and we will parse out the path.\n   */\n  url?: string;\n  /**\n   * @package\n   */\n  includeUrl?: boolean;\n  /**\n   * Include content of references in the response.\n   * If you use the `reference` field to pull in other content without this\n   * enabled we will not fetch that content for the final response.\n   * @deprecated use `enrich` instead\n   */\n  includeRefs?: boolean;\n  /**\n   * Seconds to cache content. Sets the max-age of the cache-control header\n   * response header.\n   *\n   * Use a higher value for better performance, lower for content that will change more frequently\n   *\n   * @see {@link https://www.builder.io/c/docs/query-api#__next:~:text=%26includeRefs%3Dtrue-,cacheSeconds,-No}\n   */\n  cacheSeconds?: number;\n  /**\n   * Builder.io uses stale-while-revalidate caching at the CDN level. This means we always serve\n   * from edge cache and update caches in the background for maximum possible performance. This also\n   * means that the more frequently content is requested, the more fresh it will be. The longest we\n   * will ever hold something in stale cache is 1 day by default, and you can set this to be shorter\n   * yourself as well. We suggest keeping this high unless you have content that must change rapidly\n   * and gets very little traffic.\n   *\n   * @see {@link https://www.fastly.com/blog/prevent-application-network-instability-serve-stale-content}\n   */\n  staleCacheSeconds?: number;\n  /**\n   * Maximum number of results to return. Defaults to `1`.\n   */\n  limit?: number;\n  /**\n   * Use to specify an offset for pagination of results. The default is 0.\n   */\n  offset?: number;\n  /**\n   * Mongodb style query of your data. E.g.:\n   *\n   * ```js\n   * query: {\n   *  id: 'abc123',\n   *  data: {\n   *    myCustomField: { $gt: 20 },\n   *  }\n   * }\n   * ```\n   *\n   * See more info on MongoDB's query operators and format.\n   *\n   * @see {@link https://docs.mongodb.com/manual/reference/operator/query/}\n   */\n  query?: any;\n  /**\n   * Bust through all caches. Not recommended for production (for performance),\n   * but can be useful for development and static builds (so the static site has\n   * fully fresh / up to date content)\n   */\n  cachebust?: boolean;\n  /**\n   * Convert any visual builder content to HTML.\n   *\n   * This will be on data.html of the response's content entry object json.\n   */\n  prerender?: boolean;\n  /**\n   * Extract any styles to a separate css property when generating HTML.\n   */\n  extractCss?: boolean;\n  /**\n   * @package\n   *\n   * `BuilderContent` to render instead of fetching.\n   */\n  initialContent?: any;\n  /**\n   * The name of the model to fetch content for.\n   */\n  model?: string;\n  /**\n   * Set to `false` to not cache responses when running on the client.\n   */\n  cache?: boolean;\n\n  /**\n   * Set to the current locale in your application if you want localized inputs to be auto-resolved, should match one of the locales keys in your space settings\n   * Learn more about adding or removing locales [here](https://www.builder.io/c/docs/add-remove-locales)\n   */\n  locale?: string;\n  /**\n   * @package\n   *\n   * Indicate that the fetch request is for preview purposes.\n   */\n  preview?: boolean;\n  /**\n   * Specific content entry ID to fetch.\n   */\n  entry?: string;\n  /**\n   * @package\n   * @deprecated\n   * @hidden\n   */\n  alias?: string;\n  /**\n   * Only include these fields.\n   * Note: 'omit' takes precedence over 'fields'\n   *\n   * @example\n   * ```\n   * fields: 'id, name, data.customField'\n   * ```\n   */\n  fields?: string;\n  /**\n   * Omit only these fields.\n   * Note: 'omit' takes precedence over 'fields'\n   *\n   * @example\n   * ```\n   * omit: 'data.bigField,data.blocks'\n   * ```\n   */\n  omit?: string;\n  key?: string;\n  /**\n   * @package\n   *\n   * Affects HTML generation for specific targets.\n   */\n  format?: 'amp' | 'email' | 'html' | 'react' | 'solid';\n  /**\n   * @deprecated\n   * @hidden\n   */\n  noWrap?: true;\n  /**\n   * @package\n   *\n   * Specific string to use for cache busting. e.g. every time we generate\n   * HTML we generate a rev (a revision ID) and we send that with each request\n   * on the client, such that if we generate new server HTML we get a new rev\n   * and we use that to bust the cache because even though the content ID may\n   * be the same, it could be an updated version of this content that needs to\n   * be fresh.\n   */\n  rev?: string;\n  /**\n   * @package\n   *\n   * Tell the API that when generating HTML to generate it in static mode for\n   * a/b tests instead of the older way we did this\n   */\n  static?: boolean;\n  /**\n   * Additional query params of the Content API to send.\n   */\n  options?: { [key: string]: any };\n  /**\n   * @package\n   *\n   * Don't listen to updates in the editor - this is useful for embedded\n   * symbols so they don't accidentally listen to messages as you are editing\n   * content thinking they should updates when they actually shouldn't.\n   */\n  noEditorUpdates?: boolean;\n\n  /**\n   * If set to `true`, it will lazy load symbols/references.\n   * If set to `false`, it will render the entire content tree eagerly.\n   * @deprecated use `enrich` instead\n   */\n  noTraverse?: boolean;\n\n  /**\n   * Property to order results by.\n   * Use 1 for ascending and -1 for descending.\n   *\n   * The key is what you're sorting on, so the following example sorts by createdDate\n   * and because the value is 1, the sort is ascending.\n   *\n   * @example\n   * ```\n   * createdDate: 1\n   * ```\n   */\n  sort?: { [key: string]: 1 | -1 };\n\n  /**\n   * Include content entries in a response that are still in\n   * draft mode and un-archived. Default is false.\n   */\n  includeUnpublished?: boolean;\n};\n\nexport type Class = {\n  name?: string;\n  new (...args: any[]): any;\n};\n\ninterface Map<K, V> {\n  clear(): void;\n  delete(key: K): boolean;\n  entries(): IterableIterator<[K, V]>;\n  forEach(callbackfn: (value: V, index: K, map: Map<K, V>) => void, thisArg?: any): void;\n  get(key: K): V;\n  has(key: K): boolean;\n  keys(): IterableIterator<K>;\n  set(key: K, value?: V): Map<K, V>;\n  size: number;\n  values(): IterableIterator<V>;\n  [Symbol.iterator](): IterableIterator<[K, V]>;\n}\n\n/**\n * This is the interface for inputs in `Builder.registerComponent`\n *\n * ```js\n * Builder.registerComponent(MyComponent, {\n *   inputs: [{ name: 'title', type: 'text' }] // <- Input[]\n * })\n * ```\n *\n * Learn more about registering custom components [here](https://www.builder.io/c/docs/custom-react-components)\n */\nexport interface Input {\n  /** This is the name of the component prop this input represents */\n  name: string;\n  /** A friendlier name to show in the UI if the component prop name is not ideal for end users */\n  friendlyName?: string;\n  /** @hidden @deprecated */\n  description?: string;\n  /** A default value to use */\n  defaultValue?: any;\n  /**\n   * The type of input to use, such as 'text'\n   *\n   * See all available inputs [here](https://www.builder.io/c/docs/custom-components-input-types)\n   * and you can create your own custom input types and associated editor UIs with [plugins](https://www.builder.io/c/docs/extending/plugins)\n   */\n  type: string;\n  /** Is this input mandatory or not */\n  required?: boolean;\n  /** @hidden */\n  autoFocus?: boolean;\n  subFields?: readonly Input[];\n  /**\n   * When input is of `type` `object`, use this field to collapse multiple inputs\n   * in the Visual Editor by default and preserve screen space.\n   */\n  folded?: boolean;\n  /**\n   * When input is of `type` `object`, provide guidance in the Visual Editor\n   * on how to edit this object's contents.\n   */\n  keysHelperText?: string;\n\n  /**\n   * Additional text to render in the UI to give guidance on how to use this\n   *\n   * @example\n   * ```js\n   * helperText: 'Be sure to use a proper URL, starting with \"https://\"'\n   * 111\n   */\n  helperText?: string;\n  /** @hidden */\n  allowedFileTypes?: readonly string[];\n  /** @hidden */\n  imageHeight?: number;\n  /** @hidden */\n  behavior?: string;\n  /** @hidden */\n  imageWidth?: number;\n  /** @hidden */\n  mediaHeight?: number;\n  /** @hidden */\n  mediaWidth?: number;\n  /** @hidden */\n  hideFromUI?: boolean;\n  /** @hidden */\n  modelId?: string;\n  /**\n   * Number field type validation maximum accepted input\n   */\n  max?: number;\n  /**\n   * Number field type validation minimum accepted input\n   */\n  min?: number;\n  /**\n   * Number field type step size when using arrows\n   */\n  step?: number;\n\n  /**\n   * Set this to `true` to show the editor for this input when\n   * children of this component are selected. This is useful for things\n   * like Tabs, such that users may not always select the Tabs component\n   * directly but will still be looking for how to add additional tabs\n   */\n  broadcast?: boolean;\n  /**\n   * Set this to `true` to show the editor for this input when\n   * group locked parents of this component are selected. This is useful\n   * to bubble up important inputs for locked groups, like text and images\n   */\n  bubble?: boolean;\n  /**\n   * Set this to `true` if you want this component to be translatable\n   */\n  localized?: boolean;\n  /** @hidden */\n  options?: { [key: string]: any };\n  /**\n   * For \"text\" input type, specifying an enum will show a dropdown of options instead\n   */\n  enum?:\n    | readonly string[]\n    | readonly { label: string; value: string | number | boolean; helperText?: string }[];\n  /** Regex field validation for all string types (text, longText, html, url, etc) */\n  regex?: {\n    /** pattern to test, like \"^\\/[a-z]$\" */\n    pattern: string;\n    /** flags for the RegExp constructor, e.g. \"gi\"  */\n    options?: string;\n    /**\n     * Friendly message to display to end-users if the regex fails, e.g.\n     * \"You must use a relative url starting with '/...' \"\n     */\n    message: string;\n  };\n  /**\n   * Set this to `true` to put this under the \"show more\" section of\n   * the options editor. Useful for things that are more advanced\n   * or more rarely used and don't need to be too prominent\n   */\n  advanced?: boolean;\n  /** @hidden */\n  onChange?: (\n    options: any,\n    previousOptions?: any\n  ) => Promise<void> | ((options: any, previousOptions?: any) => void) | string | void | undefined;\n  /** @hidden */\n  code?: boolean;\n  /** @hidden */\n  richText?: boolean;\n  /** @hidden */\n  showIf?: ((options: Map<string, any>) => boolean) | string;\n  /** @hidden */\n  copyOnAdd?: boolean;\n  /**\n   * Use optionally with inputs of type `reference`. Restricts the content entry picker to a specific model by name.\n   */\n  model?: string;\n\n  meta?: Record<string, any>;\n}\n\n/**\n * This is the interface for the options for `Builder.registerComponent`\n *\n * ```js\n * Builder.registerComponent(YourComponent, {\n *  // <- Component options\n * })\n * ```\n *\n * Learn more about registering custom components [here](https://www.builder.io/c/docs/custom-react-components)\n */\nexport interface Component {\n  /**\n   * Name your component something unique, e.g. 'MyButton'. You can override built-in components\n   * by registering a component with the same name, e.g. 'Text', to replace the built-in text component\n   */\n  name: string;\n  /** @hidden @deprecated */\n  description?: string;\n  /**\n   * Link to a documentation page for this component\n   */\n  docsLink?: string;\n  /**\n   * Link to an image to be used as an icon for this component in Builder's editor\n   *\n   * @example\n   * ```js\n   * image: 'https://some-cdn.com/my-icon-for-this-component.png'\n   * ```\n   */\n  image?: string;\n  /**\n   * Link to a screenshot shown when user hovers over the component in Builder's editor\n   * use https://builder.io/upload to upload your screeshot, for easier resizing by Builder.\n   */\n  screenshot?: string;\n\n  /**\n   * When overriding built-in components, if you don't want any special behavior that\n   * the original has, set this to `true` to skip the default behavior\n   *\n   * Default behaviors include special \"virtual options\", such as a custom\n   * aspect ratio editor for Images, or a special column editor for Columns\n   *\n   * Learn more about overriding built-in components here: https://www.builder.io/c/docs/custom-components-overriding\n   */\n  override?: boolean;\n\n  /**\n   * Input schema for your component for users to fill in the options via a UI\n   * that translate to this components props\n   */\n  inputs?: readonly Input[];\n  /** @hidden @deprecated */\n  class?: any;\n  /** @hidden @deprecated */\n  type?: 'angular' | 'webcomponent' | 'react' | 'vue';\n  /**\n   * Default styles to apply when droppged into the Builder.io editor\n   *\n   * @example\n   * ```js\n   * defaultStyles: {\n   *  appearance: 'none',\n   *  paddingTop: '15px',\n   *  paddingBottom: '15px',\n   *  paddingLeft: '25px',\n   *  paddingRight: '25px',\n   *  backgroundColor: '#000000',\n   *  color: 'white',\n   *  borderRadius: '4px',\n   * }\n   * ```\n   */\n  defaultStyles?: { [key: string]: string };\n  /**\n   * Turn on if your component can accept children. Be sure to use in combination with\n   * withChildren(YourComponent) like here\n   * github.com/BuilderIO/builder/blob/master/examples/react-design-system/src/components/HeroWithChildren/HeroWithChildren.builder.js#L5\n   */\n  canHaveChildren?: boolean;\n  /** @hidden */\n  fragment?: boolean;\n  /**\n   * Do not wrap a component in a dom element. Be sure to use {...props.attributes} with this option\n   * like here github.com/BuilderIO/builder/blob/master/packages/react/src/blocks/forms/Input.tsx#L34\n   */\n  noWrap?: boolean;\n  /**\n   * Default children\n   */\n  defaultChildren?: readonly BuilderElement[];\n  /**\n   * Default options to merge in when creating this block\n   */\n  defaults?: Partial<BuilderElement>;\n  /** @hidden @deprecated */\n  hooks?: { [key: string]: string | Function };\n  /**\n   * Hide your component in editor, useful for gradually deprecating components\n   */\n  hideFromInsertMenu?: boolean;\n  /** Custom tag name (for custom webcomponents only) */\n  tag?: string;\n  /** @hidden @deprecated */\n  static?: boolean;\n  /**\n   * Passing a list of model names will restrict using the component to only the models listed here, otherwise it'll be available for all models\n   */\n  models?: readonly string[];\n\n  /**\n   * Whether the component is a React Server Component\n   */\n  isRSC?: boolean;\n\n  /**\n   * Specify restrictions direct children must match\n   */\n  childRequirements?: {\n    /** Message to show when this doesn't match, e.g. \"Children of 'Columns' must be a 'Column'\" */\n    message: string;\n    /** Simple way to say children must be a specific component name */\n    component?: string;\n    /**\n     * More advanced - specify a MongoDB-style query (using sift.js github.com/crcn/sift.js)\n     * of what the children objects should match, e.g.\n     *\n     * @example\n     *  query: {\n     *    // Child of this element must be a 'Button' or 'Text' component\n     *    'component.name': { $in: ['Button', 'Text'] }\n     *  }\n     */\n    query?: any;\n  };\n\n  /**\n   * Specify restrictions any parent must match\n   */\n  requiresParent?: {\n    /** Message to show when this doesn't match, e.g. \"'Add to cart' buttons must be within a 'Product box'\" */\n    message: string;\n    /** Simple way to say a parent must be a specific component name, e.g. 'Product box' */\n    component?: string;\n\n    /**\n     * More advanced - specify a MongoDB-style query (using sift.js github.com/crcn/sift.js)\n     * of what at least one parent in the parents hierarchy should match, e.g.\n     *\n     * @example\n     *  query: {\n     *    // Thils element must be somewhere inside either a 'Product box' or 'Collection' component\n     *    'component.name': { $in: ['Product Box', 'Collection'] }\n     *  }\n     */\n    query?: any;\n  };\n\n  friendlyName?: string;\n\n  /**\n   * Use to restrict access to your component based on a the current user permissions\n   * By default components will show to all users\n   * for more information on permissions in builder check https://www.builder.io/c/docs/guides/roles-and-permissions\n   */\n  requiredPermissions?: Array<Permission>;\n\n  meta?: { [key: string]: any };\n}\n\ntype Permission = 'read' | 'publish' | 'editCode' | 'editDesigns' | 'admin' | 'create';\n\ntype DeepPartial<T> = {\n  [P in keyof T]?: T[P] extends Array<infer U>\n    ? Array<DeepPartial<U>>\n    : T[P] extends ReadonlyArray<infer U>\n      ? ReadonlyArray<DeepPartial<U>>\n      : DeepPartial<T[P]>;\n};\n\nexport interface InsertMenuItem {\n  name: string;\n  icon?: string;\n  item: DeepPartial<BuilderElement>;\n}\n\n/**\n * Use this to register custom sections in the Insert menu, for instance\n * to make new sections to organize your custom components\n *\n * ![Example of what a custom section looks like](https://cdn.builder.io/api/v1/image/assets%2F7f7bbcf72a1a4d72bac5daa359e7befd%2Fe5f2792e9c0f44ed89a9dcb77b945858)\n *\n * @example\n * ```js\n * Builder.register('insertMenu', {\n *   name: 'Our components',\n *   items: [\n *     { name: 'Hero' },\n *     { name: 'Double Columns' },\n *     { name: 'Triple Columns' },\n *     { name: 'Dynamic Columns' },\n *   ],\n * })\n * ```\n *\n * You can make as many custom sections as you like\n *\n * See a complete usage example [here](https://github.com/builderio/builder/blob/main/examples/react-design-system/src/builder-settings.js)\n */\nexport interface InsertMenuConfig {\n  name: string;\n  priority?: number;\n  persist?: boolean;\n  advanced?: boolean;\n  items: readonly InsertMenuItem[];\n}\n\nexport function BuilderComponent(info: Partial<Component> = {}) {\n  return Builder.Component(info);\n}\n\n// TODO\ntype Settings = any;\n\nexport interface Action {\n  name: string;\n  inputs?: readonly Input[];\n  returnType?: Input;\n  action: (options: Record<string, any>) => string;\n  /**\n   * Is an action for expression (e.g. calculating a binding like a formula\n   * to fill a value based on locale) or a function (e.g. something to trigger\n   * on an event like add to cart) or either (e.g. a custom code block)\n   */\n  kind: 'expression' | 'function' | 'any';\n  /**\n   * Globally unique ID for an action, e.g. \"@builder.io:setState\"\n   */\n  id: string;\n}\n\nexport class Builder {\n  static VERSION = SDK_VERSION;\n\n  static components: Component[] = [];\n  static singletonInstance: Builder;\n  /**\n   * Makes it so that a/b tests generate code like {@link\n   * https://www.builder.io/blog/high-performance-no-code#__next:~:text=Static%20generated%20A%2FB%20testing}\n   * instead of the old way where we render only one test group at a time on the\n   * server. This is the preferred/better way not and we should ultimately make it\n   * the default\n   */\n  static isStatic = true;\n  static animator = new Animator();\n\n  static nextTick = nextTick;\n  static throttle = throttle;\n\n  static editors: any[] = [];\n  static trustedHosts: string[] = [\n    '*.beta.builder.io',\n    'beta.builder.io',\n    'builder.io',\n    'localhost',\n    'qa.builder.io',\n  ];\n  static serverContext: any;\n  static plugins: any[] = [];\n\n  static actions: Action[] = [];\n  static registry: { [key: string]: any[] } = {};\n  static overrideHost: string | undefined;\n  static attributesCookieName = 'builder.userAttributes';\n\n  /**\n   * @todo `key` property on any info where if a key matches a current\n   * key it gets removed\n   */\n  static register(type: 'insertMenu', info: InsertMenuConfig): void;\n  static register(type: string, info: any): void;\n  static register(type: string, info: any) {\n    if (type === 'plugin') {\n      info = this.serializeIncludingFunctions(info, true);\n    }\n\n    // TODO: all must have name and can't conflict?\n    let typeList = this.registry[type];\n    if (!typeList) {\n      typeList = this.registry[type] = [];\n    }\n    typeList.push(info);\n    if (Builder.isBrowser) {\n      const message = {\n        type: 'builder.register',\n        data: {\n          type,\n          info,\n        },\n      };\n      try {\n        parent.postMessage(message, '*');\n        if (parent !== window) {\n          window.postMessage(message, '*');\n        }\n      } catch (err) {\n        console.debug('Could not postmessage', err);\n      }\n    }\n    this.registryChange.next(this.registry);\n  }\n\n  static registryChange = new BehaviorSubject({} as typeof Builder.registry);\n\n  static registerEditor(info: any) {\n    if (Builder.isBrowser) {\n      window.postMessage(\n        {\n          type: 'builder.registerEditor',\n          data: omit(info, 'component'),\n        },\n        '*'\n      );\n      const { hostname } = location;\n\n      if (!Builder.isTrustedHost(hostname)) {\n        console.error(\n          'Builder.registerEditor() called in the wrong environment! You cannot load custom editors from your app, they must be loaded through the Builder.io app itself. Follow the readme here for more details: https://github.com/builderio/builder/tree/master/plugins/cloudinary or contact chat us in our Spectrum community for help: https://spectrum.chat/builder'\n        );\n      }\n    }\n    this.editors.push(info);\n  }\n\n  static registerPlugin(info: any) {\n    this.plugins.push(info);\n  }\n\n  static registerAction(action: Action) {\n    this.actions.push(action);\n\n    if (Builder.isBrowser) {\n      const actionClone = JSON.parse(JSON.stringify(action));\n      if (action.action) {\n        actionClone.action = action.action.toString();\n      }\n      window.parent?.postMessage(\n        {\n          type: 'builder.registerAction',\n          data: actionClone,\n        },\n        '*'\n      );\n    }\n  }\n\n  static registerTrustedHost(host: string) {\n    this.trustedHosts.push(host);\n  }\n\n  /**\n   * @param context @type {import('isolated-vm').Context}\n   * Use this function to control the execution context of custom code on the server.\n   * const ivm = require('isolated-vm');\n   * const isolate = new ivm.Isolate({ memoryLimit: 128 });\n   * const context = isolate.createContextSync();\n   * Builder.setServerContext(context);\n   */\n  static setServerContext(context: any) {\n    this.serverContext = context;\n  }\n\n  static isTrustedHost(hostname: string) {\n    const isTrusted =\n      this.trustedHosts.findIndex(trustedHost =>\n        trustedHost.startsWith('*.')\n          ? hostname.endsWith(trustedHost.slice(1))\n          : trustedHost === hostname\n      ) > -1;\n\n    return isTrusted;\n  }\n\n  static isTrustedHostForEvent(event: MessageEvent) {\n    if (event.origin === 'null') {\n      return false;\n    }\n    const url = parse(event.origin);\n    return url.hostname && Builder.isTrustedHost(url.hostname);\n  }\n\n  static runAction(action: Action | string) {\n    // TODO\n    const actionObject =\n      typeof action === 'string' ? find(this.actions, item => item.name === action) : action;\n\n    if (!actionObject) {\n      throw new Error(`Action not found: ${action}`);\n    }\n  }\n\n  static fields(name: string, fields: readonly Input[]) {\n    window.parent?.postMessage(\n      {\n        type: 'builder.fields',\n        data: { name, fields },\n      },\n      '*'\n    );\n  }\n\n  private static _editingPage = false;\n\n  static isIframe = isIframe;\n  static isBrowser = isBrowser;\n  static isReactNative = isReactNative;\n  static isServer = !isBrowser && !isReactNative;\n  static previewingModel = Builder.isBrowser && getQueryParam(location.href, 'builder.preview');\n\n  static settings: Settings = {};\n  static settingsChange = new BehaviorSubject<Settings>({});\n\n  /**\n   * @deprecated\n   * @hidden\n   *\n   * Use Builder.register('editor.settings', {}) instead.\n   */\n  static set(settings: Settings): void {\n    Builder.register('editor.settings', settings);\n  }\n\n  static import(packageName: string) {\n    if (!Builder.isBrowser) {\n      // TODO: server side support *maybe*\n      console.warn('Builder.import used on the server - this should only be used in the browser');\n      return;\n    }\n    const { System } = window as any;\n\n    if (!System) {\n      console.warn('System.js not available. Please include System.js when using Builder.import');\n      return;\n    }\n    return System.import(`https://cdn.builder.io/systemjs/${packageName}`);\n  }\n\n  // TODO: this is quick and dirty, do better implementation later. Also can be unreliable\n  // if page 301s etc. Use a query param instead? also could have issues with redirects. Injecting var could\n  // work but is async...\n  static isEditing = Boolean(\n    isIframe &&\n      ((document.referrer && document.referrer.match(/builder\\.io|localhost:1234/)) ||\n        location.search.indexOf('builder.frameEditing=') !== -1)\n  );\n\n  static isPreviewing = Boolean(\n    isBrowser &&\n      (location.search.indexOf('builder.preview=') !== -1 ||\n        location.search.indexOf('builder.frameEditing=') !== -1)\n  );\n\n  // useCdnApi = false;\n\n  static get editingPage() {\n    return this._editingPage;\n  }\n\n  static set editingPage(editingPage) {\n    this._editingPage = editingPage;\n    if (isBrowser && isIframe) {\n      if (editingPage) {\n        document.body.classList.add('builder-editing-page');\n      } else {\n        document.body.classList.remove('builder-editing-page');\n      }\n    }\n  }\n\n  private static serializeIncludingFunctions(info: any, isForPlugin?: boolean) {\n    const serializeFn = (fnValue: Function) => {\n      const fnStr = fnValue.toString().trim();\n\n      // we need to account for a few different fn syntaxes:\n      // 1. `function name(args) => {code}`\n      // 2. `name(args) => {code}`\n      // 3. `(args) => {}`\n      // 4. `args => {}`\n      // 5. `async function(args) {code}`\n      // 6. `async (args) => {}`\n      // 7. `async args => {}`\n      const isArrowWithoutParens = /^[a-zA-Z0-9_]+\\s*=>/i.test(fnStr);\n      const appendFunction =\n        !fnStr.startsWith('function') &&\n        !fnStr.startsWith('async') &&\n        !fnStr.startsWith('(') &&\n        !isArrowWithoutParens;\n\n      return `return (${appendFunction ? 'function ' : ''}${fnStr}).apply(this, arguments)`;\n    };\n\n    const objToReturn = JSON.parse(\n      JSON.stringify(info, (key, value) => {\n        const shouldNotSerializeFn = isForPlugin && key === 'onSave';\n        if (typeof value === 'function' && !shouldNotSerializeFn) {\n          return serializeFn(value);\n        }\n        return value;\n      })\n    );\n\n    if (isForPlugin) {\n      objToReturn.onSave = info.onSave;\n    }\n\n    return objToReturn;\n  }\n\n  private static prepareComponentSpecToSend(spec: Component): Component {\n    return {\n      ...this.serializeIncludingFunctions(spec),\n      class: undefined,\n    };\n  }\n\n  static registerBlock(component: any, options: Component) {\n    this.registerComponent(component, options);\n  }\n\n  static registerComponent(component: any, options: Component) {\n    const spec = {\n      class: component,\n      ...component.builderOptions,\n      ...options,\n    };\n    this.addComponent(spec);\n    const editable =\n      options.models && this.singletonInstance.editingModel\n        ? isBrowser && options.models.includes(this.singletonInstance.editingModel)\n        : isBrowser;\n    if (editable) {\n      const sendSpec = this.prepareComponentSpecToSend(spec);\n      window.parent?.postMessage(\n        {\n          type: 'builder.registerComponent',\n          data: sendSpec,\n        },\n        '*'\n      );\n    }\n  }\n\n  private static addComponent(component: Component) {\n    const current = find(this.components, item => item.name === component.name);\n    if (current) {\n      // FIXME: why does sometimes we get an extra post without class - probably\n      // from postMessage handler wrong in some place\n      if (current.class && !component.class) {\n        return;\n      }\n      this.components.splice(this.components.indexOf(current), 1, component);\n    } else {\n      this.components.push(component);\n    }\n  }\n\n  // TODO: style guide, etc off this system as well?\n  static component(info: Partial<Component> = {}) {\n    return (component: Class) => {\n      const spec = { ...info, class: component };\n      if (!spec.name) {\n        spec.name = component.name;\n      }\n      this.addComponent(spec as Component);\n\n      const sendSpec = this.prepareComponentSpecToSend(spec as Component);\n      // TODO: serialize component name and inputs\n      if (isBrowser) {\n        window.parent?.postMessage(\n          {\n            type: 'builder.registerComponent',\n            data: sendSpec,\n          },\n          '*'\n        );\n      }\n      return component;\n    };\n  }\n\n  static isReact = false;\n  static sdkInfo = undefined as\n    | {\n        name: string;\n        version: string;\n      }\n    | undefined;\n\n  static get Component() {\n    return this.component;\n  }\n\n  private eventsQueue: Event[] = [];\n\n  private throttledClearEventsQueue = throttle(() => {\n    this.processEventsQueue();\n    // Extend the session cookie\n    this.setCookie(sessionStorageKey, this.sessionId, datePlusMinutes(30));\n  }, 5);\n\n  private processEventsQueue() {\n    if (!this.eventsQueue.length) {\n      return;\n    }\n    const events = this.eventsQueue;\n    this.eventsQueue = [];\n\n    const fullUserAttributes = {\n      ...Builder.overrideUserAttributes,\n      ...this.trackingUserAttributes,\n    };\n    for (const event of events) {\n      if (!event.data.metadata) {\n        event.data.metadata = {};\n      }\n      if (!event.data.metadata.user) {\n        event.data.metadata.user = {};\n      }\n      Object.assign(event.data.metadata.user, fullUserAttributes, event.data.metadata.user);\n    }\n\n    const host = this.host;\n\n    getFetch()(`${host}/api/v1/track`, {\n      method: 'POST',\n      body: JSON.stringify({ events }),\n      headers: {\n        'content-type': 'application/json',\n        ...this.getSdkHeaders(),\n      },\n      mode: 'cors',\n    }).catch(() => {\n      // Not the end of the world\n    });\n  }\n\n  env: string = 'production';\n\n  sessionId = this.getSessionId();\n\n  targetContent = true;\n\n  contentPerRequest = 1;\n\n  // TODO: make array or function\n  allowCustomFonts = true;\n\n  private cookies: Cookies | null = null;\n\n  // TODO: api options object\n  private cachebust = false;\n  private overrideParams = '';\n  private noCache = false;\n  private preview = false;\n\n  get browserTrackingDisabled() {\n    return Builder.isBrowser && Boolean((window as any).builderNoTrack || !navigator.cookieEnabled);\n  }\n\n  get canTrack() {\n    return this.canTrack$.value;\n  }\n\n  set canTrack(canTrack) {\n    this.hasOverriddenCanTrack = true;\n    if (this.canTrack !== canTrack) {\n      this.canTrack$.next(canTrack);\n    }\n  }\n\n  get apiVersion() {\n    return this.apiVersion$.value;\n  }\n\n  set apiVersion(apiVersion: ApiVersion | undefined) {\n    if (this.apiVersion !== apiVersion) {\n      this.apiVersion$.next(apiVersion);\n    }\n  }\n\n  get apiEndpoint() {\n    return this.apiEndpoint$.value;\n  }\n\n  set apiEndpoint(apiEndpoint: 'content' | 'query') {\n    if (this.apiEndpoint !== apiEndpoint) {\n      this.apiEndpoint$.next(apiEndpoint);\n    }\n  }\n\n  /**\n   * Dictates which API endpoint is used when fetching content. Allows `'content'` and `'query'`.\n   * Defaults to `'query'`.\n   */\n  private apiEndpoint$ = new BehaviorSubject<'content' | 'query'>('query');\n  private apiVersion$ = new BehaviorSubject<ApiVersion | undefined>(undefined);\n  private canTrack$ = new BehaviorSubject(!this.browserTrackingDisabled);\n  private hasOverriddenCanTrack = false;\n  private apiKey$ = new BehaviorSubject<string | null>(null);\n  private authToken$ = new BehaviorSubject<string | null>(null);\n\n  userAttributesChanged = new BehaviorSubject<any>(null);\n\n  get editingMode() {\n    return this.editingMode$.value;\n  }\n\n  set editingMode(value) {\n    if (value !== this.editingMode) {\n      this.editingMode$.next(value);\n    }\n  }\n\n  editingMode$ = new BehaviorSubject(isIframe);\n\n  get editingModel() {\n    return this.editingModel$.value;\n  }\n\n  set editingModel(value) {\n    if (value !== this.editingModel) {\n      this.editingModel$.next(value);\n    }\n  }\n\n  private findParentElement(\n    target: HTMLElement,\n    callback: (element: HTMLElement) => boolean,\n    checkElement = true\n  ): HTMLElement | null {\n    if (!(target instanceof HTMLElement)) {\n      return null;\n    }\n    let parent: HTMLElement | null = checkElement ? target : target.parentElement;\n    do {\n      if (!parent) {\n        return null;\n      }\n\n      const matches = callback(parent);\n      if (matches) {\n        return parent;\n      }\n    } while ((parent = parent.parentElement));\n\n    return null;\n  }\n\n  private findBuilderParent(target: HTMLElement) {\n    return this.findParentElement(target, el => {\n      const id = el.getAttribute('builder-id') || el.id;\n      return Boolean(id && id.indexOf('builder-') === 0);\n    });\n  }\n\n  // TODO: decorator to do this stuff with the get/set (how do with typing too? compiler?)\n  editingModel$ = new BehaviorSubject<null | string>(null);\n\n  setUserAgent(userAgent: string) {\n    this.userAgent = userAgent || '';\n  }\n  userAgent: string = (typeof navigator === 'object' && navigator.userAgent) || '';\n\n  trackingHooks: TrackingHook[] = [];\n\n  /**\n   * Set a hook to modify events being tracked from builder, such as impressions and clicks\n   *\n   * For example, to track the model ID of each event associated with content for querying\n   * by mode, you can do\n   *\n   *    builder.setTrackingHook((event, context) => {\n   *      if (context.content) {\n   *        event.data.metadata.modelId = context.content.modelId\n   *      }\n   *    })\n   */\n  setTrackingHook(hook: TrackingHook) {\n    this.trackingHooks.push(hook);\n  }\n\n  track(eventName: string, properties: Partial<EventData> = {}, context?: any) {\n    // TODO: queue up track requests and fire them off when canTrack set to true - otherwise may get lots of clicks with no impressions\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n\n    const apiKey = this.apiKey;\n    if (!apiKey) {\n      console.error(\n        'Builder integration error: Looks like the Builder SDK has not been initialized properly (your API key has not been set). Make sure you are calling `builder.init(\"YOUR-API-KEY\");` as early as possible in your application\\'s code.'\n      );\n      return;\n    }\n\n    let eventData: Event = JSON.parse(\n      JSON.stringify({\n        type: eventName,\n        data: {\n          ...omit(properties, 'meta'),\n          metadata: {\n            sdkVersion: Builder.VERSION,\n            url: location.href,\n            ...properties.meta,\n            ...properties.metadata,\n          },\n          ownerId: apiKey,\n          userAttributes: this.getUserAttributes(),\n          sessionId: this.sessionId,\n          visitorId: this.visitorId,\n        },\n      })\n    );\n\n    for (const hook of this.trackingHooks) {\n      const returnValue = hook(eventData, context || {});\n      if (returnValue) {\n        eventData = returnValue;\n      }\n    }\n\n    // batch events\n    this.eventsQueue.push(eventData);\n\n    if (this.canTrack) {\n      this.throttledClearEventsQueue();\n    }\n  }\n\n  getSessionId() {\n    let sessionId: string | null = null;\n    try {\n      if (Builder.isBrowser && typeof sessionStorage !== 'undefined') {\n        sessionId = this.getCookie(sessionStorageKey);\n      }\n    } catch (err) {\n      console.debug('Session storage error', err);\n      // It's ok\n    }\n\n    if (!sessionId) {\n      sessionId = uuid();\n    }\n\n    // Give the app a second to start up and set canTrack to false if needed\n    if (Builder.isBrowser) {\n      setTimeout(() => {\n        try {\n          if (this.canTrack) {\n            this.setCookie(sessionStorageKey, sessionId, datePlusMinutes(30));\n          }\n        } catch (err) {\n          console.debug('Cookie setting error', err);\n        }\n      });\n    }\n    return sessionId;\n  }\n\n  // Set this to control the userId\n  // TODO: allow changing it mid session and updating existing data to be associated\n  // e.g. for when a user navigates and then logs in\n  visitorId: string = this.getVisitorId();\n\n  getVisitorId() {\n    if (this.visitorId) {\n      return this.visitorId;\n    }\n    let visitorId: string | null = null;\n    try {\n      if (Builder.isBrowser && typeof localStorage !== 'undefined') {\n        // TODO: cookie instead?\n        visitorId = localStorage.getItem(localStorageKey);\n      }\n    } catch (err) {\n      console.debug('Local storage error', err);\n      // It's ok\n    }\n\n    if (!visitorId) {\n      visitorId = uuid();\n    }\n\n    this.visitorId = visitorId;\n\n    // Give the app a second to start up and set canTrack to false if needed\n    if (Builder.isBrowser) {\n      setTimeout(() => {\n        try {\n          if (this.canTrack && typeof localStorage !== 'undefined' && visitorId) {\n            localStorage.setItem(localStorageKey, visitorId);\n          }\n        } catch (err) {\n          console.debug('Session storage error', err);\n        }\n      });\n    }\n    return visitorId;\n  }\n\n  trackImpression(contentId: string, variationId?: string, properties?: any, context?: any) {\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    // TODO: use this.track method\n    this.track(\n      'impression',\n      {\n        contentId,\n        variationId: variationId !== contentId ? variationId : undefined,\n        metadata: properties,\n      },\n      context\n    );\n  }\n\n  trackConversion(amount?: number, customProperties?: any): void;\n  trackConversion(\n    amount?: number,\n    contentId?: string | any,\n    variationId?: string,\n    customProperties?: any,\n    context?: any\n  ) {\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    const meta = typeof contentId === 'object' ? contentId : customProperties;\n    const useContentId = typeof contentId === 'string' ? contentId : undefined;\n\n    this.track('conversion', { amount, variationId, meta, contentId: useContentId }, context);\n  }\n\n  autoTrack = !Builder.isBrowser\n    ? false\n    : !this.isDevelopmentEnv &&\n      !(Builder.isBrowser && location.search.indexOf('builder.preview=') !== -1);\n\n  // TODO: set this for QA\n  private get isDevelopmentEnv() {\n    // Automatic determining of development environment\n    return (\n      Builder.isIframe ||\n      (Builder.isBrowser && (location.hostname === 'localhost' || location.port !== '')) ||\n      this.env !== 'production'\n    );\n  }\n\n  trackInteraction(\n    contentId: string,\n    variationId?: string,\n    alreadyTrackedOne = false,\n    event?: MouseEvent,\n    context?: any\n  ) {\n    if (isIframe || !isBrowser || Builder.isPreviewing) {\n      return;\n    }\n    const target = event && (event.target as HTMLElement);\n    const targetBuilderElement = target && this.findBuilderParent(target);\n\n    function round(num: number) {\n      return Math.round(num * 1000) / 1000;\n    }\n\n    const metadata: any = {};\n    if (event) {\n      const { clientX, clientY } = event;\n      if (target) {\n        const targetRect = target.getBoundingClientRect();\n        const xOffset = clientX - targetRect.left;\n        const yOffset = clientY - targetRect.top;\n\n        const xRatio = round(xOffset / targetRect.width);\n        const yRatio = round(yOffset / targetRect.height);\n\n        metadata.targetOffset = {\n          x: xRatio,\n          y: yRatio,\n        };\n      }\n      if (targetBuilderElement) {\n        const targetRect = targetBuilderElement.getBoundingClientRect();\n        const xOffset = clientX - targetRect.left;\n        const yOffset = clientY - targetRect.top;\n\n        const xRatio = round(xOffset / targetRect.width);\n        const yRatio = round(yOffset / targetRect.height);\n\n        metadata.builderTargetOffset = {\n          x: xRatio,\n          y: yRatio,\n        };\n      }\n    }\n\n    const builderId =\n      targetBuilderElement &&\n      (targetBuilderElement.getAttribute('builder-id') || targetBuilderElement.id);\n\n    if (builderId && targetBuilderElement) {\n      metadata.builderElementIndex = ([] as Element[]).slice\n        .call(document.getElementsByClassName(builderId))\n        .indexOf(targetBuilderElement);\n    }\n\n    this.track(\n      'click',\n      {\n        contentId,\n        metadata,\n        variationId: variationId !== contentId ? variationId : undefined,\n        unique: !alreadyTrackedOne,\n        targetBuilderElement: builderId || undefined,\n      },\n      context\n    );\n  }\n\n  static overrideUserAttributes: Partial<UserAttributes> = {};\n\n  trackingUserAttributes: { [key: string]: any } = {};\n\n  component(info: Partial<Component> = {}) {\n    return Builder.component(info);\n  }\n\n  get apiKey() {\n    return this.apiKey$.value;\n  }\n\n  set apiKey(key: string | null) {\n    this.apiKey$.next(key);\n  }\n\n  get authToken() {\n    return this.authToken$.value;\n  }\n\n  set authToken(token: string | null) {\n    this.authToken$.next(token);\n  }\n\n  constructor(\n    apiKey: string | null = null,\n    protected request?: IncomingMessage,\n    protected response?: ServerResponse,\n    forceNewInstance = false,\n    authToken: string | null = null,\n    apiVersion?: ApiVersion\n  ) {\n    // TODO: use a window variable for this perhaps, e.g. bc webcomponents may be loading builder twice\n    // with it's and react (use rollup build to fix)\n    if (Builder.isBrowser && !forceNewInstance && Builder.singletonInstance) {\n      return Builder.singletonInstance;\n    }\n\n    if (this.request && this.response) {\n      this.setUserAgent((this.request.headers['user-agent'] as string) || '');\n      this.cookies = new Cookies(this.request, this.response);\n    }\n\n    if (apiKey) {\n      this.apiKey = apiKey;\n    }\n    if (apiVersion) {\n      this.apiVersion = apiVersion;\n    }\n    if (authToken) {\n      this.authToken = authToken;\n    }\n    if (isBrowser) {\n      if (Builder.isEditing) {\n        this.bindMessageListeners();\n\n        parent.postMessage(\n          {\n            type: 'builder.animatorOptions',\n            data: {\n              options: {\n                version: 2,\n              },\n            },\n          },\n          '*'\n        );\n      }\n      // TODO: postmessage to parent the builder info for every package\n      // type: 'builder.sdk', data: { name: '@builder.io/react', version: '0.1.23' }\n      // (window as any).BUILDER_VERSION = Builder.VERSION;\n      // Ensure always one Builder global singleton\n      // TODO: some people won't want this, e.g. rakuten\n      // Maybe hide this behind symbol or on document, etc\n      // if ((window as any).Builder) {\n      //   Builder.components = (window as any).Builder.components;\n      // } else {\n      //   (window as any).Builder = Builder;\n      // }\n    }\n\n    if (isIframe) {\n      this.messageFrameLoaded();\n    }\n\n    // TODO: on destroy clear subscription\n    this.canTrack$.subscribe((value: any) => {\n      if (value) {\n        if (typeof sessionStorage !== 'undefined') {\n          try {\n            if (!sessionStorage.getItem(sessionStorageKey)) {\n              sessionStorage.setItem(sessionStorageKey, this.sessionId);\n            }\n          } catch (err) {\n            console.debug('Session storage error', err);\n          }\n        }\n        if (this.eventsQueue.length) {\n          this.throttledClearEventsQueue();\n        }\n        if (this.cookieQueue.length) {\n          this.cookieQueue.forEach(item => {\n            this.setCookie(item[0], item[1]);\n          });\n          this.cookieQueue.length = 0;\n        }\n      }\n    });\n\n    if (isBrowser) {\n      // TODO: defer so subclass constructor runs and injects location service\n      this.setTestsFromUrl();\n      // TODO: do this on every request send?\n      this.getOverridesFromQueryString();\n\n      // cookies used in personalization container script, so need to set before hydration to match script result\n      const userAttrCookie = this.getCookie(Builder.attributesCookieName);\n      if (userAttrCookie) {\n        try {\n          const attributes = JSON.parse(userAttrCookie);\n          this.setUserAttributes(attributes);\n        } catch (err) {\n          console.debug('Error parsing user attributes cookie', err);\n        }\n      }\n    }\n  }\n\n  private modifySearch(search: string) {\n    return search.replace(\n      /(^|&|\\?)(builder_.*?)=/gi,\n      (_match, group1, group2) => group1 + group2.replace(/_/g, '.') + '='\n    );\n  }\n\n  setTestsFromUrl() {\n    const search = this.getLocation().search;\n    try {\n      const params = QueryString.parseDeep(this.modifySearch(search || '').substr(1));\n      const tests = params.builder && params.builder.tests;\n      if (tests && typeof tests === 'object') {\n        for (const key in tests) {\n          if (tests.hasOwnProperty(key)) {\n            this.setTestCookie(key, tests[key]);\n          }\n        }\n      }\n    } catch (e) {\n      console.debug('Error parsing tests from URL', e);\n    }\n  }\n\n  resetOverrides() {\n    // Ugly - pass down instances per request instead using react context\n    // or use builder.get('foo', { req, res }) in react...........\n    Builder.overrideUserAttributes = {};\n    this.cachebust = false;\n    this.noCache = false;\n    this.preview = false;\n    this.editingModel = null;\n    this.overrides = {};\n    this.env = 'production';\n    this.userAgent = '';\n    this.request = undefined;\n    this.response = undefined;\n  }\n\n  getOverridesFromQueryString() {\n    const location = this.getLocation();\n    try {\n      const params = QueryString.parseDeep(this.modifySearch(location.search || '').substr(1));\n      const { builder } = params;\n      if (builder) {\n        const {\n          userAttributes,\n          overrides,\n          env,\n          host,\n          api,\n          cachebust,\n          noCache,\n          preview,\n          editing,\n          frameEditing,\n          options,\n          params: overrideParams,\n        } = builder;\n\n        if (userAttributes) {\n          this.setUserAttributes(userAttributes);\n        }\n\n        if (options) {\n          // picking only locale, includeRefs, and enrich for now\n          this.queryOptions = {\n            ...(options.locale && { locale: options.locale }),\n            ...(options.includeRefs && { includeRefs: options.includeRefs }),\n            ...(options.enrich && { enrich: options.enrich }),\n          };\n        }\n\n        if (overrides) {\n          this.overrides = overrides;\n        }\n\n        if (validEnvList.indexOf(env || api) > -1) {\n          this.env = env || api;\n        }\n\n        if (Builder.isEditing) {\n          const editingModel = frameEditing || editing || preview;\n          if (editingModel && editingModel !== 'true') {\n            this.editingModel = editingModel;\n          }\n        }\n\n        if (cachebust) {\n          this.cachebust = true;\n        }\n\n        if (noCache) {\n          this.noCache = true;\n        }\n\n        if (preview) {\n          this.preview = true;\n        }\n\n        if (params) {\n          this.overrideParams = overrideParams;\n        }\n      }\n    } catch (e) {\n      console.debug('Error parsing overrides from URL', e);\n    }\n  }\n\n  private messageFrameLoaded() {\n    window.parent?.postMessage(\n      {\n        type: 'builder.loaded',\n        data: {\n          value: true,\n        },\n      },\n      '*'\n    );\n  }\n\n  private blockContentLoading = '';\n\n  private bindMessageListeners() {\n    addEventListener('message', event => {\n      const isTrusted = Builder.isTrustedHostForEvent(event);\n      if (!isTrusted) return;\n\n      const { data } = event;\n      if (data) {\n        switch (data.type) {\n          case 'builder.ping': {\n            window.parent?.postMessage(\n              {\n                type: 'builder.pong',\n                data: {},\n              },\n              '*'\n            );\n            break;\n          }\n          case 'builder.register': {\n            // TODO: possibly do this for all...\n            if (event.source === window) {\n              break;\n            }\n            const options = data.data;\n            if (!options) {\n              break;\n            }\n            const { type, info } = options;\n            // TODO: all must have name and can't conflict?\n            let typeList = Builder.registry[type];\n            if (!typeList) {\n              typeList = Builder.registry[type] = [];\n            }\n            typeList.push(info);\n            Builder.registryChange.next(Builder.registry);\n            break;\n          }\n          case 'builder.settingsChange': {\n            // TODO: possibly do this for all...\n            if (event.source === window) {\n              break;\n            }\n            const settings = data.data;\n            if (!settings) {\n              break;\n            }\n            Object.assign(Builder.settings, settings);\n            Builder.settingsChange.next(Builder.settings);\n            break;\n          }\n          case 'builder.registerEditor': {\n            // TODO: possibly do this for all...\n            if (event.source === window) {\n              break;\n            }\n            const info = data.data;\n            if (!info) {\n              break;\n            }\n            const hasComponent = !!info.component;\n            Builder.editors.every((thisInfo, index) => {\n              if (info.name === thisInfo.name) {\n                if (thisInfo.component && !hasComponent) {\n                  return false;\n                } else {\n                  Builder.editors[index] = thisInfo;\n                }\n                return false;\n              }\n              return true;\n            });\n            break;\n          }\n          case 'builder.triggerAnimation': {\n            Builder.animator.triggerAnimation(data.data);\n            break;\n          }\n          case 'builder.contentUpdate':\n            const key = data.data.key || data.data.alias || data.data.entry || data.data.modelName;\n            const contentData = data.data.data; // hmmm...\n            const observer = this.observersByKey[key];\n            if (observer && !this.noEditorUpdates[key]) {\n              observer.next([contentData]);\n            }\n            break;\n\n          case 'builder.getComponents':\n            window.parent?.postMessage(\n              {\n                type: 'builder.components',\n                data: Builder.components.map(item => Builder.prepareComponentSpecToSend(item)),\n              },\n              '*'\n            );\n            break;\n\n          case 'builder.editingModel':\n            this.editingModel = data.data.model;\n            break;\n\n          case 'builder.registerComponent':\n            const componentData = data.data;\n            Builder.addComponent(componentData);\n            break;\n\n          case 'builder.blockContentLoading':\n            if (typeof data.data.model === 'string') {\n              this.blockContentLoading = data.data.model;\n            }\n            break;\n\n          case 'builder.editingMode':\n            const editingMode = data.data;\n            if (editingMode) {\n              this.editingMode = true;\n              document.body.classList.add('builder-editing');\n            } else {\n              this.editingMode = false;\n              document.body.classList.remove('builder-editing');\n            }\n            break;\n\n          case 'builder.editingPageMode':\n            const editingPageMode = data.data;\n            Builder.editingPage = editingPageMode;\n            break;\n\n          case 'builder.overrideUserAttributes':\n            const userAttributes = data.data;\n            assign(Builder.overrideUserAttributes, userAttributes);\n            this.flushGetContentQueue(true);\n            // TODO: refetch too\n            break;\n\n          case 'builder.overrideTestGroup':\n            const { variationId, contentId } = data.data;\n            if (variationId && contentId) {\n              this.setTestCookie(contentId, variationId);\n              this.flushGetContentQueue(true);\n            }\n            break;\n          case 'builder.evaluate': {\n            const text = data.data.text;\n            const args = data.data.arguments || [];\n            const id = data.data.id;\n            // tslint:disable-next-line:no-function-constructor-with-string-args\n            const fn = new Function(text);\n            let result: any;\n            let error: Error | null = null;\n            try {\n              result = fn.apply(this, args);\n            } catch (err) {\n              error = toError(err);\n            }\n\n            if (error) {\n              window.parent?.postMessage(\n                {\n                  type: 'builder.evaluateError',\n                  data: { id, error: error.message },\n                },\n                '*'\n              );\n            } else {\n              if (result && typeof result.then === 'function') {\n                (result as Promise<any>)\n                  .then(finalResult => {\n                    window.parent?.postMessage(\n                      {\n                        type: 'builder.evaluateResult',\n                        data: { id, result: finalResult },\n                      },\n                      '*'\n                    );\n                  })\n                  .catch(console.error);\n              } else {\n                window.parent?.postMessage(\n                  {\n                    type: 'builder.evaluateResult',\n                    data: { result, id },\n                  },\n                  '*'\n                );\n              }\n            }\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  observersByKey: { [key: string]: BehaviorSubject<BuilderContent[]> | undefined } = {};\n  noEditorUpdates: { [key: string]: boolean } = {};\n\n  get defaultCanTrack() {\n    return Boolean(\n      Builder.isBrowser &&\n        navigator.userAgent.trim() &&\n        !navigator.userAgent.match(\n          /bot|crawler|spider|robot|crawling|prerender|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex|phantom|headless|selenium|puppeteer/i\n        ) &&\n        !this.browserTrackingDisabled\n    );\n  }\n\n  init(\n    apiKey: string,\n    canTrack = this.defaultCanTrack,\n    req?: IncomingMessage,\n    res?: ServerResponse,\n    authToken?: string | null,\n    apiVersion?: ApiVersion\n  ) {\n    if (req) {\n      this.request = req;\n    }\n    if (res) {\n      this.response = res;\n    }\n    if (!this.hasOverriddenCanTrack) {\n      this.canTrack = canTrack;\n    }\n    this.apiKey = apiKey;\n    if (authToken) {\n      this.authToken = authToken;\n    }\n    if (apiVersion) {\n      this.apiVersion = apiVersion;\n    }\n    return this;\n  }\n\n  get previewingModel() {\n    const search = this.getLocation().search;\n    const params = QueryString.parse((search || '').substr(1));\n    return params['builder.preview'];\n  }\n\n  // TODO: allow adding location object as property and/or in constructor\n  getLocation(): Url {\n    let parsedLocation: any = {};\n\n    // in ssr mode\n    if (this.request) {\n      parsedLocation = parse(this.request.url ?? '');\n    } else if (typeof location === 'object') {\n      // in the browser\n      parsedLocation = parse(location.href);\n    }\n\n    // IE11 bug with parsed path being empty string\n    // causes issues with our user targeting\n    if (parsedLocation.pathname === '') {\n      parsedLocation.pathname = '/';\n    }\n\n    return parsedLocation;\n  }\n\n  getUserAttributes(userAgent = this.userAgent || '') {\n    const isMobile = {\n      Android() {\n        return userAgent.match(/Android/i);\n      },\n      BlackBerry() {\n        return userAgent.match(/BlackBerry/i);\n      },\n      iOS() {\n        return userAgent.match(/iPhone|iPod/i);\n      },\n      Opera() {\n        return userAgent.match(/Opera Mini/i);\n      },\n      Windows() {\n        return userAgent.match(/IEMobile/i) || userAgent.match(/WPDesktop/i);\n      },\n      any() {\n        return (\n          isMobile.Android() ||\n          isMobile.BlackBerry() ||\n          isMobile.iOS() ||\n          isMobile.Opera() ||\n          isMobile.Windows()\n        );\n      },\n    };\n\n    const isTablet = userAgent.match(/Tablet|iPad/i);\n\n    const url = this.getLocation();\n\n    return {\n      urlPath: url.pathname,\n      host: url.host || url.hostname,\n      // TODO: maybe an option to choose to target off of mobile/tablet/desktop or just mobile/desktop\n      device: isTablet ? 'tablet' : isMobile.any() ? 'mobile' : 'desktop',\n      ...Builder.overrideUserAttributes,\n    } as UserAttributes;\n  }\n\n  protected overrides: { [key: string]: string } = {};\n  protected queryOptions: { [key: string]: string } = {};\n\n  private getContentQueue: null | GetContentOptions[] = null;\n  private priorContentQueue: null | GetContentOptions[] = null;\n\n  setUserAttributes(options: object) {\n    assign(Builder.overrideUserAttributes, options);\n    if (this.canTrack) {\n      this.setCookie(Builder.attributesCookieName, JSON.stringify(this.getUserAttributes()));\n    }\n\n    this.userAttributesChanged.next(options);\n  }\n\n  /**\n   * Set user attributes just for tracking purposes.\n   *\n   * Do this so properties exist on event objects for querying insights, but\n   * won't affect targeting\n   *\n   * Use this when you want to track properties but don't need to target off\n   * of them to optimize cache efficiency\n   */\n  setTrackingUserAttributes(attributes: object) {\n    assign(this.trackingUserAttributes, attributes);\n  }\n\n  get(\n    modelName: string,\n    options: GetContentOptions & {\n      req?: IncomingMessage;\n      res?: ServerResponse;\n      apiKey?: string;\n      authToken?: string;\n    } = {}\n  ) {\n    let instance: Builder = this;\n    let finalLocale =\n      options.locale || options.userAttributes?.locale || this.getUserAttributes().locale;\n\n    if (!('noTraverse' in options)) {\n      options.noTraverse = false;\n    }\n\n    let finalOptions = {\n      ...options,\n      ...(finalLocale && {\n        locale: String(finalLocale),\n        userAttributes: {\n          locale: String(finalLocale),\n          ...options.userAttributes,\n        },\n      }),\n    };\n    if (!Builder.isBrowser) {\n      instance = new Builder(\n        options.apiKey || this.apiKey,\n        options.req,\n        options.res,\n        undefined,\n        options.authToken || this.authToken,\n        options.apiVersion || this.apiVersion\n      );\n      instance.apiEndpoint = this.apiEndpoint;\n      instance.setUserAttributes(this.getUserAttributes());\n    } else {\n      // NOTE: All these are when .init is not called and the customer\n      // directly calls .get on the singleton instance of Builder\n      if (options.apiKey && !this.apiKey) {\n        this.apiKey = options.apiKey;\n      }\n      if (options.authToken && !this.authToken) {\n        this.authToken = options.authToken;\n      }\n      if (options.apiVersion && !this.apiVersion) {\n        this.apiVersion = options.apiVersion;\n      }\n    }\n    return instance.queueGetContent(modelName, finalOptions).map(\n      /* map( */ (matches: any[] | null) => {\n        const match = matches && matches[0];\n        if (Builder.isStatic) {\n          return match;\n        }\n\n        const matchData = match && match.data;\n        if (!matchData) {\n          return null;\n        }\n\n        if (typeof matchData.blocksString !== 'undefined') {\n          matchData.blocks = JSON.parse(matchData.blocksString);\n          delete matchData.blocksString;\n        }\n\n        return {\n          // TODO: add ab test info here and other high level stuff\n          data: matchData,\n          id: match.id,\n          variationId: match.testVariationId || match.variationId || null,\n          testVariationId: match.testVariationId || match.variationId || null,\n          testVariationName: match.testVariationName || null,\n          lastUpdated: match.lastUpdated || null,\n        };\n      }\n    );\n    // );\n  }\n\n  // TODO: entry id in options\n  queueGetContent(modelName: string, options: GetContentOptions = {}) {\n    // TODO: if query do modelName + query\n    const key =\n      options.key ||\n      options.alias ||\n      // TODO: SDKs only pass entry key when given to them, and never when editing...\n      // options.entry ||\n\n      // TODO: this is ugly - instead of multiple of same model with different options are sent\n      // say requires key/alias. Or if not perhaps make a reliable hash of the options and use that.\n      // TODO: store last user state on last request and if user attributes different now\n      // give a warning that need to use keys to request new contente\n      // (options &&\n      //   Object.keys(options).filter(key => key !== 'model').length &&\n      //   JSON.stringify({ model: modelName, ...options, initialContent: undefined })) ||\n      modelName;\n\n    const isEditingThisModel = this.editingModel === modelName;\n    // TODO: include params in this key........\n    const currentObservable = this.observersByKey[key] as BehaviorSubject<BuilderContent[]> | null;\n\n    // if (options.query && options.query._id) {\n    //   this.flushGetContentQueue([options])\n    // }\n\n    if (this.apiKey === 'DEMO' && !this.overrides[key] && !options.initialContent) {\n      options.initialContent = [];\n    }\n\n    const { initialContent } = options;\n\n    // TODO: refresh option in options\n    if (currentObservable && (!currentObservable.value || options.cache)) {\n      // TODO: test if this ran, otherwise on 404 some observers may never be called...\n      if (currentObservable.value) {\n        nextTick(() => {\n          // TODO: return a new observable and only that one fires subscribers, don't refire for existing ones\n          currentObservable.next(currentObservable.value);\n        });\n      }\n      return currentObservable;\n    }\n    if (isEditingThisModel) {\n      if (Builder.isBrowser) {\n        parent.postMessage({ type: 'builder.updateContent', data: { options } }, '*');\n      }\n    }\n    if (!initialContent /* || isEditingThisModel */) {\n      if (!this.getContentQueue) {\n        this.getContentQueue = [];\n      }\n\n      this.getContentQueue.push({ ...options, model: modelName, key });\n      if (this.getContentQueue && this.getContentQueue.length >= this.contentPerRequest) {\n        const queue = this.getContentQueue.slice();\n        this.getContentQueue = [];\n        nextTick(() => {\n          this.flushGetContentQueue(false, queue);\n        });\n      } else {\n        nextTick(() => {\n          this.flushGetContentQueue();\n        });\n      }\n    }\n\n    const observable = new BehaviorSubject<BuilderContent[]>(null as any);\n    this.observersByKey[key] = observable;\n    if (options.noEditorUpdates) {\n      this.noEditorUpdates[key] = true;\n    }\n    if (initialContent) {\n      nextTick(() => {\n        // TODO: need to testModify this I think...?\n        observable.next(initialContent);\n      });\n    }\n    return observable;\n  }\n\n  // this is needed to satisfy the Angular SDK, which used to rely on the more complex version of `requestUrl`.\n  // even though we only use `fetch()` now, we prefer to keep the old behavior and use the `fetch` that comes from\n  // the core SDK for consistency\n  requestUrl(\n    url: string,\n    options?: { headers: { [header: string]: number | string | string[] | undefined }; next?: any }\n  ) {\n    return getFetch()(url, this.addSdkHeaders(options)).then(res => res.json());\n  }\n\n  get host() {\n    switch (this.env) {\n      case 'qa':\n        return 'https://qa.builder.io';\n      case 'test':\n        return 'https://builder-io-test.web.app';\n      case 'fast':\n        return 'https://fast.builder.io';\n      case 'cloud':\n        return 'https://cloud.builder.io';\n      case 'cdn2':\n        return 'https://cdn2.builder.io';\n      case 'cdn-qa':\n        return 'https://cdn-qa.builder.io';\n      case 'development':\n      case 'dev':\n        return 'http://localhost:5000';\n      case 'cdn-prod':\n        return 'https://cdn.builder.io';\n      default:\n        return Builder.overrideHost || 'https://cdn.builder.io';\n    }\n  }\n\n  private getSdkHeaders():\n    | {\n        'X-Builder-SDK': string;\n        'X-Builder-SDK-GEN': '1';\n        'X-Builder-SDK-Version': string;\n      }\n    | {} {\n    if (!Builder.sdkInfo) {\n      return {};\n    }\n\n    return {\n      'X-Builder-SDK': Builder.sdkInfo.name,\n      'X-Builder-SDK-GEN': '1',\n      'X-Builder-SDK-Version': Builder.sdkInfo.version,\n    } as const;\n  }\n\n  private addSdkHeaders(fetchOptions: any) {\n    return {\n      ...fetchOptions,\n      headers: {\n        ...fetchOptions.headers,\n        ...this.getSdkHeaders(),\n      },\n    };\n  }\n\n  private makeFetchApiCall(url: string, requestOptions: any): Promise<any> {\n    return getFetch()(url, this.addSdkHeaders(requestOptions));\n  }\n\n  /**\n   * Flatten a nested MongoDB query object into a flat object with dot-separated keys.\n   * $ keys are not flattened and are left as is.\n   *\n   * { foo: { bar: { $gt: 5 }}} -> { 'foo.bar': { '$gt': 5 }}\n   * { foo: {'bar.id': { $elemMatch: { 'baz.id': { $in: ['abc', 'bcd'] }}}}} -> { 'foo.bar.id': { '$elemMatch': { 'baz.id': { '$in': ['abc', 'bcd'] }}}}\n   */\n  private flattenMongoQuery(obj: any, _current?: any, _res: any = {}): { [key: string]: string } {\n    for (const key in obj) {\n      const value = obj[key];\n      const newKey = _current ? _current + '.' + key : key;\n      if (\n        value &&\n        typeof value === 'object' &&\n        !Array.isArray(value) &&\n        !Object.keys(value).find(item => item.startsWith('$'))\n      ) {\n        this.flattenMongoQuery(value, newKey, _res);\n      } else {\n        _res[newKey] = value;\n      }\n    }\n    return _res;\n  }\n\n  private flushGetContentQueue(usePastQueue = false, useQueue?: GetContentOptions[]) {\n    if (!this.apiKey) {\n      throw new Error(\n        `Fetching content failed, expected apiKey to be defined instead got: ${this.apiKey}`\n      );\n    }\n\n    if (this.apiVersion) {\n      if (!['v1', 'v3'].includes(this.apiVersion)) {\n        throw new Error(`Invalid apiVersion: expected 'v1' or 'v3', received '${this.apiVersion}'`);\n      }\n    } else {\n      this.apiVersion = DEFAULT_API_VERSION;\n    }\n\n    if (!usePastQueue && !this.getContentQueue) {\n      return;\n    }\n\n    const queue = useQueue || (usePastQueue ? this.priorContentQueue : this.getContentQueue) || [];\n\n    // TODO: do this on every request send?\n    this.getOverridesFromQueryString();\n\n    const queryParams: ParamsMap = {\n      // TODO: way to force a request to be in a separate queue. or just lower queue limit to be 1 by default\n      omit: queue[0].omit ?? 'meta.componentsUsed',\n      apiKey: this.apiKey,\n      ...queue[0].options,\n      ...this.queryOptions,\n    };\n\n    if (queue[0].locale) {\n      queryParams.locale = queue[0].locale;\n    }\n    if (queue[0].fields) {\n      queryParams.fields = queue[0].fields;\n    }\n    if (queue[0].format) {\n      queryParams.format = queue[0].format;\n    }\n    if ('noTraverse' in queue[0]) {\n      queryParams.noTraverse = queue[0].noTraverse;\n    }\n    if ('includeUnpublished' in queue[0]) {\n      queryParams.includeUnpublished = queue[0].includeUnpublished;\n    }\n    if (queue[0].sort) {\n      queryParams.sort = queue[0].sort;\n    }\n\n    const pageQueryParams: ParamsMap =\n      (typeof location !== 'undefined'\n        ? QueryString.parseDeep(location.search.substr(1))\n        : undefined) || {}; // TODO: WHAT about SSR (this.request) ?\n\n    const userAttributes =\n      // FIXME: HACK: only checks first in queue for user attributes overrides, should check all\n      // TODO: merge user attributes provided here with defaults and current user attiributes (?)\n      queue && queue[0].userAttributes\n        ? queue[0].userAttributes\n        : this.targetContent\n          ? this.getUserAttributes()\n          : {\n              urlPath: this.getLocation().pathname,\n            };\n\n    const fullUrlQueueItem = queue.find(item => !!item.includeUrl);\n    if (fullUrlQueueItem) {\n      const location = this.getLocation();\n      if (location.origin) {\n        queryParams.url = `${location.origin}${location.pathname}${location.search}`;\n      }\n    }\n\n    const urlQueueItem = useQueue?.find(item => item.url);\n    if (urlQueueItem?.url) {\n      userAttributes.urlPath = urlQueueItem.url.split('?')[0];\n    }\n    // TODO: merge in the attribute from query string ones\n    // TODO: make this an option per component/request\n    queryParams.userAttributes = JSON.stringify(userAttributes);\n\n    if (!usePastQueue && !useQueue) {\n      this.priorContentQueue = queue;\n      this.getContentQueue = null;\n    }\n\n    const cachebust =\n      this.cachebust ||\n      isIframe ||\n      pageQueryParams.cachebust ||\n      pageQueryParams['builder.cachebust'];\n\n    if (cachebust || this.env !== 'production') {\n      queryParams.cachebust = true;\n    }\n\n    if (Builder.isEditing) {\n      queryParams.isEditing = true;\n    }\n\n    if (this.noCache || this.env !== 'production') {\n      queryParams.noCache = true;\n    }\n\n    if (size(this.overrides)) {\n      for (const key in this.overrides) {\n        if (this.overrides.hasOwnProperty(key)) {\n          queryParams[`overrides.${key}`] = this.overrides[key];\n        }\n      }\n    }\n\n    for (const options of queue) {\n      const format = options.format;\n\n      if (format) {\n        queryParams.format = format;\n      }\n      // TODO: remove me and make permodel\n      if (options.static) {\n        queryParams.static = options.static;\n      }\n\n      if (options.cachebust) {\n        queryParams.cachebust = options.cachebust;\n      }\n\n      if (isPositiveNumber(options.cacheSeconds)) {\n        queryParams.cacheSeconds = options.cacheSeconds;\n      }\n\n      if (isPositiveNumber(options.staleCacheSeconds)) {\n        queryParams.staleCacheSeconds = options.staleCacheSeconds;\n      }\n\n      if (this.apiEndpoint === 'content') {\n        queryParams.includeRefs = true;\n      }\n\n      const properties: (keyof GetContentOptions)[] = [\n        'prerender',\n        'extractCss',\n        'limit',\n        'offset',\n        'query',\n        'preview',\n        'model',\n        'entry',\n        'rev',\n        'static',\n        'includeRefs',\n      ];\n\n      for (const key of properties) {\n        const value = options[key];\n        if (value !== undefined) {\n          if (this.apiEndpoint === 'query') {\n            queryParams.options = queryParams.options || {};\n            queryParams.options[options.key!] = queryParams.options[options.key!] || {};\n            queryParams.options[options.key!][key] = JSON.stringify(value);\n          } else {\n            queryParams[key] = JSON.stringify(value);\n          }\n        }\n      }\n    }\n    if (this.preview && this.previewingModel === queue?.[0]?.model) {\n      queryParams.preview = 'true';\n    }\n    const hasParams = Object.keys(queryParams).length > 0;\n\n    // TODO: option to force dev or qa api here\n    const host = this.host;\n\n    const keyNames = queue.map(item => encodeURIComponent(item.key!)).join(',');\n\n    if (this.overrideParams) {\n      const params = omit(QueryString.parse(this.overrideParams), 'apiKey');\n      assign(queryParams, params);\n    }\n\n    const format = queryParams.format;\n    const isApiCallForCodegen = format === 'solid' || format === 'react';\n    const isApiCallForCodegenOrQuery = isApiCallForCodegen || this.apiEndpoint === 'query';\n\n    if (this.apiEndpoint === 'content') {\n      if (queue[0].query) {\n        delete queryParams.query;\n        const objectToFlatten = { query: queue[0].query };\n        const flattened = this.flattenMongoQuery(objectToFlatten);\n        for (const key in flattened) {\n          queryParams[key] = JSON.stringify(flattened[key]);\n        }\n      }\n    }\n\n    const queryStr = QueryString.stringifyDeep(queryParams);\n\n    const fetchOptions = { headers: {}, ...queue[0].fetchOptions };\n    if (this.authToken) {\n      fetchOptions.headers = {\n        ...fetchOptions.headers,\n        Authorization: `Bearer ${this.authToken}`,\n      };\n    }\n\n    let url;\n    if (isApiCallForCodegen) {\n      url = `${host}/api/v1/codegen/${this.apiKey}/${keyNames}`;\n    } else if (this.apiEndpoint === 'query') {\n      url = `${host}/api/v3/query/${this.apiKey}/${keyNames}`;\n    } else {\n      url = `${host}/api/v3/content/${queue[0].model}`;\n    }\n\n    url = url + (queryParams && hasParams ? `?${queryStr}` : '');\n\n    const promise = this.makeFetchApiCall(url, fetchOptions)\n      .then(res => res.json())\n      .then(\n        result => {\n          for (const options of queue) {\n            const keyName = options.key!;\n            if (options.model === this.blockContentLoading && !options.noEditorUpdates) {\n              continue;\n            }\n\n            const isEditingThisModel = this.editingModel === options.model;\n            if (isEditingThisModel && Builder.isEditing) {\n              parent.postMessage({ type: 'builder.updateContent', data: { options } }, '*');\n              // return;\n            }\n            const observer = this.observersByKey[keyName];\n            if (!observer) {\n              return;\n            }\n            const data = isApiCallForCodegenOrQuery ? result[keyName] : result.results;\n            const sorted = data; // sortBy(data, item => item.priority);\n            if (data) {\n              const testModifiedResults = Builder.isServer\n                ? sorted\n                : this.processResultsForTests(sorted);\n              observer.next(testModifiedResults);\n            } else {\n              const search = this.getLocation().search;\n              if ((search || '').includes('builder.preview=' + options.model)) {\n                const previewData = {\n                  id: 'preview',\n                  name: 'Preview',\n                  data: {},\n                };\n                observer.next([previewData]);\n              }\n              observer.next([]);\n            }\n          }\n        },\n        err => {\n          for (const options of queue) {\n            const observer = this.observersByKey[options.key!];\n            if (!observer) {\n              return;\n            }\n            observer.error(err);\n          }\n        }\n      );\n\n    return promise;\n  }\n\n  private testCookiePrefix = 'builder.tests';\n\n  private processResultsForTests(results: BuilderContent[]) {\n    const mappedResults = results.map(item => {\n      if (!item.variations) {\n        return item;\n      }\n      const cookieValue = this.getTestCookie(item.id!);\n      const cookieVariation = cookieValue === item.id ? item : item.variations[cookieValue];\n      if (cookieVariation) {\n        return {\n          ...item,\n          data: cookieVariation.data,\n          variationId: cookieValue,\n          testVariationId: cookieValue,\n          testVariationName: cookieVariation.name,\n        };\n      }\n      if (this.canTrack && item.variations && size(item.variations)) {\n        let n = 0;\n        const random = Math.random();\n        for (const id in item.variations) {\n          const variation = item.variations[id]!;\n          const testRatio = variation.testRatio;\n          n += testRatio!;\n          if (random < n) {\n            this.setTestCookie(item.id!, variation.id!);\n            const variationName =\n              variation.name || (variation.id === item.id ? 'Default variation' : '');\n            return {\n              ...item,\n              data: variation.data,\n              variationId: variation.id,\n              testVariationId: variation.id,\n              variationName: variationName,\n              testVariationName: variationName,\n            };\n          }\n        }\n        this.setTestCookie(item.id!, item.id!);\n      }\n      return {\n        ...item,\n        variationId: item.id,\n        ...(item.variations &&\n          size(item.variations) && {\n            testVariationId: item.id,\n            testVariationName: 'Default variation',\n          }),\n      };\n    });\n\n    if (isIframe) {\n      window.parent?.postMessage(\n        { type: 'builder.contentResults', data: { results: mappedResults } },\n        '*'\n      );\n    }\n\n    return mappedResults;\n  }\n\n  private getTestCookie(contentId: string) {\n    return this.getCookie(`${this.testCookiePrefix}.${contentId}`);\n  }\n\n  private cookieQueue: [string, string][] = [];\n\n  private setTestCookie(contentId: string, variationId: string) {\n    if (!this.canTrack) {\n      this.cookieQueue.push([contentId, variationId]);\n      return;\n    }\n\n    // 30 days from now\n    const future = new Date();\n    future.setDate(future.getDate() + 30);\n\n    return this.setCookie(`${this.testCookiePrefix}.${contentId}`, variationId, future);\n  }\n\n  getCookie(name: string): any {\n    if (this.cookies) {\n      return this.cookies.get(name);\n    }\n    return Builder.isBrowser && getCookie(name);\n  }\n\n  setCookie(name: string, value: any, expires?: Date) {\n    if (this.cookies && !(Builder.isServer && Builder.isStatic)) {\n      return this.cookies.set(name, value, {\n        expires,\n        secure: this.getLocation().protocol === 'https:',\n      });\n    }\n    return Builder.isBrowser && setCookie(name, value, expires);\n  }\n\n  getContent(modelName: string, options: GetContentOptions = {}) {\n    if (!this.apiKey) {\n      throw new Error(\n        `Fetching content from model ${modelName} failed, expected apiKey to be defined instead got: ${this.apiKey}`\n      );\n    }\n    return this.queueGetContent(modelName, options);\n  }\n\n  getAll(\n    modelName: string,\n    options: GetContentOptions & {\n      req?: IncomingMessage;\n      res?: ServerResponse;\n      apiKey?: string;\n      authToken?: string;\n    } = {}\n  ): Promise<BuilderContent[]> {\n    let instance: Builder = this;\n    if (!Builder.isBrowser) {\n      instance = new Builder(\n        options.apiKey || this.apiKey,\n        options.req,\n        options.res,\n        false,\n        options.authToken || this.authToken,\n        options.apiVersion || this.apiVersion\n      );\n      instance.setUserAttributes(this.getUserAttributes());\n    } else {\n      // NOTE: All these are when .init is not called and the customer\n      // directly calls .get on the singleton instance of Builder\n      if (options.apiKey && !this.apiKey) {\n        this.apiKey = options.apiKey;\n      }\n      if (options.authToken && !this.authToken) {\n        this.authToken = options.authToken;\n      }\n      if (options.apiVersion && !this.apiVersion) {\n        this.apiVersion = options.apiVersion;\n      }\n    }\n\n    // Set noTraverse=true if NOT already passed by user, for query performance\n    if (!('noTraverse' in options)) {\n      options.noTraverse = true;\n    }\n\n    return instance\n      .getContent(modelName, {\n        limit: 30,\n        ...options,\n        key:\n          options.key ||\n          // Make the key include all options, so we don't reuse cache for the same content fetched\n          // with different options\n          Builder.isBrowser\n            ? `${modelName}:${hash(omit(options, 'initialContent', 'req', 'res'))}`\n            : undefined,\n      })\n      .promise();\n  }\n}\n","import { Builder } from '../builder.class';\n\nexport const builder = new Builder(null, undefined, undefined, true);\nBuilder.singletonInstance = builder;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}