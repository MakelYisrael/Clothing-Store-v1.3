{"ast":null,"code":"import{doc,getDoc,setDoc,collection,getDocs,deleteDoc}from\"firebase/firestore\";import{db}from\"../lib/firebase\";import{USERS_COLLECTION,USER_ADDRESSES_SUB,USER_ORDERS_SUB}from\"../lib/collections\";import{stripUndefined}from\"../lib/firestore-utils\";export async function loadUserData(uid){const ref=doc(db,USERS_COLLECTION,uid);const snap=await getDoc(ref);return snap.exists()?snap.data():{};}export async function saveWishlist(uid,wishlist){const ref=doc(db,USERS_COLLECTION,uid);await setDoc(ref,stripUndefined({wishlist}),{merge:true});}export async function saveCart(uid,cart){const ref=doc(db,USERS_COLLECTION,uid);await setDoc(ref,stripUndefined({cart}),{merge:true});}export async function clearOldUserData(uid){const addrSnap=await getDocs(collection(db,\"users\",uid,USER_ADDRESSES_SUB));for(const d of addrSnap.docs){await deleteDoc(doc(db,\"users\",uid,USER_ADDRESSES_SUB,d.id));}const ordSnap=await getDocs(collection(db,\"users\",uid,USER_ORDERS_SUB));for(const d of ordSnap.docs){await deleteDoc(doc(db,\"users\",uid,USER_ORDERS_SUB,d.id));}await deleteDoc(doc(db,\"users\",uid));}","map":{"version":3,"names":["doc","getDoc","setDoc","collection","getDocs","deleteDoc","db","USERS_COLLECTION","USER_ADDRESSES_SUB","USER_ORDERS_SUB","stripUndefined","loadUserData","uid","ref","snap","exists","data","saveWishlist","wishlist","merge","saveCart","cart","clearOldUserData","addrSnap","d","docs","id","ordSnap"],"sources":["D:/JHFshop/src/services/userData.ts"],"sourcesContent":["import { doc, getDoc, setDoc, collection, getDocs, deleteDoc } from \"firebase/firestore\";\nimport { db } from \"../lib/firebase\";\nimport { USERS_COLLECTION, USER_ADDRESSES_SUB, USER_ORDERS_SUB } from \"../lib/collections\";\nimport { stripUndefined } from \"../lib/firestore-utils\";\nimport type { CartItem } from \"../components/cart-sheet\";\n\nexport type UserStoredData = {\n  wishlist?: string[];\n  cart?: CartItem[];\n};\n\nexport async function loadUserData(uid: string): Promise<UserStoredData> {\n  const ref = doc(db, USERS_COLLECTION, uid);\n  const snap = await getDoc(ref);\n  return (snap.exists() ? (snap.data() as UserStoredData) : {}) as UserStoredData;\n}\n\nexport async function saveWishlist(uid: string, wishlist: string[]) {\n  const ref = doc(db, USERS_COLLECTION, uid);\n  await setDoc(ref, stripUndefined({ wishlist }), { merge: true });\n}\n\nexport async function saveCart(uid: string, cart: CartItem[]) {\n  const ref = doc(db, USERS_COLLECTION, uid);\n  await setDoc(ref, stripUndefined({ cart }), { merge: true });\n}\n\nexport async function clearOldUserData(uid: string): Promise<void> {\n  const addrSnap = await getDocs(collection(db, \"users\", uid, USER_ADDRESSES_SUB));\n  for (const d of addrSnap.docs) {\n    await deleteDoc(doc(db, \"users\", uid, USER_ADDRESSES_SUB, d.id));\n  }\n  const ordSnap = await getDocs(collection(db, \"users\", uid, USER_ORDERS_SUB));\n  for (const d of ordSnap.docs) {\n    await deleteDoc(doc(db, \"users\", uid, USER_ORDERS_SUB, d.id));\n  }\n  await deleteDoc(doc(db, \"users\", uid));\n}\n"],"mappings":"AAAA,OAASA,GAAG,CAAEC,MAAM,CAAEC,MAAM,CAAEC,UAAU,CAAEC,OAAO,CAAEC,SAAS,KAAQ,oBAAoB,CACxF,OAASC,EAAE,KAAQ,iBAAiB,CACpC,OAASC,gBAAgB,CAAEC,kBAAkB,CAAEC,eAAe,KAAQ,oBAAoB,CAC1F,OAASC,cAAc,KAAQ,wBAAwB,CAQvD,MAAO,eAAe,CAAAC,YAAYA,CAACC,GAAW,CAA2B,CACvE,KAAM,CAAAC,GAAG,CAAGb,GAAG,CAACM,EAAE,CAAEC,gBAAgB,CAAEK,GAAG,CAAC,CAC1C,KAAM,CAAAE,IAAI,CAAG,KAAM,CAAAb,MAAM,CAACY,GAAG,CAAC,CAC9B,MAAQ,CAAAC,IAAI,CAACC,MAAM,CAAC,CAAC,CAAID,IAAI,CAACE,IAAI,CAAC,CAAC,CAAsB,CAAC,CAAC,CAC9D,CAEA,MAAO,eAAe,CAAAC,YAAYA,CAACL,GAAW,CAAEM,QAAkB,CAAE,CAClE,KAAM,CAAAL,GAAG,CAAGb,GAAG,CAACM,EAAE,CAAEC,gBAAgB,CAAEK,GAAG,CAAC,CAC1C,KAAM,CAAAV,MAAM,CAACW,GAAG,CAAEH,cAAc,CAAC,CAAEQ,QAAS,CAAC,CAAC,CAAE,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAClE,CAEA,MAAO,eAAe,CAAAC,QAAQA,CAACR,GAAW,CAAES,IAAgB,CAAE,CAC5D,KAAM,CAAAR,GAAG,CAAGb,GAAG,CAACM,EAAE,CAAEC,gBAAgB,CAAEK,GAAG,CAAC,CAC1C,KAAM,CAAAV,MAAM,CAACW,GAAG,CAAEH,cAAc,CAAC,CAAEW,IAAK,CAAC,CAAC,CAAE,CAAEF,KAAK,CAAE,IAAK,CAAC,CAAC,CAC9D,CAEA,MAAO,eAAe,CAAAG,gBAAgBA,CAACV,GAAW,CAAiB,CACjE,KAAM,CAAAW,QAAQ,CAAG,KAAM,CAAAnB,OAAO,CAACD,UAAU,CAACG,EAAE,CAAE,OAAO,CAAEM,GAAG,CAAEJ,kBAAkB,CAAC,CAAC,CAChF,IAAK,KAAM,CAAAgB,CAAC,GAAI,CAAAD,QAAQ,CAACE,IAAI,CAAE,CAC7B,KAAM,CAAApB,SAAS,CAACL,GAAG,CAACM,EAAE,CAAE,OAAO,CAAEM,GAAG,CAAEJ,kBAAkB,CAAEgB,CAAC,CAACE,EAAE,CAAC,CAAC,CAClE,CACA,KAAM,CAAAC,OAAO,CAAG,KAAM,CAAAvB,OAAO,CAACD,UAAU,CAACG,EAAE,CAAE,OAAO,CAAEM,GAAG,CAAEH,eAAe,CAAC,CAAC,CAC5E,IAAK,KAAM,CAAAe,CAAC,GAAI,CAAAG,OAAO,CAACF,IAAI,CAAE,CAC5B,KAAM,CAAApB,SAAS,CAACL,GAAG,CAACM,EAAE,CAAE,OAAO,CAAEM,GAAG,CAAEH,eAAe,CAAEe,CAAC,CAACE,EAAE,CAAC,CAAC,CAC/D,CACA,KAAM,CAAArB,SAAS,CAACL,GAAG,CAACM,EAAE,CAAE,OAAO,CAAEM,GAAG,CAAC,CAAC,CACxC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}